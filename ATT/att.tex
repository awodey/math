%%
% Notes on Algebraic Type Theory
% begun July 2023
%%
%\documentclass[12pt]{article}
\documentclass[12pt,reqno]{amsart}
\usepackage{amsmath,amssymb,amsthm,latexsym}
\usepackage{bm,bbm}
\usepackage[all,cmtip]{xy}
\input{diagxy}
%\CompileMatrices       
\usepackage{url}
%\usepackage{fullpage}
\usepackage[colorlinks=true,linkcolor=blue,anchorcolor=blue,citecolor=blue,filecolor=blue,urlcolor=blue]{hyperref}

\newcommand{\ednote}[1]{[\textit{\color{red}{#1}}]} % editorial note

% categories
\newcommand{\cattwo}{\ensuremath{\mathbbm{2}}}
\newcommand{\A}{\ensuremath{\mathbb{A}}}
\newcommand{\B}{\ensuremath{\mathbb{B}}}
\newcommand{\C}{\ensuremath{\mathbb{C}}}
\newcommand{\D}{\ensuremath{\mathbb{D}}}
\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Th}{\ensuremath{\mathbb{T}}}
\renewcommand{\AA}{\ensuremath{\mathcal{A}}}
\newcommand{\BB}{\ensuremath{\mathcal{B}}}
\newcommand{\CC}{\ensuremath{\mathcal{C}}}
\newcommand{\DD}{\ensuremath{\mathcal{D}}}
\newcommand{\EE}{\ensuremath{\mathcal{E}}}
\newcommand{\FF}{\ensuremath{\mathcal{F}}}
\newcommand{\WW}{\ensuremath{\mathcal{W}}}

\newcommand{\op}[1]{\ensuremath{{#1}^{\mathsf{op}}}}
\newcommand{\pshx}[1]{\ensuremath{\mathsf{Set}^{\op{#1}}}}
\newcommand{\psh}[1]{\ensuremath{[\op{#1},\mathsf{Set}]}}
\newcommand{\pshat}[1]{\ensuremath{\widehat{#1}}}

\newcommand{\Set}{\ensuremath{\mathsf{Set}}}
\newcommand{\set}{\ensuremath{\mathsf{set}}}
\newcommand{\Cat}{\ensuremath{\mathsf{Cat}}}
\newcommand{\cat}{\ensuremath{\mathsf{cat}}}
\newcommand{\Pos}{\ensuremath{\mathsf{Pos}}}
\newcommand{\pos}{\ensuremath{\mathsf{pos}}}
\newcommand{\covpshx}[1]{\ensuremath{\mathsf{Set}^{#1}}}
\newcommand{\cSet}{\ensuremath{\mathsf{cSet}}}

\newcommand{\Hom}{\ensuremath{\mathsf{Hom}}}
\renewcommand{\hom}{\ensuremath{\mathsf{Hom}}}
\newcommand{\y}{\ensuremath{\mathsf{y}}} % Yoneda embedding
\newcommand{\elem}[1]{\textstyle\int\!{#1}}% category of elements
\newcommand{\colim}{\varinjlim}% colimit with subscript

\newcommand{\FP}{\ensuremath{\mathsf{FP}}}
\newcommand{\ModT}{\ensuremath{\mathsf{Mod}(\T)}}
\newcommand{\TAlg}{\ensuremath{\T\text{-}\mathsf{Alg}}}
\newcommand{\tp}{\ensuremath{\mathsf{tp}}}
\newcommand{\Tm}{\ensuremath{\mathsf{Tm}}}
\newcommand{\Ty}{\ensuremath{\mathsf{Ty}}}

% Algebras
\newcommand{\alg}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\algA}{\ensuremath{\mathsf{A}}}
\newcommand{\algB}{\ensuremath{\mathsf{B}}}
\newcommand{\algC}{\ensuremath{\mathsf{C}}}
\newcommand{\algD}{\ensuremath{\mathsf{D}}}

% arrows
\newcommand{\hook}{\ensuremath{\hookrightarrow}}
\newcommand{\mono}{\ensuremath{\rightarrowtail}}
\newcommand{\ra}{\ensuremath{\rightarrow}}
\newcommand{\cof}{\ensuremath{\rightarrowtail}}
\newcommand{\fib}{\ensuremath{\epi}}
\renewcommand{\to}{\ensuremath{\rightarrow}}
\newcommand{\too}{\ensuremath{\longrightarrow}}
\newcommand{\tto}{\ensuremath{\rightrightarrows}}

% cubical sets
\newcommand{\I}{\ensuremath{\mathrm{I}}}
\newcommand{\II}{\ensuremath{\mathbb{I}}}
\renewcommand{\H}{\ensuremath{\mathbb{H}}}
\newcommand{\HH}{\ensuremath{\mathcal{H}}}

% type theory
\newcommand{\G}{\ensuremath{\Gamma}}
\newcommand{\defeq}{=_{\mathrm{def}}}
\newcommand{\type}{\mathsf{type}}       
\newcommand{\types}[2]{#1 \vdash #2:\type}
\newcommand{\Gtypes}[1]{\types{\Gamma}{#1}}
\newcommand{\term}[2]{#1\,:\,#2}
\newcommand{\terms}[2]{#1 \vdash #2}
\newcommand{\Gterms}[1]{\terms{\Gamma}{#1}}
\newcommand{\ext}[2]{{#1,#2}}
\newcommand{\ty}{\ensuremath{\,:\,}}
\newcommand{\pair}[1]{\ensuremath{\langle #1\rangle}}
\newcommand{\exdot}{\ensuremath{\!\centerdot\!}}
\newcommand{\texdot}{\ensuremath{\centerdot}}

% Id types
\newcommand{\Id}{\mathsf{Id}}
\newcommand{\id}[1]{\Id_{#1}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\idrec}{\mathsf{idrec}}
\newcommand{\jay}{\mathsf{j}}
\renewcommand{\i}{\mathsf{i}}


% Universes
\newcommand{\U}{\ensuremath{\mathcal{U}}}
\newcommand{\UU}{\ensuremath{\,\dot{\mathcal{U}}}}
%\renewcommand{\t}{\ensuremath{\mathsf{t}}}
\renewcommand{\t}{\ensuremath{\mathsf{t}}}
\newcommand{\tT}{\ensuremath{{\t}:\TT\to\T}}
%\newcommand{\T}{\ensuremath{\mathsf{T}}}
%\newcommand{\TT}{\ensuremath{\dot{\mathsf{T}}}}
\newcommand{\T}{\ensuremath{\mathsf{T}}}
\newcommand{\TT}{\ensuremath{\dot{\mathsf{T}}}}
\newcommand{\V}{\ensuremath{\mathcal{V}}}
\newcommand{\VV}{\ensuremath{\dot{\mathcal{V}}}}
\newcommand{\SSet}{\ensuremath{\,\dot{\Set}}}
\newcommand{\sset}{\ensuremath{\,\dot{\set}}}
\newcommand{\Fib}{\ensuremath{\mathsf{Fib}}}
\newcommand{\FFib}{\ensuremath{\dot{\mathsf{Fib}}}}

% Adjunctions
\newcommand{\adjunction}[2]{%
  \begin{tabular}{c}
    $#1$ \\
    \noalign{
      \vskip 2pt      
      \hrule
      \vskip 1pt      
      \hrule
      \vskip 2pt      
      }
    $#2$
  \end{tabular}
  }

\newcommand{\adjunctionx}[3]{%
  \begin{tabular}{c}
    $#1$ \\
    \noalign{
      \vskip 2pt      
      \hrule
      \vskip 1pt
      \hrule
      \vskip 2pt      
      }
    $#2$ \\
    \noalign{
      \vskip 2pt      
      \hrule
      \vskip 1pt
      \hrule
      \vskip 2pt      
      }
    $#3$
  \end{tabular}
  }

\newcommand{\adjrule}{\noalign{\vskip 2pt \hrule \vskip 1pt \hrule \vskip 2pt}}
\newcommand{\longadjunction}[1]{
\begin{tabular}{>{$}c<{$}}
#1
\end{tabular}
}

% Commutative diagrams in tikz
\usepackage{tikz}
\usepackage{pdfpages}
\usepackage{tikz-cd}

\newcommand{\pbcorner}{\arrow[dr,phantom,"\lrcorner" very near start, shift right=.5ex]} % tikz pullback corners
\newcommand{\ppbcorner}{\arrow[drr,phantom,"\lrcorner" very near start, shift right=.5ex]}
\newcommand{\pbcornerright}{\arrow[dl,phantom,"\llcorner" very near start, shift left=.5ex]} % tikz pullback corners right
\newcommand{\pocorner}{\arrow[dr,phantom,"\ulcorner" very near end]} % tikz pushout corners
\newcommand{\ppocorner}{\arrow[dr,phantom,"\ulcorner" very near end]}

\newcommand{\xypbcorner}[1][dr]{\save*!/#1-1.5pc/#1:(-1,1)@^{|-}\restore}% pullback corner in xypic


% Theorem styles
\newtheorem{theorem}{Theorem}
\newtheorem*{theorem*}{Theorem}
\newtheorem{proposition}[theorem]{Proposition} 
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary} 

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark} 
\newtheorem*{remarks*}{Remarks}
\newtheorem{example}[theorem]{Example}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{Algebraic Type Theory}
\author{Steve Awodey}
\date{\today}
\maketitle

%\begin{abstract}
%\end{abstract}

%\setcounter{tocdepth}{1}
%\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{Introduction}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsection*{1. The Hofmann-Streicher universe}\label{sec:U}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%In \cite{HS:1997} the authors define a (type-theoretic) \emph{universe}  $(U, {\mathcal{E}l})$ 
%\begin{equation}\label{eq:universe}
%E \too U
%\end{equation}
%with $U\in\widehat{\C}$ and $\textstyle\El \in \widehat{\int_\C U}$ as follows. For $I\in\C$, set
% \begin{align}
%	U(I)\ &=\ \Cat\big(\op{\C/_I}, \Set\big) \label{eq:universeob}\\ 
%	%E(I)\ &=\ {\textstyle \coprod_{A\in U(I)}\El(\langle I, A\rangle)}\\
% 	\El(I, A)\ &=\ A(id_I) \label{eq:universeel}
% \end{align}
%with an evident associated action on morphisms.  A few comments are required: 
%%

We begin by recalling from \cite{awodey:NM} the notion of a \emph{natural model} of dependent type theory and its relation to the \emph{categories with families} of \cite{dybjer:CwF}.  In section \ref{sec:strictify} it is briefly recalled how such models are related to the \emph{clans} and \emph{tribes} of Joyal \cite{Joyal:clan}.  In section \ref{sec:MLalgebra} we abstract the main features of a natural model with the type-formers $\mathsf{1}, \Sigma, \Pi$ to form the notion of a \emph{Martin-L\"of algebra}, the basic theory of which is begun in section \ref{sec:eqandid } with the addition of equality and identity types.  We conclude with the relation to polynomial monads in section \ref{sec:free}. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Natural models of type theory}\label{sec:NaturalModels}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent We write $\widehat{\C} = \psh{\C}$ for the category of presheaves on a small category~$\C$.
%\begin{enumerate}
%
%\item  
In \eqref{A:NM}, a \emph{natural model} of type theory is defined to be a representable natural transformation $\t: \TT\to \T$ of presheaves on a small category $\C$.  When $\C$ is regarded as the category of contexts of a type theory, $\T: \op{\C} \to \Set$ is regarded as the presheaf of types in context, $\TT: \op{\C} \to \Set$ as the presheaf of terms in context, and $\t : \TT\to\T$ as the typing of the terms.   Theorem XX of \emph{op.\ cit.} shows that such a map is equivalent to the notion of a \emph{category with families} (CwF) in the sense of \cite{Dybjer}.  We briefly recall the essentials.

\begin{definition}\label{def:representablenattrans} A natural transformation $p : Y \to X$ of presheaves on a category $\C$  is \emph{representable} if the pullback of $p$ along any element $x: \y{C} \to X$ is representable.
\begin{equation*}
\begin{tikzcd}
 \y{D} \ar[d,swap,"{\y{c}}"] \ar[r,"y"] \pbcorner &  Y \ar[d, "p"]\\
\y{C} \ar[r,swap,"x"]  & X
\end{tikzcd}
\end{equation*}
\end{definition}
We assume a choice of pullback data $c : D \to C$ in $\C$ and $y \in Y(D)$ for all $x\in X(C)$ (but no coherence conditions).

\begin{proposition}[A., Fiore 2013] A representable natural transformation is the same thing as a \emph{category with families} in the sense of Dybjer.
\end{proposition}

We sketch the correspondence from \cite{Awodey:NM}.
Let us write the objects and arrows of \C\ as $\sigma : \Delta \to \Gamma$, giving the \emph{category of contexts and substitutions}.
A CwF is usually defined as a presheaf of \emph{types in context}, 
\[
\Ty : \C^{\mathrm{op}}\to \Set\,,
\]
together with a presheaf of \emph{typed terms in context}, 
\[
\Tm : {\textstyle (\int_{\C}\!\Ty)^{\mathsf{op}}\to \Set }\,.
\]
We reformulate this using the familiar equivalence
\[\textstyle
 \pshx{\C}\!/_{\Ty}\ \simeq\ \pshx{(\int_{\C}\Ty)}
\]
in order to obtain a map $\tp :\Tm \to \Ty$.


Formally, we then interpret:
\begin{align*}
 \Ty(\Gamma) &= \{ A \,|\, \Gamma \vdash A\} \\
 \Tm(\Gamma) &= \{ a \,|\, \Gamma \vdash a:A\} 
\end{align*}
Under the Yoneda lemma we therefore have a bijective correspondence:
\begin{align*}
\Gamma\vdash A\quad &\approx\quad A : \y{\Gamma}\to \Ty  \\
\Gterms{a:A}\quad &\approx\quad  a: \y{\Gamma}\to \Tm  \qquad (\tp\circ a = A)
\end{align*}
as indicated in the following.
\[
\begin{tikzcd}
 	&&  {\Tm} \ar[d,"{\tp}"]\\
\y\Gamma \ar[rru, "a"]   \ar[rr ,swap,  "A"]   && {\Ty}
\end{tikzcd}
\]
%

The action of a substitution of contexts $\sigma : \Delta \to \Gamma$ on types and terms,
\[
\frac{\sigma: \Delta \to \Gamma, \quad \Gamma\vdash a:A}{\Delta\vdash a[\sigma] : A[\sigma]}
\]
is then interpreted simply as composition:
\[
\begin{tikzcd}
 	&&&  {\Tm} \ar[d,"{\tp}"]\\
\y{\Delta} \ar[r,  "\y{\sigma}"] \ar[rrru, bend left = 4ex, "{a[\sigma]}"] \ar[rrr, swap, bend right = 5ex, "{A[\sigma]}"] & \y\Gamma \ar[rru, "a"]   \ar[rr ,swap,  "A"]  && {\Ty}
\end{tikzcd}
\]
%
We may hereafter omit the $\y$ for the Yoneda embedding, letting the Greek letters serve to distinguish representable presheaves and their maps.

The CwF operation of \emph{context extension} 
$$\frac{\quad\Gamma\vdash A\quad}{\ \ \ext{\G}{A}\vdash}$$
is modeled by the representability of $\tp : \Tm\to\Ty$ as follows.
%
Given $\Gamma\vdash A$ we need a new context $\ext{\G}{A}$ together with a substitution $\pi_A : \ext{\G}{A} \to \G$ and a term 
\[
\terms{\ext{\G}{A}}{q_A:A[\pi_A]}\,,
\]
where, the substitution $A[\pi_A]$ is modeled by composition $A[\pi_A] = A\circ \pi_A$.

Let $\pi_A: \ext{\G}{A} \to \G$ be the pullback of $\tp$ along $A$, which exists as an arrow in $\C$ since $\tp$ is representable.
%
\begin{equation}\label{diag:NMpullback}
\begin{tikzcd}
{\ext{\G}{A}} \ar[d,swap, "{\pi_A}"] \ar[r, "{q_A}"] \pbcorner &  {\Tm} \ar[d, "{\tp}"]\\
{\G} \ar[r,swap,"A"]   & {\Ty}
\end{tikzcd}
\end{equation}
%
The map $q_A : \ext{\G}{A}\to\Tm$ arising from the pullback gives the required term $\terms{\ext{\G}{A}}{q_A:A[p_A]}$, since $\tp\circ q_A = A \circ p_A$.
The remaining laws of a CwF follow from the pullback condition on $\eqref{diag:NMpullback}$; see \cite{Awodey:NM}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Modeling the type formers}

Given a natural model $\tT$, we will make extensive use of the associated \emph{polynomial endofunctor}
$\alg{P}_\t : \hat\C \too \hat\C$ (cf.\ \cite{GambinoKoch}), defined by 
\[
\alg{P}_\t = \T_! \circ \t_* \circ \TT^* : \hat{\C}\too\hat{\C}\,,
\] 
\begin{equation*}
\xymatrix{
  \Set^{\C^\mathsf{op}} \ar[d]_{\TT^*} \ar[rr]^{\alg{P}_\t} && \Set^{\C^\mathsf{op}} \\
  \Set^{\C^\mathsf{op}}\!/_{\TT} \ar[rr]_{{\t}_*} && \Set^{\C^\mathsf{op}}\!/_\T \ar[u]_{{\T}_!} 
 }
\end{equation*}

The action of $\alg{P}_\t$ on an object $X$ may be depicted:
\begin{equation*}
\xymatrix{
 X & \ar[l] X\times \TT \ar[d] && \alg{P}_\t(X) \ar[d] \\
	& \TT \ar[rr]_{\t} && \T 
 }\qquad\quad
 \end{equation*}


  We call $\tT$ the \emph{signature} of $\alg{P}_\t$ and briefly recall the following \emph{universal mapping property} from \cite{awodey:NM}.

\begin{lemma}
 For any $p: E \to B$ in a locally cartesian closed category $\EE$, the polynomial functor $\alg{P}_p : \EE \to \EE$ has the following universal property:  for any objects $X, Z \in \EE$, maps $f : Z \to \alg{P}_p (X)$ correspond bijectively to pairs of maps $f_1 : Z \to B$ and $f_2 : Z\times_B E \to Z$, as indicated below.
\begin{equation}\label{diag:polyUMP}
\begin{tikzcd}
&Z \ar[rr,"f"] && \alg{P}_p (X) & \\[-5ex]
\strut \ar[rrrr, equal] &&&& \strut\\[-5ex]
&X & \ar[l,"f_2"] Z\times_B E \ar[d] \ar[r] \pbcorner & E \ar[d, "p"] &\\
&& Z \ar[r,swap,"f_1"] & B &
\end{tikzcd}
\end{equation}
The correspondence is natural in both $X$ and $Z$, in the expected sense.
\end{lemma}

This universal property is also suggested by the conventional type theoretic notation, namely: $$\alg{P}_p (X) = \Sigma_{b:B} X^{E_b}$$
The lemma can be used to determine the signature $p\cdot q$ for the composite $\alg{P}_p \circ \alg{P}_q$ of two polynomial functors, which is again polynomial, and for which we therefore have
\begin{equation}\label{eq:polycomp}
\alg{P}_{p\cdot q} \cong \alg{P}_p \circ \alg{P}_q\,.
\end{equation}
Indeed, let $p : B \to A$ and $q : D \to C$, and consider the following diagram resulting from applying the correspondence \eqref{diag:polyUMP} to the identity arrow,
\[
\langle a, c\rangle = 1_{\alg{P}_p(C)} : \alg{P}_p(C) \to \alg{P}_p(C)\,,
\]
and taking $Q$ to be the indicated pullback.
%
\begin{equation}\label{diag:polyUMP}
\begin{tikzcd}
D \ar[d,swap,"q"] & \ar[l] Q \ar[d] \pbcornerright  \ar[dd, dotted, bend left = 10ex ,near start, "{p\cdot q}"]& & \\
 C  & \ar[l,"c"] \pi^*B \ar[d] \ar[r] \pbcorner & B \ar[d,"p"] \\
&  \alg{P}_p(C) \ar[r,swap,"a"] & A
\end{tikzcd}
\end{equation}
The map $p\cdot q$ is then defined to be the indicated composite,
\[
p\cdot q\ =\ a^*p \circ c^*q\,.
\]
The condition \eqref{eq:polycomp} can then be checked using the correspondence \eqref{diag:polyUMP} (also see \cite{GambinoKoch}).

\begin{definition}\label{def:modelthetypeformers}
A natural model $\tT$ over $\C$ will be said to \emph{model} the type formers $ \mathsf{1}, \Sigma, \Pi$ if there are pullback squares in $\hat{\C}$ of the following form,
%\begin{equation}\label{diag:naturalmodelPiSigma1}
%\begin{tikzcd}
%	1 \ar[r,"*"] \ar[d,swap,"!"] \pbcorner &  \TT \ar[d, "\t"]\\  
%	1 \ar[r, swap,"\mathsf{1}"] & \T
% \end{tikzcd} \qquad \qquad 
% \begin{tikzcd}
%	\TT_2  \ar[r,"\sigma"] \ar[d,swap,"\t\cdot\t"] \pbcorner &  \TT \ar[d, "\t"]\\  
%	\T_2 \ar[r,swap, "\Sigma"] & \T
%	 \end{tikzcd} \qquad \qquad 
%	 \begin{tikzcd}
%	 \alg{P}_\t(\TT) \ar[r,"\lambda"] \ar[d,swap,"\alg{P}_\t(\t)"] \pbcorner &  \TT \ar[d, "\t"]\\  
%	\alg{P}_\t(\T) \ar[r,swap, "\Pi"] & \T
% \end{tikzcd} 
% \end{equation}
%
\begin{equation}\label{diag:naturalmodelPiSigma1}
\begin{tikzcd}
	1 \ar[r] \ar[d] \pbcorner &  \TT \ar[d, "\t"]\\  
	1 \ar[r] & \T
 \end{tikzcd} \qquad \qquad 
 \begin{tikzcd}
	\TT_2  \ar[r] \ar[d,swap,"\t\cdot\t"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\T_2 \ar[r] & \T
	 \end{tikzcd} \qquad \qquad 
	 \begin{tikzcd}
	 \alg{P}_\t(\TT) \ar[r] \ar[d,swap,"\alg{P}_\t(\t)"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\alg{P}_\t(\T) \ar[r] & \T
 \end{tikzcd} 
 \end{equation}
%
where $\t\cdot\t : \dot{\T}_2 \to \T_2$ is determined by $\alg{P}_{\t\cdot\t} \cong  \alg{P}_{\t} \circ \alg{P}_{\t}$ as in \eqref{eq:polycomp}.
\end{definition}

The terminology is justified by the following result from \cite{A:NM}.

%
\begin{theorem}[\cite{Awodey:NM} Theorem XXX]\label{thm:nmcwf}
Let $\tT$ be a natural model. The associated category with families satisfies the usual rules for the type-formers $\mathsf{1}, \Sigma, \Pi$ just if $\tT$ models the same in the sense of Definition \ref{def:modelthetypeformers}.
\end{theorem}

We only sketch the case of $\Pi$-types, but the other type formers will be treated in more detail in Section \ref{sec:MLalgebras} (see also \cite{Awodey:NM, Newstead, Awodey-Newstead}).

\begin{proposition}  The natural model $\tT$ models $\Pi$-types just if there are maps $\lambda$ and $\Pi$ making the following a pullback diagram. 
\begin{equation}\label{diag:prod2}
\begin{tikzcd}
\alg{P}_\t(\TT)  \ar[d,swap, "{\alg{P}_\t(\t)}"]   \ar[r, "\lambda"]  \pbcorner &  \TT \ar[d, "{\t}"]\\
\alg{P}_\t(\T)	\ar[r,swap, "{\Pi}"] & \T
\end{tikzcd}
\end{equation}
\end{proposition}
%
\begin{proof}
Unpacking the definitions, we have $\alg{P}_\t(\T) = \Sigma_{A:\T} \T^A $, etc.,  
%\begin{align*}
%\alg{P}_\t(\T) &= \Sigma_{A:\T} \T^A \\
%\alg{P}_\t(\TT) &= \Sigma_{A:\T} \TT^A 
%\end{align*}
so diagram \eqref{diag:prod2} becomes:
\begin{equation*}%\label{diag:prod2}
\begin{tikzcd}
\Sigma_{A:\T} \TT^A \ar[d,swap, "{\Sigma_{A:\T} \t^A}"]  \ar[r, "{\lambda}"] &  \TT \ar[d,"{\t}"] \\
\Sigma_{A:\T} \T^A    \ar[r, swap,"{\Pi}"] & \T
\end{tikzcd}
\end{equation*}
For $\G \in \C$, maps $\G\to \Sigma_{A:\T} \T^A $ correspond to pairs $(A,B)$ with  $A:\G\to \T$ and $B : \ext{\G}{A} \to \T$, and thus to $\G\vdash A$ and $\ext{\G}{A} \vdash B$. Similarly, a map $\G\to \Sigma_{A:\T} \TT^A $ corresponds to a pair $(A,b)$ with $\G\vdash A$ and $\ext{\G}{A} \vdash b : B$, the typing of $b$ resulting from composing with the map 
\[
\Sigma_{A:\T} \t^A : \Sigma_{A:\T} \TT^A \to \Sigma_{A:\T} \T^A\,.
\]
\begin{equation*}%\label{diag:prod2}
\begin{tikzcd}
	& \Sigma_{A:\T} \TT^A \ar[dd]  \ar[rr, "{\lambda}"] &&  \TT \ar[dd,"{\t}"] \\
\G \ar[dr,swap, "{(A,B)}"] \ar[ru, "{(A,b)}"] \ar[urrr, swap, crossing over, "{ \lambda_{A}b }"] \ar[drrr, crossing over, "{ \Pi_{A}B }"] &&& \\
 	& \Sigma_{A:\T}\T^A    \ar[rr, swap,"{\Pi}"] && \T 
\end{tikzcd}
\end{equation*}
The composition across the top is then the term $\G \vdash \lambda_{x:A} b$ , the type of which is determined by composing with $\tp$ and comparing with the composition across the bottom, namely $\G \vdash \Pi_{x:A} B$. In this way, the lower horizontal arrow in the diagram models the \emph{$\Pi$-formation rule}:
\[
\frac{\quad\ext{\G}{A}\vdash B\quad}{\G\vdash \Pi_{x:A} B}
\]
and the upper horizontal arrow, along with the commutativity of the diagram, models the \emph{$\Pi$-introduction rule}:
\[
\frac{\ext{\G}{A}\vdash b:B}{\G\vdash \lambda_{x:A} b : \Pi_{x:A} B}
\]
The square \eqref{diag:prod2} is a pullback just if, for every $(A,B) : \G \to \Sigma_{A:\T}\T^A$ and every $t: \G \to \TT$ with $\tp \circ t = \Pi_A B$, there is a unique $(A,b) : \G \to \Sigma_{A:\T}\TT^A$ with $b:B$ and $\lambda_A b = t$.  In terms of the interpretation, given $\ext{\G}{A} \vdash B$ and $\G\vdash t: \Pi_{x:A} B$, there is a term $\ext{\G}{A}\vdash t':B$ with $\lambda_{x:A}  t' = t$, and $t'$ is unique with this property.  This is just what is provided by the \emph{$\Pi$-elimination rule}:
\[
\frac{{\ext{\G}{A} \vdash B}\qquad {\G \vdash t : \Pi_{x:A}  B} \qquad {\G \vdash x:A}}{{\ext{\G}{A}\vdash t\, x :B}}
\]
in conjunction with the \emph{$\Pi$-computation rules}:
\begin{align*}
\lambda_{x:A} (t\,x) &= t : \Pi_A B\\
(\lambda_{x:A} b)\,x &= b : B
\end{align*}
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Martin-L\"of algebras}\label{sec:MLalgebras}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Now let $\EE$ be a locally cartesian closed category (lccc) and $\tT$ a map in~$\EE$.  As in the foregoing case where $\EE$ was a category of presheaves, $\t$ gives rise to a polynomial endofunctor  (\cite{GK}),
$$\alg{P}_\t = \T_! \circ \t_* \circ \TT^* : \EE\too\EE\,,$$
which we may use to define the following abstraction of the notion of a natural model.
\begin{definition}\label{def:MLalg}
A \emph{Martin-L\"of algebra} in an lccc $\EE$ is a map $\tT$ equipped with structure maps $(*, 1, \sigma, \Sigma, \lambda, \Pi)$ making pullback squares 
\begin{equation}\label{diag:MLalg}
\begin{tikzcd}
	1 \ar[r,"*"] \ar[d,swap,"!"] \pbcorner &  \TT \ar[d, "\t"]\\  
	1 \ar[r, swap,"\mathsf{1}"] & \T
 \end{tikzcd}\qquad \qquad 
 \begin{tikzcd}
	\TT_2  \ar[r,"\sigma"] \ar[d,swap,"\t\cdot\t"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\T_2 \ar[r,swap, "\Sigma"] & \T
\end{tikzcd} \qquad \qquad 
	 \begin{tikzcd}
	\alg{P}_\t\TT \ar[r,"\lambda"] \ar[d,swap,"\alg{P}_\t(\t)"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\alg{P}_\t\T \ar[r,swap, "\Pi"] & \T
 \end{tikzcd} 
 \end{equation}
 where the map $\t\cdot\t$ is defined in terms of $\alg{P}_\t$ as in \eqref{diag:naturalmodelPiSigma1} via
 \[
\alg{P}_{\t\cdot\t} = \alg{P}_{\t}\cdot \alg{P}_{\t}\,.
 \]
   \end{definition}

In place of representability in the elementary setting we may require that $\tT$ be $\emph{tiny}$.

\begin{definition}\label{def:tinymap}
 A map $f : B \to A$ in a locally cartesian closed category $\EE$ will be said to be \emph{tiny} if it is so as an object in $\EE/_A$, in the sense that exponentiation by $f$ has a right adjoint $(-)^f \dashv (-)_f$. 
\end{definition}

Note that a map $f : B \to A$ in an lccc is tiny just if the \emph{pushforward} functor $f_* : \EE/_B \to \EE/_A$ has a right adjoint,
\[
f_* \dashv f^! : \EE/_A \too \EE/_B\,.
\]

\begin{proposition}\label{prop:rep_is_tiny}
If $\C$ has finite limits, a map $p : Y \to X$ in $\widehat{\C}$ is representable just if it is tiny in the sense of Definition \ref{def:tinymap}, which is the case just if the \emph{pushforward functor} (the right adjoint to pullback) 
\[
p^* \dashv p_* : \widehat{\C}/_{Y} \longrightarrow \widehat{\C}/_{X}
\] 
has a \emph{right} adjoint:
\[
p_! \dashv p^*\dashv p_* \dashv  p^!
\]
\end{proposition}

\begin{proof}
The elementary definition \ref{def:representablenattrans} clearly states that, for the category of elements ${\int\!X} \simeq {\y{}/_X}$, the composition functor 
\[\textstyle
{\int\!p} : {\int\!Y} \to {\int\!X}
\]  
has a right adjoint, say ${\int\!p} \dashv ({\int\!p})^\sharp$. Now recall that $\widehat{\C}/{X} \simeq \psh{(\int\!X)}$, so that the precomposition functor $({\int\!p})^* = \psh{({\int\!p})}$ gives rise to a commutative diagram with left and right Kan extensions:
\[\textstyle
({\int\!p})_!\dashv ({\int\!p})^* \dashv ({\int\!p})_*
\]
%
%\begin{equation}\begin{tikzcd}
%\psh{{\int\!Y}} \ar[rr,  "{P_!}"]  &&  \psh{\int\!X} \ar[ll, "{P^*}"] \\
%&& \\
%{\int\!Y} \ar[uu, hook, "{\y{}}"]  \ar[rr, "{p_!}"]  &&  \ar[ll, "{p^*}"]  {\int\!X} \ar[uu, hook, "{\y{}}"]
%\end{tikzcd}\end{equation}
\begin{equation}\begin{tikzcd}
\psh{(\int{\!Y})} \ar[rr,shift right = 1ex,swap, "{\int\!p}_!"]  \ar[rr,shift left = 1ex] &&   \psh{(\int{\!X})} \ar[ll] \\
&& \\
\int{\!Y} \ar[uu, hook, "{\y{}}"]  \ar[rr, swap, "{\int\!p}"]  &&  \int{\!X} \ar[uu, swap,hook, "{\y{}}"]
\end{tikzcd}\end{equation}
%
But since ${\int\!p} \dashv ({\int\!p})^\sharp$ , there is a further right adjoint $({\int\!p})_* \dashv (({\int\!p})^\sharp)_*$ to precomposition with $({\int\!p})^\sharp$.  Moving back across the equivalence $\psh{(\int\!X)} \simeq \widehat{\C}/_{X}$ we obtain the claimed further right adjoint: 
\[
p_! \dashv p^* \dashv p_*\dashv p^! :  \widehat{\C}/_{X} \too \widehat{\C}/_{Y}
\]
%
Conversely, a right adjoint $$\textstyle ({\int\!p})_* \dashv R : \psh{(\int{\!X})} \to \psh{(\int{\!Y})}$$ is easily shown to be induced by precomposing with a right adjoint ${\int\!p} \dashv r : {\int\!X} \to {\int\!Y}$ if $\C$ if has all finite products and idempotents split in $\C$, which is the case if $\C$ has finite limits.

We leave the construction of the right adjoint $p^!:  \widehat{\C}/_{X} \too \widehat{\C}/_{Y}$ from the  right adjoint $(-)^p \dashv (-)_p : \widehat{\C}/_{X} \to \widehat{\C}/_{X}$ to the reader.
\end{proof}

\begin{remark}
In \cite{Awodey:NM} it is shown how a \emph{clan} in the sense of Joyal \cite{Joyal:CandT} gives rise to a natural model, namely ... In particular, the fibrations in a right-proper Quillen model category (which form a \emph{$\Pi$-tribe} in the language of \emph{ibid.}) are shown to give rise to a natural model with $1, \Sigma, \Pi$, i.e.\  a Martin-L\"of algebra, which moreover has \emph{identity types}, in the sense of the next section.
\end{remark}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Identity Types}\label{sec:Eq and Id}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

A natural model $\tT$ in a presheaf category $\widehat{\C}$ was defined in \cite{Awodey:NM} to model both the extensional and intensional identity types of Martin-L\"of type theory in terms of the existence of certain additional structures.  Let us show how to capture these definitions in the new, elementary setting of Martin-L\"of algebras.  Condition (\ref{def:equalitytype}) below is shown in \cite{Awodey:NM} to capture the extensional identity types of Martin-L\"of type theory.  The condition given in \emph{op.cit.} for the intensional case is replaced in (\ref{def:identitytype}) below by a simplification suggested by R.\ Garner.   

\begin{definition}\label{def:EqualityandIdentityTypes}
Let $\tT$ be a map in an lccc $\EE$. 
\begin{enumerate}
\item\label{def:equalitytype}  $\tT$ is said to  model the (extensional) \emph{equality type former} if there are structure maps $(\refl, \mathsf{Eq})$ making a pullback square:
\begin{equation*}\label{diag:Eqtypes}
\begin{tikzcd}
	\TT \ar[r,"\refl"] \ar[d,swap,"\delta"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\TT \times_\T \TT \ar[r, swap,"\mathsf{Eq}"] & \T
 \end{tikzcd}\qquad \qquad 
 \end{equation*}
\item\label{def:identitytype}   $\tT$ is said to model the (intensional) \emph{identity type former} if there are structure maps $(\mathsf{i}, \mathsf{Id})$ making a commutative square,
\begin{equation}\label{diag:Idtypes}
\begin{tikzcd}
	\TT \ar[r,"\mathsf{i}"] \ar[d,swap,"\delta"] &  \TT \ar[d, "\t"]\\  
	\TT \times_\T \TT \ar[r, swap,"\mathsf{Id}"] & \T
 \end{tikzcd}\qquad \qquad 
 \end{equation}
 together with a weak pullback structure $\mathsf{J}$ for the resulting comparison square, in the sense of \eqref{def:wps} below. 
 \end{enumerate}
   \end{definition}

To describe the map $\mathsf{J}$, let us see how (\ref{def:identitytype}) models identity types.  Under the interpretation already described in Section \ref{sec:NaturalModels} the maps $\Id$ and $\mathsf{i}$  in 
\begin{equation*}%\label{diag:Idtypes}
\begin{tikzcd}
	\TT \ar[r,"\mathsf{i}"] \ar[d,swap,"\delta"] &  \TT \ar[d, "\t"]\\  
	\TT \times_\T \TT \ar[r, swap,"\mathsf{Id}"] & \T
 \end{tikzcd}\qquad \qquad 
 \end{equation*}
respectively, directly model the formation and introduction rules.
\begin{align*}
x, y:A &\vdash \Id_A(x, y)\\
x: A &\vdash \mathsf{i}(x) : \Id_A(x, x)
\end{align*}
Next, pull $\t$ back along $\mathsf{Id}$ to get an object $\mathsf{I}$ and a map $\rho  : \TT \to \mathsf{I}$,
%
\begin{equation*}%\label{diag:prod2}
\begin{tikzcd}
\TT \ar[rd,swap,"{\delta}"] \ar[r,"{\rho}"] \ar[rr, bend left,"{\mathsf{i}}"] & \mathsf{I} \ar[r]  \ar[d] \pbcorner &  \TT \ar[d, "\t"]\\
& \TT \times_\T \TT  \ar[r, swap,"{\mathsf{Id}}"]  & \T
\end{tikzcd}
\end{equation*}
%
which commutes with the compositions to $\T$ as indicated below.
%
\begin{equation*}%\label{diag:prod2}
\xymatrix{
\TT \ar[rd]_{\t} \ar[r]^{\rho} & I \ar[d]^{q}  \\
& \T 
}
\end{equation*}
%
The map $\rho  : \TT \to \mathsf{I}$, which can be interpreted as the substitution $(x) \mapsto (x, x, \mathsf{i}x)$, gives rise to a ``restriction'' natural transformation of polynomial endofunctors (\cite{GK}),
\[
\rho^* : P_q \to P_\t\,,
\]
evaluation of which at $\t:\TT \to\T$ results in the following commutative naturality square.
\begin{equation}\label{diag:prod2}
\begin{tikzcd}
P_q\TT \ar[d,swap, "{P_q \t}"] \ar[r, "{\rho^{*}_{\TT}}"] & P_\t\TT \ar[d, "{P_\t \t}"] \\
P_q\T \ar[r,swap, "{\rho^{*}_{\T}}"] &  P_\t\T 
\end{tikzcd}
\end{equation}
%
A \emph{weak pullback structure} $\mathsf{J}$ is a section of the resulting comparison map.
\begin{equation}\label{def:wps}
\begin{tikzcd}
P_q \TT  \ar[r] & \ar[l, bend right, dotted, "\mathsf{J}" description] P_q\T \times_{P_\t\T} P_\t\TT 
\end{tikzcd}
\end{equation}

To show that this models the standard elimination rule
\[
\frac{x:A\vdash c(x) : C(\rho x)}{x, y:A, z : \Id_A(x, y)\vdash \mathsf{J}_c(x,y,z) : C(x,y,z)}
\]
take any object $\Gamma \in \EE$  and maps $(A, A, \Id_{A} \vdash C) : \Gamma \to P_q\T$ and $(A \vdash c) : \Gamma \to P_\t\TT$ with equal composites to $P_\t\T$, meaning that $A \vdash c : C(\rho x)$.  Composing the resulting map 
\[
(A\vdash c(x):C(\rho x)) : \Gamma \to P_q\T \times_{P_\t\T} P_\t\TT
\]
with $\mathsf{J} : P_q\T \times_{P_\t\T} P_\t\TT \to P_q \TT$ then indeed provides a term $$x:A, y:A, z:\Id_{A}(x,y)  \vdash \mathsf{J}_c(x,y,z) : C(x,y,z)\,.$$

The computation rule
\[
x: A \vdash \mathsf{J}_c(\rho x) = c(x) : C(\rho x)
\]
then says exactly that $\mathsf{J}$ is indeed a section of the comparison map \eqref{def:wps}.

\begin{proposition}[R.\ Garner] The map $\t : \TT \to \T$ models intensional \emph{identity types} just if there are maps $(\mathsf{i}, \Id)$ making the diagram \eqref{diag:Idtypes} commute, together with a weak pullback structure $\mathsf{J}$ for the resulting comparison square \eqref{diag:prod2}.
\end{proposition}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{4. A polynomial monad}\label{sec:Monad}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%\ednote{define $\DD_\t$ and show that it is a display map category with ... }
%\medskip
%
%\ednote{given  a display map category $\DD$ with ... define $\alg{d}$ and show that it is ...}
%\medskip
%
%\ednote{the constructions are not mutually inverse but rather adjoint inverse ...}

Let $\EE$ be an lccc, and recall from \cite{GK}[Theorem 2.17] the biequivalence 
\[
\mathrm{Poly}^1_{\EE}\ \simeq\ \mathrm{PolyFun}^1_{\EE}
\]
between the (1-object) bicategory $\mathrm{Poly}^1_{\EE}$ consisting of arrows $f:B \to A$ as 1-cells and cartesian squares
\[
\begin{tikzcd}
B \ar[d,swap, "f"] \ar[r, "{h'}"] \pbcorner & D \ar[d, "g"] \\
A \ar[r,swap, "{h}"] &  C 
\end{tikzcd}
\]
as 2-cells, and the (1-object) 2-category $\mathrm{PolyFun}^1_{\EE}$ consisting of polynomial endofunctors $P_f: \EE\to \EE$ and the cartesian (strong) natural transformations $\theta : P_f \Rightarrow P_g$ as 2-cells.  This is the endofunctor special case of the more general situation involving general polynomials and polynomial functors. Thus, simplifying to the 1-object case, we have an equivalence of categories between the monoidal category of cartesian squares in the arrow category $\EE^{\downarrow}_{\mathsf{cart}}$ and the subcategory of $\Cat(\EE, \EE)$ consisting of \emph{polynomial} endofunctors and cartesian natural transformations,
\[\begin{tikzcd}
\mathrm{Poly}^1_{\EE} \ar[d,swap, "{\simeq}"] \ar[r,"{\simeq}"] & \mathrm{PolyFun}^1_{\EE}  \ar[d, "{\simeq}"] \\
\EE^{\downarrow}_{\mathsf{cart}} \ar[d, hook] \ar[r,"{\simeq}"] & \mathsf{PolyFun}(\EE, \EE)  \ar[d, hook] \\
\EE^{\downarrow}  \ar[r] & \mathsf{Fun}(\EE, \EE)
\end{tikzcd}\]

Under this equivalence, a Martin-L\"of algebra in $\EE$ as defined in \ref{def:MLalg},
\begin{equation*}\label{diag:MLalg}
\begin{tikzcd}
	1 \ar[r,"*"] \ar[d,swap,"!"] \pbcorner &  \TT \ar[d, "\t"]\\  
	1 \ar[r, swap,"\mathsf{1}"] & \T
 \end{tikzcd}\qquad \qquad 
 \begin{tikzcd}
	\TT_2  \ar[r,"\sigma"] \ar[d,swap,"\t\cdot\t"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\T_2 \ar[r,swap, "\Sigma"] & \T
\end{tikzcd} \qquad \qquad 
	 \begin{tikzcd}
	\alg{P}_\t\TT \ar[r,"\lambda"] \ar[d,swap,"\alg{P}_\t(\t)"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\alg{P}_\t\T \ar[r,swap, "\Pi"] & \T
 \end{tikzcd} 
 \end{equation*}
gives rise to the following:
\begin{enumerate}
\item a cartesian natural transformation $\tau :1_\EE \Rightarrow P_\t$
\item a cartesian natural transformation $\sigma :P_\t\circ P_\t \Rightarrow P_\t$
\item an algebra structure $\pi:P_\t\t \Rightarrow \t$, with $P_\t$ lifted from $\EE$ to $\EE^{\downarrow}_{\mathsf{cart}}$.
\end{enumerate}
%
Items (1) and (2) are of course familiar as the underlying structure of a polynomial monad; item (3) is a somewhat less familiar special case of an algebra structure map.  The obvious question now is whether the respective equations 
for a monad and an algebra are satisfied by these functors and natural transformations.  The short answer is \emph{no}, but as shown in detail in \cite{Newstead, Awodey-Newstead}, there are good reasons to investigate further.
 
Following \emph{op.cit.}, the monad laws for $\tau$ and $\sigma$ (in the left column) express the following \emph{equations} of objects in $\EE$ (in the right column).
\begin{align*}\textstyle
 \sigma\circ P_\t\, \sigma\, &=\, \sigma\circ\sigma_{P_\t}	&&&	\sum\limits_{a:A}\sum\limits_{b:B(a)}C(a,b)\, &=\, \sum\limits_{(a,b):\sum\limits_{a:A}B(a)}C(a,b)\   \\ 
  \sigma\circ P_\t\,\tau\, &=\, 1 		&&& 	\sum\limits_{a:A}1\, &=\, A \tag{\theequation}\\ 
  \sigma\circ \tau_{P_\t}\, &=\, 1		&&& 	\sum\limits_{x:1}A\, &=\, A  
 \end{align*}
%
And the algebra laws for $\pi$ correspond to the following \emph{equations} of objects in $\EE$.
%
\begin{align*}
 \pi\circ P_\t\,\pi\, &=\,  \pi\circ\sigma 	&&&	\prod\limits_{a:A}\prod\limits_{b:B(a)}C(a,b)\, 
 									&=\, \prod\limits_{(a,b):\sum_{a:A}B(a)}C(a,b)  \\ 
 \pi\circ \tau\, &=\, 1 	&&& 	\prod\limits_{x:1}A\, &=\, A  
\end{align*}

While the equations of objects in the right hand column can hardly be expected to hold strictly, they do correspond to familiar \emph{type isomorphisms} that are provable from the usual rules of dependent type theory with $1, \Sigma, \Pi, \mathsf{Id}$.  

In \cite{Newstead, Awodey-Newstead} it is shown that the 1-category $\mathsf{PolyFun}(\EE, \EE)$ of functors and cartesian natural transformations can be enriched to a bicategory by defining \emph{ad hoc} certain 2-cells between the natural transformations in such a way that $(\tau, \sigma)$ becomes a \emph{pseudo}-monad and $\pi$ a \emph{pseudo}-algebra.  The main contribution of the present work is a different approach that makes use of the $\mathsf{Id}$-types defined in Section \ref{sec:Eq and Id} to determine a notion of 2-cell for which the just mentioned type isomorphisms result in corresponding pseudo-monad and pseudo-algebra structures.
\medskip

Let $\TT \to \T$ be an ML-algebra and say that a map $A\to X$ in $\EE$ is \emph{classified} by $\TT \to \T$ if there exist maps $\alpha : X \to \T$ and $\dot{\alpha} : A \to \TT$ fitting into a pullback square as follows.
\begin{equation}\label{eq:classifiedfamilies}
\begin{tikzcd}
	 A \ar[d] \pbcorner \ar[r, "\dot{\alpha}"] & \TT \ar[d] \\  
	X \ar[r,swap, "\alpha"] &  \T
 \end{tikzcd}
 \end{equation}
In virtue of the ML-algebra structure, such maps are closed under the type formers $1, \Sigma, \Pi$, regarding objects $X$ as contexts and classified maps $A\to X$ as families of types in context~$X$.

If $\TT \to \T$ has the structure required for $\Id{}$ in the sense of Definition \ref{def:EqualityandIdentityTypes}, then we can define an \emph{equivalence} between types $A\simeq B$ (over $X$) as follows:
%
\begin{definition}
 A map $e : A\to B$ is a (type) \emph{equivalence} if it has both right and left inverses, in the sense that there are maps $f, g : B\tto A$ such that 
 \[
e\circ f =_{B^B} 1_B\qquad\text{and}\qquad  g\circ e =_{A^A} 1_A  \,.
 \]
 Formally, given $e : A\to B$ we define 
 \[
 \mathsf{isEquiv}(e)\ :\equiv\ \Sigma_{f, g: B\to A}\, \Id{B^B}(e\circ f , 1_B) \times \Id{A^A}(g\circ e , 1_A) \,.
 \]
 and then for $A, B: \T$, we define the notation $A \simeq B$ by
 \[
A \simeq B\, =\, \mathsf{Equiv}(A,B)\ :\equiv\  \Sigma_{e : A\to B}\, \mathsf{isEquiv}(e)\,.
 \]
\end{definition}
We construct the interpretation of the type family $A, B : \T \vdash A \simeq B$ as a map $\mathsf{Equiv} \to \T \times \T$ as follows.

First, pull $\TT \to \T$ back along the two different projections $\T \times \T \tto \T$ to obtain two different objects $\TT_1, \TT_2$ over $\T \times \T$, and then take their exponential $[\TT_1, \TT_2]$ in the slice category over ${\T \times \T}$, which interprets the type family $A, B : \T \vdash A \to B$.
\begin{equation*}\label{diag:univalence1}
\begin{tikzcd} 
	\TT \ar[d] & \TT_1 \ar[l] \ar[rd] \pbcornerright &\ar[d] [\TT_1, \TT_2] & \TT_2 \ar[ld] \ar[r] \pbcorner & \TT \ar[d] \\  
	\T && \ar[ll]  \T \times \T \ar[rr] && \T
	 \end{tikzcd}
 \end{equation*}
 Indeed, after pulling $\TT_1, \TT_2$ back to $[\TT_1, \TT_2]$ there is a (universal) arrow $\varepsilon : \TT'_1 \to \TT'_2$ over $[\TT_1, \TT_2]$, as indicated below.
 \begin{equation}\label{diag:univalence11}
\begin{tikzcd} 
& \TT'_1  \ar[d] \arrow[dr,phantom,"\lrcorner" very near start, shift right=1.5ex] \ar[rd] \ar[rr,"\varepsilon"] 
	&& \TT'_2 \ar[ld]  \arrow[dl,phantom,"\llcorner" very near start, shift left=1.5ex] \ar[d] & \\  
	\TT \ar[d] & \TT_1 \ar[l] \ar[rd] \pbcornerright &\ar[d] [\TT_1, \TT_2]& \TT_2 \ar[ld] \ar[r] \pbcorner & \TT \ar[d] \\  
	\T && \ar[ll]  \T \times \T \ar[rr] && \T
	 \end{tikzcd}
 \end{equation}
%
As $\mathsf{Equiv} \to \T \times \T$ we then take the composite of the canonical projection $\mathsf{isEquiv}(\varepsilon) \to [\TT_1, \TT_2]$ with the map $[\TT_1, \TT_2] \to  \T \times \T$.
%
\begin{equation*}\label{diag:univalence2}
\begin{tikzcd} 
{\Sigma_{e : A\to B}\mathsf{isEquiv}(e)}  \ar[d, equals] \ar[r] & {[\TT_1, \TT_2]}  \ar[d]\\
\mathsf{Equiv} \ar[r] &  \T \times \T
 \end{tikzcd}
 \end{equation*}
%
Given $\tilde A , \tilde B : X \to \T$ classifying types $A\to X$ and $B \to X$, factorizations of the map $(\tilde A,\tilde B) : X \to \T \times \T $ through $\mathsf{Equiv} \to \T \times \T$ can then be seen using \eqref{diag:univalence11}  to correspond to equivalences $A\simeq B$ over $X$, as indicated in the following.
\begin{equation*}\label{diag:univalence3}
\begin{tikzcd} 
A \ar[rd] \ar[r, "{\simeq}"] & B \ar[d] & \mathsf{Equiv} \ar[d] \\  
& X \ar[ru, dotted] \ar[r, swap, "{(\tilde A, \tilde B)}"] & \T \times \T
	 \end{tikzcd}
 \end{equation*}
The correspondence is natural in $X$, because is mediated by pulling back a universal instance.  
\begin{remark}[Univalence]
If $\T$ is itself a type in a ``larger'' model $\TT_1 \to \T_1$ with $\Id{}$-types, then there is also the type family $A, B: \T \vdash \Id{\T}(A,B)$, which is interpreted as a map $\Id{\T}\to \T \times \T$.  Since for every $A:\T$ the map $1_A : A \to A$ is an equivalence, by $\Id{\T}$-elim we obtain a distinguished map  $\Id{\T}(A, B) \to \mathsf{Equiv}(A, B)$ over $\T \times \T$.  The \emph{univalence axiom} is the statement that this map is itself an equivalence:
\begin{equation}\label{diag:univalence4}
\begin{tikzcd} 
\Id{\T} \ar[d] \ar[r, "{\simeq}"] & \mathsf{Equiv} \ar[d] \\  
 \T \times \T  \ar[r, equals] & \T \times \T
	 \end{tikzcd}
 \end{equation}
 Pulling the equivalence back along any $(A, B) : X \to \T \times \T$ results in the more familiar formulation:
 \[\tag{UA}
 \ (A =_\T B) \, \simeq\, (A \simeq B)\,.
 \]
The interpretation of univalence thus requires at least a universe $\T$ with $1, \Sigma, \Pi, \Id{}$ (in order to define $A\simeq B$), inside a larger universe $\T:\T_1$ also with $1, \Sigma, \Pi, \Id{}$ (in order to have the family $A =_\T B$ and to state the central equivalence in UA), and the operations on the larger universe are usually required to restrict to the corresponding ones on the smaller universe.  
%See \cite{AG:2024} for a detailed presentation.
\end{remark}


 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{5. Extensional ML-algebras}%\label{sec:Free ML-Algebras}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%If we have univalence then they will hold up to identity terms -- once we have defined identity and univalence.
%\ednote{The polynomial laws will hold up to Id types if the universe is univalent.}


Just do the extensional case - using AGH.

Examples include SOC and H-S universes.

Applications: (i) a natural model ML-algebra is tiny, (ii) the nerve preserves ML-algebras.

Mention the intensional case as future work and refer to Aberle-Spivak.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{5. Free ML-algebras}\label{sec:Free ML-Algebras}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%ML-algebra arises from a $\Pi$-clan - but for a clan the $\Sigma$ operation (the monad structure) is not coherent. 
%We can freely add this structure as follows.
%
%There should be a theorem about a display maps being closed under composition if there's a $\Sigma$-algebra structure -- possibly weak a weak one?  Relate to weakening of the Equality-type rules to get the Identity-type rules.
%


 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Acknowledgement}

Thanks to Marcelo Fiore, Nicola Gambino, Richard Garner, and Clive Newstead.  This material is based upon work supported by the Air Force Office of Scientific Research under awards FA9550-21-1-0009 and FA9550-20-1-0305.

\bibliographystyle{alpha}
\bibliography{../references}

%%%
\end{document}
%%%

