%%
% Notes on Algebraic Type Theory
% begun July 2023
%%
%\documentclass[12pt]{article}
\documentclass[12pt,reqno]{amsart}
\usepackage{amsmath,amssymb,amsthm,latexsym}
\usepackage{bm,bbm}
\usepackage[all,cmtip]{xy}
\input{diagxy}
%\CompileMatrices       
\usepackage{url}
%\usepackage{fullpage}
\usepackage[colorlinks=true,linkcolor=blue,anchorcolor=blue,citecolor=blue,filecolor=blue,urlcolor=blue]{hyperref}

\newcommand{\ednote}[1]{[\textit{\color{red}{#1}}]} % editorial note

% categories
\newcommand{\cattwo}{\ensuremath{\mathbbm{2}}}
\newcommand{\A}{\ensuremath{\mathbb{A}}}
\newcommand{\B}{\ensuremath{\mathbb{B}}}
\newcommand{\C}{\ensuremath{\mathbb{C}}}
\newcommand{\D}{\ensuremath{\mathbb{D}}}
\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Th}{\ensuremath{\mathbb{T}}}
\renewcommand{\AA}{\ensuremath{\mathcal{A}}}
\newcommand{\BB}{\ensuremath{\mathcal{B}}}
\newcommand{\CC}{\ensuremath{\mathcal{C}}}
\newcommand{\DD}{\ensuremath{\mathcal{D}}}
\newcommand{\EE}{\ensuremath{\mathcal{E}}}
\newcommand{\FF}{\ensuremath{\mathcal{F}}}
\newcommand{\WW}{\ensuremath{\mathcal{W}}}

\newcommand{\op}[1]{\ensuremath{{#1}^{\mathsf{op}}}}
\newcommand{\pshx}[1]{\ensuremath{\mathsf{Set}^{\op{#1}}}}
\newcommand{\psh}[1]{\ensuremath{[\op{#1},\mathsf{Set}]}}
\newcommand{\pshat}[1]{\ensuremath{\widehat{#1}}}

\newcommand{\Set}{\ensuremath{\mathsf{Set}}}
\newcommand{\set}{\ensuremath{\mathsf{set}}}
\newcommand{\Cat}{\ensuremath{\mathsf{Cat}}}
\newcommand{\cat}{\ensuremath{\mathsf{cat}}}
\newcommand{\Pos}{\ensuremath{\mathsf{Pos}}}
\newcommand{\pos}{\ensuremath{\mathsf{pos}}}
\newcommand{\covpshx}[1]{\ensuremath{\mathsf{Set}^{#1}}}
\newcommand{\cSet}{\ensuremath{\mathsf{cSet}}}

\newcommand{\Hom}{\ensuremath{\mathsf{Hom}}}
\renewcommand{\hom}{\ensuremath{\mathsf{Hom}}}
\newcommand{\y}{\ensuremath{\mathsf{y}}} % Yoneda embedding
\newcommand{\elem}[1]{\textstyle\int\!{#1}}% category of elements
\newcommand{\colim}{\varinjlim}% colimit with subscript

\newcommand{\FP}{\ensuremath{\mathsf{FP}}}
\newcommand{\ModT}{\ensuremath{\mathsf{Mod}(\T)}}
\newcommand{\TAlg}{\ensuremath{\T\text{-}\mathsf{Alg}}}
\newcommand{\tp}{\ensuremath{\mathsf{tp}}}
\newcommand{\Tm}{\ensuremath{\mathsf{Tm}}}
\newcommand{\Ty}{\ensuremath{\mathsf{Ty}}}

% Algebras
\newcommand{\alg}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\algA}{\ensuremath{\mathsf{A}}}
\newcommand{\algB}{\ensuremath{\mathsf{B}}}
\newcommand{\algC}{\ensuremath{\mathsf{C}}}
\newcommand{\algD}{\ensuremath{\mathsf{D}}}

% arrows
\newcommand{\hook}{\ensuremath{\hookrightarrow}}
\newcommand{\mono}{\ensuremath{\rightarrowtail}}
\newcommand{\ra}{\ensuremath{\rightarrow}}
\newcommand{\cof}{\ensuremath{\rightarrowtail}}
\newcommand{\fib}{\ensuremath{\epi}}
\renewcommand{\to}{\ensuremath{\rightarrow}}
\newcommand{\too}{\ensuremath{\longrightarrow}}

% cubical sets
\newcommand{\I}{\ensuremath{\mathrm{I}}}
\newcommand{\II}{\ensuremath{\mathbb{I}}}
\renewcommand{\H}{\ensuremath{\mathbb{H}}}
\newcommand{\HH}{\ensuremath{\mathcal{H}}}

% type theory
\newcommand{\G}{\ensuremath{\Gamma}}
\newcommand{\defeq}{=_{\mathrm{def}}}
\newcommand{\type}{\mathsf{type}}       
\newcommand{\types}[2]{#1 \vdash #2:\type}
\newcommand{\Gtypes}[1]{\types{\Gamma}{#1}}
\newcommand{\term}[2]{#1\,:\,#2}
\newcommand{\terms}[2]{#1 \vdash #2}
\newcommand{\Gterms}[1]{\terms{\Gamma}{#1}}
\newcommand{\ext}[2]{{#1,#2}}
\newcommand{\ty}{\ensuremath{\,:\,}}
\newcommand{\pair}[1]{\ensuremath{\langle #1\rangle}}
\newcommand{\exdot}{\ensuremath{\!\centerdot\!}}
\newcommand{\texdot}{\ensuremath{\centerdot}}

% Id types
\newcommand{\Id}{\mathsf{Id}}
\newcommand{\id}[1]{\Id_{#1}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\idrec}{\mathsf{idrec}}
\newcommand{\jay}{\mathsf{j}}
\renewcommand{\i}{\mathsf{i}}


% Universes
\newcommand{\U}{\ensuremath{\mathcal{U}}}
\newcommand{\UU}{\ensuremath{\,\dot{\mathcal{U}}}}
%\renewcommand{\t}{\ensuremath{\mathsf{t}}}
\renewcommand{\t}{\ensuremath{\mathsf{t}}}
\newcommand{\tT}{\ensuremath{{\t}:\TT\to\T}}
%\newcommand{\T}{\ensuremath{\mathsf{T}}}
%\newcommand{\TT}{\ensuremath{\dot{\mathsf{T}}}}
\newcommand{\T}{\ensuremath{\mathsf{T}}}
\newcommand{\TT}{\ensuremath{\dot{\mathsf{T}}}}
\newcommand{\V}{\ensuremath{\mathcal{V}}}
\newcommand{\VV}{\ensuremath{\dot{\mathcal{V}}}}
\newcommand{\SSet}{\ensuremath{\,\dot{\Set}}}
\newcommand{\sset}{\ensuremath{\,\dot{\set}}}
\newcommand{\Fib}{\ensuremath{\mathsf{Fib}}}
\newcommand{\FFib}{\ensuremath{\dot{\mathsf{Fib}}}}

% Adjunctions
\newcommand{\adjunction}[2]{%
  \begin{tabular}{c}
    $#1$ \\
    \noalign{
      \vskip 2pt      
      \hrule
      \vskip 1pt      
      \hrule
      \vskip 2pt      
      }
    $#2$
  \end{tabular}
  }

\newcommand{\adjunctionx}[3]{%
  \begin{tabular}{c}
    $#1$ \\
    \noalign{
      \vskip 2pt      
      \hrule
      \vskip 1pt
      \hrule
      \vskip 2pt      
      }
    $#2$ \\
    \noalign{
      \vskip 2pt      
      \hrule
      \vskip 1pt
      \hrule
      \vskip 2pt      
      }
    $#3$
  \end{tabular}
  }

\newcommand{\adjrule}{\noalign{\vskip 2pt \hrule \vskip 1pt \hrule \vskip 2pt}}
\newcommand{\longadjunction}[1]{
\begin{tabular}{>{$}c<{$}}
#1
\end{tabular}
}

% Commutative diagrams in tikz
\usepackage{tikz}
\usepackage{pdfpages}
\usepackage{tikz-cd}

\newcommand{\pbcorner}{\arrow[dr,phantom,"\lrcorner" very near start, shift right=.5ex]} % tikz pullback corners
\newcommand{\ppbcorner}{\arrow[drr,phantom,"\lrcorner" very near start, shift right=.5ex]}
\newcommand{\pbcornerright}{\arrow[dl,phantom,"\llcorner" very near start, shift left=.5ex]} % tikz pullback corners right
\newcommand{\pocorner}{\arrow[dr,phantom,"\ulcorner" very near end]} % tikz pushout corners
\newcommand{\ppocorner}{\arrow[dr,phantom,"\ulcorner" very near end]}

\newcommand{\xypbcorner}[1][dr]{\save*!/#1-1.5pc/#1:(-1,1)@^{|-}\restore}% pullback corner in xypic


% Theorem styles
\newtheorem{theorem}{Theorem}
\newtheorem*{theorem*}{Theorem}
\newtheorem{proposition}[theorem]{Proposition} 
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary} 

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark} 
\newtheorem*{remarks*}{Remarks}
\newtheorem{example}[theorem]{Example}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{Algebraic Type Theory}
\author{Steve Awodey}
\date{\today}
\maketitle

%\begin{abstract}
%\end{abstract}

%\setcounter{tocdepth}{1}
%\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{Introduction}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsection*{1. The Hofmann-Streicher universe}\label{sec:U}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%In \cite{HS:1997} the authors define a (type-theoretic) \emph{universe}  $(U, {\mathcal{E}l})$ 
%\begin{equation}\label{eq:universe}
%E \too U
%\end{equation}
%with $U\in\widehat{\C}$ and $\textstyle\El \in \widehat{\int_\C U}$ as follows. For $I\in\C$, set
% \begin{align}
%	U(I)\ &=\ \Cat\big(\op{\C/_I}, \Set\big) \label{eq:universeob}\\ 
%	%E(I)\ &=\ {\textstyle \coprod_{A\in U(I)}\El(\langle I, A\rangle)}\\
% 	\El(I, A)\ &=\ A(id_I) \label{eq:universeel}
% \end{align}
%with an evident associated action on morphisms.  A few comments are required: 
%%

We begin by recalling from \cite{awodey:NM} the notion of a \emph{natural model} of dependent type theory and its relation to the \emph{categories with families} of \cite{dybjer:CwF}.  Then in section \ref{sec:strictify} it is shown how such models are related to the \emph{clans} and \emph{tribes} of Joyal \cite{Joyal:clan}.  In section \ref{sec:MLalgebra} we abstract the main features of a natural model with the type-formers $\mathsf{1}, \Sigma, \Pi$ to form the notion of a \emph{Martin-L\"of algebra}, the basic theory of which is begun in section \ref{sec:eqandid } with the addition of equality and identity types, and the construction of free algebras in section \ref{sec:free} . 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Natural models of type theory}\label{sec:NaturalModels}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent We write $\widehat{\C} = \psh{\C}$ for the category of presheaves on a small category~$\C$.
%\begin{enumerate}
%
%\item  
In \eqref{A:NM}, a \emph{natural model} of type theory is defined to be a representable natural transformation $\t: \TT\to \T$ of presheaves on a small category $\C$.  When $\C$ is regarded as the category of contexts of a type theory, $\T: \op{\C} \to \Set$ is regarded as the presheaf of types in context, $\TT: \op{\C} \to \Set$ as the presheaf of terms in context, and $\t : \TT\to\T$ as the typing of the terms.   Theorem XX of \emph{op.\ cit.} shows that such a map is equivalent to the notion of a \emph{category with families} (CwF) in the sense of \cite{Dybjer}.  We briefly recall the essentials.

\begin{definition}\label{def:representablenattrans} A natural transformation $p : Y \to X$ of presheaves on a category $\C$  is \emph{representable} if the pullback of $p$ along any element $x: \y{C} \to X$ is representable.
\begin{equation*}
\begin{tikzcd}
 \y{D} \ar[d,swap,"{\y{c}}"] \ar[r,"y"] \pbcorner &  Y \ar[d, "p"]\\
\y{C} \ar[r,swap,"x"]  & X
\end{tikzcd}
\end{equation*}
\end{definition}
We assume a choice of pullback data $c : D \to C$ in $\C$ and $y \in Y(D)$ for all $x\in X(C)$ (but no coherence conditions).

\begin{proposition}[A., Fiore 2013] A representable natural transformation is the same thing as a \emph{category with families} in the sense of Dybjer.
\end{proposition}

We sketch the correspondence from \cite{Awodey:NM}.
Let us write the objects and arrows of \C\ as $\sigma : \Delta \to \Gamma$, giving the \emph{category of contexts and substitutions}.
A CwF is usually defined as a presheaf of \emph{types in context}, 
\[
\Ty : \C^{\mathrm{op}}\to \Set\,,
\]
together with a presheaf of \emph{typed terms in context}, 
\[
\Tm : {\textstyle (\int_{\C}\!\Ty)^{\mathsf{op}}\to \Set }\,.
\]
We reformulate this using the familiar equivalence
\[\textstyle
 \pshx{\C}\!/_{\Ty}\ \simeq\ \pshx{(\int_{\C}\Ty)}
\]
in order to obtain a map $\tp :\Tm \to \Ty$.


Formally, we then interpret:
\begin{align*}
 \Ty(\Gamma) &= \{ A \,|\, \Gamma \vdash A\} \\
 \Tm(\Gamma) &= \{ a \,|\, \Gamma \vdash a:A\} 
\end{align*}
Under the Yoneda lemma we therefore have a bijective correspondence:
\begin{align*}
\Gamma\vdash A\quad &\approx\quad A : \y{\Gamma}\to \Ty  \\
\Gterms{a:A}\quad &\approx\quad  a: \y{\Gamma}\to \Tm  \qquad (\tp\circ a = A)
\end{align*}
as indicated in the following.
\[
\begin{tikzcd}
 	&&  {\Tm} \ar[d,"{\tp}"]\\
\y\Gamma \ar[rru, "a"]   \ar[rr ,swap,  "A"]   && {\Ty}
\end{tikzcd}
\]
%

The action of a substitution of contexts $\sigma : \Delta \to \Gamma$ on types and terms,
\[
\frac{\sigma: \Delta \to \Gamma, \quad \Gamma\vdash a:A}{\Delta\vdash a[\sigma] : A[\sigma]}
\]
is then interpreted simply as composition:
\[
\begin{tikzcd}
 	&&&  {\Tm} \ar[d,"{\tp}"]\\
\y{\Delta} \ar[r,  "\y{\sigma}"] \ar[rrru, bend left = 4ex, "{a[\sigma]}"] \ar[rrr, swap, bend right = 5ex, "{A[\sigma]}"] & \y\Gamma \ar[rru, "a"]   \ar[rr ,swap,  "A"]  && {\Ty}
\end{tikzcd}
\]
%
We may hereafter omit the $\y$ for the Yoneda embedding, letting the Greek letters serve to distinguish representable presheaves and their maps.

The CwF operation of \emph{context extension} 
$$\frac{\quad\Gamma\vdash A\quad}{\ \ \ext{\G}{A}\vdash}$$
is modeled by the representability of $\tp : \Tm\to\Ty$ as follows.
%
Given $\Gamma\vdash A$ we need a new context $\ext{\G}{A}$ together with a substitution $\pi_A : \ext{\G}{A} \to \G$ and a term 
\[
\terms{\ext{\G}{A}}{q_A:A[\pi_A]}\,,
\]
where, the substitution $A[\pi_A]$ is modeled by composition $A[\pi_A] = A\circ \pi_A$.

Let $\pi_A: \ext{\G}{A} \to \G$ be the pullback of $\tp$ along $A$, which exists as an arrow in $\C$ since $\tp$ is representable.
%
\begin{equation}\label{diag:NMpullback}
\begin{tikzcd}
{\ext{\G}{A}} \ar[d,swap, "{\pi_A}"] \ar[r, "{q_A}"] \pbcorner &  {\Tm} \ar[d, "{\tp}"]\\
{\G} \ar[r,swap,"A"]   & {\Ty}
\end{tikzcd}
\end{equation}
%
The map $q_A : \ext{\G}{A}\to\Tm$ arising from the pullback gives the required term $\terms{\ext{\G}{A}}{q_A:A[p_A]}$, since $\tp\circ q_A = A \circ p_A$.
The remaining laws of a CwF follow from the pullback condition on $\eqref{diag:NMpullback}$; see \cite{Awodey:NM}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Modeling the type formers}

Given a natural model $\tT$, we will make extensive use of the associated \emph{polynomial endofunctor}
$\alg{P}_\t : \hat\C \too \hat\C$ (cf.\ \cite{GambinoKoch}), defined by 
\[
\alg{P}_\t = \T_! \circ \t_* \circ \TT^* : \hat{\C}\too\hat{\C}\,,
\] 
\begin{equation*}
\xymatrix{
  \Set^{\C^\mathsf{op}} \ar[d]_{\TT^*} \ar[rr]^{\alg{P}_\t} && \Set^{\C^\mathsf{op}} \\
  \Set^{\C^\mathsf{op}}\!/_{\TT} \ar[rr]_{{\t}_*} && \Set^{\C^\mathsf{op}}\!/_\T \ar[u]_{{\T}_!} 
 }
\end{equation*}

The action of $\alg{P}_\t$ on an object $X$ may be depicted:
\begin{equation*}
\xymatrix{
 X & \ar[l] X\times \TT \ar[d] && \alg{P}_\t(X) \ar[d] \\
	& \TT \ar[rr]_{\t} && \T 
 }\qquad\quad
 \end{equation*}


  We call $\tT$ the \emph{signature} of $\alg{P}_\t$ and briefly recall the following \emph{universal mapping property} from \cite{awodey:NM}.

\begin{lemma}
 For any $p: E \to B$ in a locally cartesian closed category $\EE$, the polynomial functor $\alg{P}_p : \EE \to \EE$ has the following universal property:  for any objects $X, Z \in \EE$, maps $f : Z \to \alg{P}_p (X)$ correspond bijectively to pairs of maps $f_1 : Z \to B$ and $f_2 : Z\times_B E \to Z$, as indicated below.
\begin{equation}\label{diag:polyUMP}
\begin{tikzcd}
&Z \ar[rr,"f"] && \alg{P}_p (X) & \\[-5ex]
\strut \ar[rrrr, equal] &&&& \strut\\[-5ex]
&X & \ar[l,"f_2"] Z\times_B E \ar[d] \ar[r] \pbcorner & E \ar[d, "p"] &\\
&& Z \ar[r,swap,"f_1"] & B &
\end{tikzcd}
\end{equation}
The correspondence is natural in both $X$ and $Z$, in the expected sense.
\end{lemma}

This universal property is also suggested by the conventional type theoretic notation, namely: $$\alg{P}_p (X) = \Sigma_{b:B} X^{E_b}$$
The lemma can be used to determine the signature $p\cdot q$ for the composite $\alg{P}_p \circ \alg{P}_q$ of two polynomial functors, which is again polynomial, and for which we therefore have
\begin{equation}\label{eq:polycomp}
\alg{P}_{p\cdot q} \cong \alg{P}_p \circ \alg{P}_q\,.
\end{equation}
Indeed, let $p : B \to A$ and $q : D \to C$, and consider the following diagram resulting from applying the correspondence \eqref{diag:polyUMP} to the identity arrow,
\[
\langle a, c\rangle = 1_{\alg{P}_p(C)} : \alg{P}_p(C) \to \alg{P}_p(C)\,,
\]
and taking $Q$ to be the indicated pullback.
%
\begin{equation}\label{diag:polyUMP}
\begin{tikzcd}
D \ar[d,swap,"q"] & \ar[l] Q \ar[d] \pbcornerright  \ar[dd, dotted, bend left = 10ex ,near start, "{p\cdot q}"]& & \\
 C  & \ar[l,"c"] \pi^*B \ar[d] \ar[r] \pbcorner & B \ar[d,"p"] \\
&  \alg{P}_p(C) \ar[r,swap,"a"] & A
\end{tikzcd}
\end{equation}
The map $p\cdot q$ is then defined to be the indicated composite,
\[
p\cdot q\ =\ a^*p \circ c^*q\,.
\]
The condition \eqref{eq:polycomp} can then be checked using the correspondence \eqref{diag:polyUMP} (also see \cite{GambinoKoch}).

\begin{definition}\label{def:modelthetypeformers}
A natural model $\tT$ over $\C$ will be said to \emph{model} the type formers $ \mathsf{1}, \Sigma, \Pi$ if there are pullback squares in $\hat{\C}$ of the following form,
%\begin{equation}\label{diag:naturalmodelPiSigma1}
%\begin{tikzcd}
%	1 \ar[r,"*"] \ar[d,swap,"!"] \pbcorner &  \TT \ar[d, "\t"]\\  
%	1 \ar[r, swap,"\mathsf{1}"] & \T
% \end{tikzcd} \qquad \qquad 
% \begin{tikzcd}
%	\TT_2  \ar[r,"\sigma"] \ar[d,swap,"\t\cdot\t"] \pbcorner &  \TT \ar[d, "\t"]\\  
%	\T_2 \ar[r,swap, "\Sigma"] & \T
%	 \end{tikzcd} \qquad \qquad 
%	 \begin{tikzcd}
%	 \alg{P}_\t(\TT) \ar[r,"\lambda"] \ar[d,swap,"\alg{P}_\t(\t)"] \pbcorner &  \TT \ar[d, "\t"]\\  
%	\alg{P}_\t(\T) \ar[r,swap, "\Pi"] & \T
% \end{tikzcd} 
% \end{equation}
%
\begin{equation}\label{diag:naturalmodelPiSigma1}
\begin{tikzcd}
	1 \ar[r] \ar[d] \pbcorner &  \TT \ar[d, "\t"]\\  
	1 \ar[r] & \T
 \end{tikzcd} \qquad \qquad 
 \begin{tikzcd}
	\TT_2  \ar[r] \ar[d,swap,"\t\cdot\t"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\T_2 \ar[r] & \T
	 \end{tikzcd} \qquad \qquad 
	 \begin{tikzcd}
	 \alg{P}_\t(\TT) \ar[r] \ar[d,swap,"\alg{P}_\t(\t)"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\alg{P}_\t(\T) \ar[r] & \T
 \end{tikzcd} 
 \end{equation}
%
where $\t\cdot\t : \dot{\T}_2 \to \T_2$ is determined by $\alg{P}_{\t\cdot\t} \cong  \alg{P}_{\t} \circ \alg{P}_{\t}$ as in \eqref{eq:polycomp}.
\end{definition}

The terminology is justified by the following result from \cite{A:NM}.

%
\begin{theorem}[\cite{Awodey:NM} Theorem XXX]\label{thm:nmcwf}
Let $\tT$ be a natural model. The associated category with families satisfies the usual rules for the type-formers $\mathsf{1}, \Sigma, \Pi$ just if $\tT$ models the same in the sense of Definition \ref{def:modelthetypeformers}.
\end{theorem}

We only sketch the case of $\Pi$-types, but the other type formers will be treated in detail in Section \ref{sec:MLalgebras}.

\begin{proposition}  The natural model $\tT$ models $\Pi$-types just if there are maps $\lambda$ and $\Pi$ making the following a pullback diagram. 
\begin{equation}\label{diag:prod2}
\begin{tikzcd}
\alg{P}_\t(\TT)  \ar[d,swap, "{\alg{P}_\t(\t)}"]   \ar[r, "\lambda"]  \pbcorner &  \TT \ar[d, "{\t}"]\\
\alg{P}_\t(\T)	\ar[r,swap, "{\Pi}"] & \T
\end{tikzcd}
\end{equation}
\end{proposition}
%
\begin{proof}
Unpacking the definitions, we have $\alg{P}_\t(\T) = \Sigma_{A:\T} \T^A $, etc.,  
%\begin{align*}
%\alg{P}_\t(\T) &= \Sigma_{A:\T} \T^A \\
%\alg{P}_\t(\TT) &= \Sigma_{A:\T} \TT^A 
%\end{align*}
so diagram \eqref{diag:prod2} becomes:
\begin{equation*}%\label{diag:prod2}
\begin{tikzcd}
\Sigma_{A:\T} \TT^A \ar[d,swap, "{\Sigma_{A:\T} \t^A}"]  \ar[r, "{\lambda}"] &  \TT \ar[d,"{\t}"] \\
\Sigma_{A:\T} \T^A    \ar[r, swap,"{\Pi}"] & \T
\end{tikzcd}
\end{equation*}
For $\G \in \C$, maps $\G\to \Sigma_{A:\T} \T^A $ correspond to pairs $(A,B)$ with  $A:\G\to \T$ and $B : \ext{\G}{A} \to \T$, and thus to $\G\vdash A$ and $\ext{\G}{A} \vdash B$. Similarly, a map $\G\to \Sigma_{A:\T} \TT^A $ corresponds to a pair $(A,b)$ with $\G\vdash A$ and $\ext{\G}{A} \vdash b : B$, the typing of $b$ resulting from composing with the map 
\[
\Sigma_{A:\T} \t^A : \Sigma_{A:\T} \TT^A \to \Sigma_{A:\T} \T^A\,.
\]
\begin{equation*}%\label{diag:prod2}
\begin{tikzcd}
	& \Sigma_{A:\T} \TT^A \ar[dd]  \ar[rr, "{\lambda}"] &&  \TT \ar[dd,"{\t}"] \\
\G \ar[dr,swap, "{(A,B)}"] \ar[ru, "{(A,b)}"] \ar[urrr, swap, crossing over, "{ \lambda_{A}b }"] \ar[drrr, crossing over, "{ \Pi_{A}B }"] &&& \\
 	& \Sigma_{A:\T}\T^A    \ar[rr, swap,"{\Pi}"] && \T 
\end{tikzcd}
\end{equation*}
The composition across the top is then the term $\G \vdash \lambda_{x:A} b$ , the type of which is determined by composing with $\tp$ and comparing with the composition across the bottom, namely $\G \vdash \Pi_{x:A} B$. In this way, the lower horizontal arrow in the diagram models the \emph{$\Pi$-formation rule}:
\[
\frac{\quad\ext{\G}{A}\vdash B\quad}{\G\vdash \Pi_{x:A} B}
\]
and the upper horizontal arrow, along with the commutativity of the diagram, models the \emph{$\Pi$-introduction rule}:
\[
\frac{\ext{\G}{A}\vdash b:B}{\G\vdash \lambda_{x:A} b : \Pi_{x:A} B}
\]
The square \eqref{diag:prod2} is a pullback just if, for every $(A,B) : \G \to \Sigma_{A:\T}\T^A$ and every $t: \G \to \TT$ with $\tp \circ t = \Pi_A B$, there is a unique $(A,b) : \G \to \Sigma_{A:\T}\TT^A$ with $b:B$ and $\lambda_A b = t$.  In terms of the interpretation, given $\ext{\G}{A} \vdash B$ and $\G\vdash t: \Pi_{x:A} B$, there is a term $\ext{\G}{A}\vdash t':B$ with $\lambda_{x:A}  t' = t$, and $t'$ is unique with this property.  This is just what is provided by the \emph{$\Pi$-elimination rule}:
\[
\frac{{\ext{\G}{A} \vdash B}\qquad {\G \vdash t : \Pi_{x:A}  B} \qquad {\G \vdash x:A}}{{\ext{\G}{A}\vdash t\, x :B}}
\]
in conjunction with the \emph{$\Pi$-computation rules}:
\begin{align*}
\lambda_{x:A} (t\,x) &= t : \Pi_A B\\
(\lambda_{x:A} b)\,x &= b : B
\end{align*}
\end{proof}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{2. Display maps and clans}\label{sec:Clans}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%\ednote{define $\DD_\t$ and show that it is a display map category with ... }
%\medskip
%
%\ednote{given  a display map category $\DD$ with ... define $\alg{d}$ and show that it is ...}
%\medskip
%
%\ednote{the constructions are not mutually inverse but rather adjoint inverse ...}
%
%\medskip
%
%In these terms, we have the following description of the type-constructors $\Pi, \Sigma, \mathsf{1}$:
%Given a natural model 
%\begin{theorem}[\cite{A:NM}, XX]
%Let $\tT$ be a natural model of type theory.  Then 
%\end{theorem}
%
%Note on Strictification and the B-C conditions.
%
%Note on the syntactic natural model of type theory and initiality.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{3. Martin-L\"of algebras}\label{sec:MLalgebras}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Now let $\EE$ be a locally cartesian closed category and $\tT$ any map in~$\EE$. As in the representable case, $\t$ gives rise to a polynomial endofunctor $\alg{P}_\t : \EE\to\EE$, in terms of which we define the following abstraction of the notion of a  natural model.

\begin{definition}\label{def:MLalg}
A \emph{Martin-L\"of algebra} in $\EE$ is a map $\tT$ equipped with structure maps $(*, 1, \sigma, \Sigma, \lambda, \Pi)$ making pullback squares 
\begin{equation}\label{diag:MLalg}
\begin{tikzcd}
	1 \ar[r,"*"] \ar[d,swap,"!"] \pbcorner &  \TT \ar[d, "\t"]\\  
	1 \ar[r, swap,"\mathsf{1}"] & \T
 \end{tikzcd}\qquad \qquad 
 \begin{tikzcd}
	\TT^2  \ar[r,"\sigma"] \ar[d,swap,"\t^2"] \pbcorner &  \TT \ar[d, "\t"]\\  
	\T^2 \ar[r,swap, "\Sigma"] & \T
	 \end{tikzcd} \qquad \qquad 
	 \begin{tikzcd}
	\TT'  \ar[r,"\lambda"] \ar[d,swap,"\t' "] \pbcorner &  \TT \ar[d, "\t"]\\  
	\T' \ar[r,swap, "\Pi"] & \T
 \end{tikzcd} 
 \end{equation}
 where the maps $\t^2$ and $\t'$ are defined in terms of the polynomial endofunctor $$\alg{P}_\t = \T_! \circ \t_* \circ \TT^* : \EE\too\EE$$ as in the foregoing section.
\end{definition}

In place of representability, we may require that $\tT$ be $\emph{tiny}$.

\begin{definition}
 A map $f : A \to B$ in a locally cartesian closed category $\EE$ is \emph{tiny} if it is so as an object in $\EE/_B$, in the sense that  exponentiation by $f$  has a right adjoint $(-)^f \dashv (-)_f$. 
\end{definition}

\begin{lemma}
A map $f : A \to B$ is tiny just if the \emph{pushforward} $f_* : \EE/_A \to \EE/_B$ has a right adjoint,
\[
f_* \dashv f^! : \EE/_B \too \EE/_A\,.
\]
\end{lemma}

\begin{proposition}\label{prop:rep_is_tiny}
If $\C$ has finite limits, $p : Y \to X$ is representable if, and only if, it is \emph{tiny}, in the sense that the \emph{pushforward functor} (the right adjoint to pullback) 
\[
p^* \dashv p_* : \widehat{\C}/_{Y} \longrightarrow \widehat{\C}/_{X}
\]
itself has a \emph{right} adjoint:
\[
p_! \dashv p^*\dashv p_* \dashv  p^!
\]
\end{proposition}

\begin{proof}
The elementary definition \ref{def:representablenattrans} clearly states that, for the category of elements ${\int\!X} \simeq {\y{}/_X}$, the composition functor 
\[\textstyle
{\int\!p} : {\int\!Y} \to {\int\!X}
\]  
has a right adjoint, say ${\int\!p} \dashv ({\int\!p})^\sharp$. Now recall that $\widehat{\C}/{X} \simeq \psh{(\int\!X)}$, so that the precomposition functor $({\int\!p})^* = \psh{({\int\!p})}$ gives rise to a commutative diagram with left and right Kan extensions:
\[\textstyle
({\int\!p})_!\dashv ({\int\!p})^* \dashv ({\int\!p})_*
\]
%
%\begin{equation}\begin{tikzcd}
%\psh{{\int\!Y}} \ar[rr,  "{P_!}"]  &&  \psh{\int\!X} \ar[ll, "{P^*}"] \\
%&& \\
%{\int\!Y} \ar[uu, hook, "{\y{}}"]  \ar[rr, "{p_!}"]  &&  \ar[ll, "{p^*}"]  {\int\!X} \ar[uu, hook, "{\y{}}"]
%\end{tikzcd}\end{equation}
\begin{equation}\begin{tikzcd}
\psh{(\int{\!Y})} \ar[rr,shift right = 1ex,swap, "{\int\!p}_!"]  \ar[rr,shift left = 1ex] &&   \psh{(\int{\!X})} \ar[ll] \\
&& \\
\int{\!Y} \ar[uu, hook, "{\y{}}"]  \ar[rr, swap, "{\int\!p}"]  &&  \int{\!X} \ar[uu, swap,hook, "{\y{}}"]
\end{tikzcd}\end{equation}
%
But since ${\int\!p} \dashv ({\int\!p})^\sharp$ , there is a further right adjoint $({\int\!p})_* \dashv (({\int\!p})^\sharp)_*$ to precomposition with $({\int\!p})^\sharp$.  Moving back across the equivalence $\psh{(\int\!X)} \simeq \widehat{\C}/_{X}$ we obtain the claimed further right adjoint: 
\[
p_! \dashv p^* \dashv p_*\dashv p^! :  \widehat{\C}/_{X} \too \widehat{\C}/_{Y}
\]
%
Conversely, a right adjoint $$\textstyle ({\int\!p})_* \dashv R : \psh{(\int{\!X})} \to \psh{(\int{\!Y})}$$ is easily shown to be induced by precomposing with a right adjoint ${\int\!p} \dashv r : {\int\!X} \to {\int\!Y}$ if $\C$ if has all finite products and idempotents split in $\C$, which is the case if $\C$ has finite limits.
\end{proof}



%
%\begin{proposition}
%Any representable natural transformation $f : A\to B$ between presheaves on a small category $\C$ is a tiny map in $\hat\C$.
%\end{proposition}
%
%\begin{proof}
% See \cite{A:NM}. Briefly, ...
%\end{proof}
%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Polynomial monad}\label{sec:monad}

The correspondence between cartesian squares and cartesian natural transformations of polynomial endofunctors.  

The natural model structure corresponds to a polynomial monad equipped with an algebra structure.  

The equations do not hold, but they do up to iso.  If we have univalence then they will hold up to identity terms -- once we have defined identity and univalence.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{4. Equality and Identity Types}\label{sec:Eq and Id}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Also univalence, and univalent quotients.

Polynomial laws hold up to Id types if the universe is univalent.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{5. Free ML-Algebras}\label{sec:Free ML-Algebras}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

ML-algebra arises from a $\Pi$-clan - but for a clan the $\Sigma$ operation (the monad structure) is not coherent. 
We can freely add this structure as follows.

There should be a theorem about a display maps being closed under composition if there's a $\Sigma$-algebra structure -- possibly weak a weak one?  Relate to weakening of the Equality-type rules to get the Identity-type rules.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{alpha}
\bibliography{../references}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%
\end{document}
%%%




 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{2. An unused adjunction}

For any presheaf $X$ on $\C$, recall that the category of elements is the comma category,
\[\textstyle
\int_\C X\ =\ \yon_\C/_X\,,
\] 
where $\yon_\C : \C \to \psh\C$ is the Yoneda embedding, which we may suppress and write simply $\C/_X$. 
While the category of elements $\int_\C X$ is used in the specification of the Hofmann-Streicher universe $(U, \El)$ at the point \eqref{eq:elements}, the authors seem to have missed a trick  which would have simplified things:\footnote{C.\ Sattler has said that he also knew of this description of the base object $U$ of the Hofmann-Streicher universe $(U, \El)$; presumably, others do as well.}

\begin{proposition}[\cite{G:1983},\S{28}]
The category of elements functor $\int_\C : \widehat\C \too \Cat$ has a right adjoint, which we denote
\[
\nu_\C : \Cat \too \widehat\C\,.
\]
For a small category $\A$, we call the presheaf $\nu_\C(\A)$ the \emph{$\C$-nerve} of $\A$.
\end{proposition}
\begin{proof}
As suggested by the name, the adjunction $\int_\C\! \dashv \nu_\C$ can be seen as the familiar ``realization $\dashv$ nerve'' construction with respect to the covariant functor $\C/- : \C\to\Cat$, as indicated below.
\begin{equation}\label{eq:nerve}\textstyle
\begin{tikzcd}
	 \widehat\C \ar[rr, swap,"\int_\C"] &&  \ar[ll, swap,bend right=20, "{ \nu_\C}"] \Cat\\  
	 \\
	\C \ar[uu, hook, "\yon"] \ar[rruu, swap,"{\C/_{-}}"] &&
 \end{tikzcd}
 \end{equation}
%
In detail, for  $\A\in\Cat$ and $c\in\C$, let $\nu_{\C}(\A)(c)$ be the Hom-set of functors,
\begin{align*}
\nu_\C(\A)(c) &= \Cat\big( {\C/_c}\,,\, \A \big)\,,
\end{align*}
with contravariant action on $h : d\to c$ given by pre-composing a functor $P : {\C/_c}\to\A$  with the post-composition functor
\[
{\C/_h} : {\C/_d}\too {\C/_c} \,.
\]
For the adjunction, observe that the slice category $\C/_c$ is the category of elements of the representable functor $\y{c}$\,,
\[\textstyle
\int_\C\y{c}\ \cong\ \C/_c\,.
\]
 Thus for representables $\y{c}$\,, we have the required natural isomorphism
 \[\textstyle
 \widehat\C\big( \y{c}\,,\, \nu_\C(\A) \big)\ \cong\ \nu_\C(\A)(c)\  =\ \Cat\big( {\C/_c}\,,\, \A \big)\ \cong\ \Cat\big( \int_\C\y{c}\,,\, \A \big)\,.
  \]
For arbitrary presheaves $X$, one uses the presentation of $X$ as a colimit of representables over the index category $\int_\C X$, and the easy to prove fact that $\int_\C$ itself preserves colimits.  Indeed, for any category $\D$, we have an isomorphism in $\Cat$,
\[
\varinjlim_{d\in\D}\,\D/_d \ \cong\ \D\,.
\]
\end{proof}

When $\C$ is fixed, as here, we may omit the subscript from the notation $\yon_\C$ and  $\int_\C$ and $\nu_\C$.  The unit and counit maps of the adjunction $\int \dashv \nu$,
\begin{align*}\textstyle
\eta :&\ \textstyle  X \too \nu{\elem{X}}\,, \\
\epsilon :&\ \textstyle  \elem\nu\A \too \A\,,
\end{align*}
 are as follows.  At $c\in\C$, for $x : \y{c}\ra X$, the functor $(\eta_X)_c(x) : \C/_c \to \C/_X$ is just composition with $x$, 
\begin{equation}\label{eq:eta}
(\eta_X)_c(x) = \C/_x : \C/_c \too \C/_X\,.
\end{equation}
For $\A\in\Cat$, the functor $ \epsilon : \int\nu\A \to \A$ takes a pair $(c\in\C, f : \C/_c \to \A)$ to the object $f(1_c) \in \A$,
\[
\epsilon(c,f) = f(1_c).
\]
\begin{lemma}\label{lemma:natpb}
For any $f : Y\to X$, the naturality square below is a pullback.
\begin{equation}\label{eq:naturality}\textstyle
\begin{tikzcd}
	 Y \ar[d, swap,"f"] \ar[r, "{\eta_Y}"] & \nu{\int\!{Y}} \ar[d, "{ \nu{\int\!{f}}}"]\\  
	X \ar[r, swap,"{\eta_X}"] &   \nu{\int\!{X}}.
 \end{tikzcd}
 \end{equation}
\end{lemma}

\begin{proof}
It suffices to prove this for the case $f : X\ra 1$.  Thus consider the square 
\begin{equation}\label{eq:naturalityobject}\textstyle
\begin{tikzcd}
	 X \ar[d] \ar[r, "{\eta_X}"] & \nu{\int\!{X}} \ar[d]\\  
	1\ar[r, swap,"{\eta_1}"] &   \nu{\int\! 1}.
 \end{tikzcd}
 \end{equation}
Evaluating at $c\in\C$ and applying \eqref{eq:eta} then gives the following square in $\Set$.
\begin{equation}\label{eq:naturalityobjecteval}\textstyle
\begin{tikzcd}
	 Xc \ar[d] \ar[r, "{\C/_{-}}"] & \Cat\big( {\C/_c}\,,\, {\C/_X}\, \big) \ar[d]\\  
	1c\ar[r, swap, "{\C/_{-}}"] &   \Cat\big( {\C/_c}\,,\, \C/_1 \big)
 \end{tikzcd}
 \end{equation}
The image of $*\in 1c$ along the bottom is the forgetful functor $U_c : \C/_c\to \C$, and its fiber under the map on the right is therefore the set of functors $F : {\C/_c}\to {\C/_X}$ such that $U_X\circ F = U_c$, where $U_X : \C/_X\to \C$ is also a forgetful functor. But any such $F$ is easily seen to be uniquely of the form $\C/_{x}$ for $x = F(1_c) : \y{c} \to X$.
\end{proof}

\begin{remark}\label{remark:terminal}
The category of elements of the terminal presheaf $1$ is $\C$ itself, $\elem{1} \cong\C$. So for every presheaf $X$ there is a canonical projection $\elem{X} \to\C$, and the functor  $\int_\C : \widehat\C \to \Cat$ thus factors through the slice category $\Cat/_\C$.
\begin{equation}\label{eq:nerve2}\textstyle
\begin{tikzcd}
	 \widehat\C \ar[rr, "(\int_\C)/_1"] \ar[rrdd, swap, "\int_\C"] 
	 	&& \Cat/_\C \ar[dd, "{\C_!}"] \\  
	 \\
	&& \C 
 \end{tikzcd}
 \end{equation}
 The adjunction $\int_\C\dashv \nu_\C : \Cat \to \widehat\C$ factors as well, but it is the unfactored adjunction that is more useful for the present purpose.
 \end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{3. Classifying families}

For every presheaf $X$ the canonical projection $\elem X \ra\C$ of Remark \ref{remark:terminal} is easily seen to be a discrete fibration.  It follows that for any map $Y\to X$ of presheaves, the associated map $\elem Y \to \elem X$ is also a discrete fibration. 
Ignoring size issues for the moment, recall that discrete fibrations in $\Cat$ are classified by the forgetful functor $\op{\dot{\Set}}\to \op{\Set}$ from (the opposites of) the category of pointed sets to that of sets (cf.~\cite{W:2007}).  For every presheaf $X\in\widehat{\C}$, we therefore have a pullback diagram in $\Cat$,
\begin{equation}\label{eq:classifyuniversecat}\textstyle
\begin{tikzcd}
	 \elem X \ar[d] \ar[r] \pbmark & \op{\dot{\Set}} \ar[d]\\  
	\C \ar[r,swap,"X"] &  \op{\Set}.
 \end{tikzcd}
 \end{equation}
 Using $\elem{1} \cong\C$ and transposing by the adjunction $\int \dashv \nu$ then gives a commutative square in $\widehat{\C}$,
\begin{equation}\label{eq:classifyuniversetype}\textstyle
\begin{tikzcd}
	 X \ar[d] \ar[r] & \nu\op{\dot{\Set}} \ar[d]\\  
	1 \ar[r,swap,"\tilde{X}"] &  \nu\op{\Set}.
 \end{tikzcd}
 \end{equation}

\begin{lemma}
The square \eqref{eq:classifyuniversetype} is a pullback in $\widehat{\C}$. More generally, for any map $Y\ra X$ in $\widehat{\C}$, there is a pullback square 
\begin{equation}\label{eq:classifyuniversefamily}\textstyle
\begin{tikzcd}
	 Y \ar[d] \pbmark \ar[r] & \nu\op{\dot{\Set}} \ar[d] \\  
	X \ar[r] &  \nu\op{\Set}\,.
 \end{tikzcd}
 \end{equation}
\end{lemma}

\begin{proof}
Apply the right adjoint $\nu$ to the pullback square \eqref{eq:classifyuniversecat} and paste the naturality square \eqref{eq:naturality} from Lemma \ref{lemma:natpb} on the left, to obtain the transposed square \eqref{eq:classifyuniversefamily} as a pasting of two pullbacks.
\end{proof}

Let us write $\VV \to \V$ for the vertical map on the right in \eqref{eq:classifyuniversefamily};  that is, let
\begin{align}\label{eq:universedef}\textstyle
\VV\, &=\, \nu\op{\dot{\Set}}\\  
\V\, &=\, \nu\op{\Set}.\notag
 \end{align}
 
 We can then summarize our results so far as follows.

 \begin{proposition}\label{prop:Vclassifies}
The nerve $\VV\to\V$  of the classifier for discrete fibrations $\op\SSet\to\op\Set$, as defined in \eqref{eq:universedef}, classifies natural transformations $Y\to X$ in $\widehat{\C}$, in the sense that there is always a pullback square,
\begin{equation}\label{eq:classifyuniversefamily2}\textstyle
\begin{tikzcd}
	 Y \ar[d] \pbmark \ar[r] & \VV \ar[d] \\  
	X \ar[r,swap, "\tilde{Y} "] &  \V.
 \end{tikzcd}
 \end{equation}
The classifying map $\tilde{Y} : X\to \V$ is determined by the adjunction $\int \dashv \nu$ as the transpose of the classifying map of the discrete fibration $\elem Y\to\elem X$.  
\end{proposition}

The classifying map $\tilde{Y} : X\to \V$ of a given a natural transformation $Y\to X$ is, of course, not in general unique. Nonetheless, we can make use of the construction of $\VV\to\V$ as the nerve of the discrete fibration classifier $\op\SSet\to\op\Set$, for which classifying functors $\C \to \op\Set$ are unique up to natural isomorphism, to infer the following proposition, which plays a role in \cite{Shu:15,GSS:22} and elsewhere.

\begin{proposition}[Realignment]\label{prop:realignment}
Given a monomorphism $c : C\cof X$ and a family $Y\to X$, let $y_c : C \to \V$ classify the pullback $c^*Y\to C$.  Then there is a classifying map $y: X \to \V$ for $Y\to X$ with $y\circ c = y_c$.
%
\begin{equation}\label{diagram:realignment}
\begin{tikzcd}
c^*Y \ar[dd] \ar[rd] \ar[rr] && \VV \ar[dd] \\
& Y \ar[dd] \ar[ru, dotted] & \\
C  \ar[rd, tail,swap, "c"] \ar[rr, near start, "y_c"] && \V  \\
& X \ar[ru, dotted, swap, "y"] &
\end{tikzcd}
\end{equation}
\end{proposition}
%
\begin{proof}
Transposing the realignment problem \eqref{diagram:realignment} for presheaves across the adjunction $\int\dashv \nu$ results in the following realignment problem for discrete fibrations.
\begin{equation}\label{diagram:realignment2}
\begin{tikzcd}
\elem  c^*Y \ar[dd] \ar[rd] \ar[rr] && \op{\dot{\Set}}  \ar[dd] \\
&\elem  Y \ar[dd] \ar[ru, dotted] & \\
\elem  C  \ar[rd, tail,swap, "{\elem  c}"] \ar[rr, near start, "\widetilde{y_c}"] && \op{{\Set}}   \\
& \elem  X \ar[ru, dotted, swap, "\tilde{y}"] &
\end{tikzcd}
\end{equation}
The category of elements functor $\int $ is easily seen to preserve pullbacks, hence monos; thus let us consider the general case of a functor  $C : \C \mono \D$ which is monic in $\Cat$, a pullback of discrete fibrations as on the left below, and a presheaf $E : \C \to  \op{{\Set}}$ with $\elem E \cong \mathbb{E}$ over $\C$. 
\begin{equation}\label{diagram:realignment3}
\begin{tikzcd}
\mathbb{E} \ar[dd] \ar[rd] \ar[rr] && \op{\dot{\Set}}  \ar[dd] \\
& \mathbb{F}  \ar[dd] \ar[ru, dotted] & \\
\C  \ar[rd, tail,swap, "{C}"] \ar[rr, near start, "E"] && \op{{\Set}}   \\
& \D \ar[ru, dotted, swap, "F"] &
\end{tikzcd}
\end{equation}
We seek $F : \D \to  \op{{\Set}}$ with $\elem F \cong \mathbb{F}$ over $\D$ and $F\circ C = E$.  Let $F_0 : \D \to  \op{\Set}$ with $\elem F_0 \cong \mathbb{F}$ over $\D$.  Since $F_0\circ C$ and $E$ both classify $\mathbb{E}$, there is a natural iso $e : F_0\circ C \cong E$.
Consider the following diagram
\begin{equation}\label{diagram:realignment4}
\begin{tikzcd}
\C \ar[dd, tail, swap, "{C}"]  \ar[rr, "e"] && {\op{(\Set^{\cong})}}  \ar[dd,"{p_1}"] \ar[r,swap,"{p_2}"] &  {\op{\Set}} \\
&&&\\
\D  \ar[rr,swap, "F_0"]  \ar[rruu, dotted, swap, "f"] && \op{\Set} & 
\end{tikzcd}
\end{equation}
where $\Set^{\cong}$ is the category of isos in $\Set$, with $p_1, p_2$ the (opposites of the) domain and codomain projections.  There is a well-known weak factorization system on $\Cat$ (part of the ``canonical model structure'') with injective-on-objects functors on the left and isofibrations on the right.  Thus there is a diagonal filler $f$ as indicated.  The functor $F := p_2 f : \D \to \op{\Set}$ is then  the one we seek.
\end{proof}

Of course, as defined in \eqref{eq:universedef}, the classifier $\VV\to\V$ cannot be a map in $\widehat{\C}$, for reasons of size; we now address this.  


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{4. Small maps}
 

Let $\alpha$ be a cardinal number, and call the sets that are strictly smaller than it $\alpha$-\emph{small}.  Let $\Set_\alpha\hook\Set$ be the full subcategory of $\alpha$-small sets.  
Call a presheaf $X : \op{\C} \to \Set$ $\alpha$-small if all of its values are $\alpha$-small sets, and thus if, and only if, it factors through $\Set_\alpha\hook\Set$. Call a map $f:Y\to X$ of presheaves $\alpha$-small if all of the fibers $f_c^{-1}\{ x\} \subseteq Yc$ are $\alpha$-small sets (for all $c\in\C$ and $x\in Xc$). The latter condition is of course equivalent to saying that, in the pullback square over the element $x:\y{c} \to X$, 
\begin{equation}\label{eq:smallmap}\textstyle
\begin{tikzcd}
	 Y_x \ar[d] \pbmark \ar[r] & Y \ar[d, "f"] \\  
	\y{c} \ar[r,swap,"x"] &  X,
 \end{tikzcd}
 \end{equation}
the presheaf $Y_x$ is $\alpha$-small.

% Consider $\Set_\alpha^{\C^{\mathrm{op}}}$, the category of $\alpha$-small set valued presheaves on $\C$.  
% and similarly for the small pointed sets $\SSet_\alpha\hook\SSet$

Now let us restrict the specification \eqref{eq:universedef} of $\VV\to\V$ to the $\alpha$-small sets:
\begin{align}\label{eq:universedefalpha}\textstyle
\VV_\alpha\, &=\, \nu \dot{\Set^{\mathsf{op}}_\alpha}\\  
\V_\alpha\, &=\, \nu \Set^{\mathsf{op}}_\alpha. \notag
 \end{align}
Then the evident forgetful map $\VV_\alpha\to\V_\alpha$ \emph{is} a map in the category $\widehat{\C}$ of presheaves, and it is in fact $\alpha$-small. Moreover, it has the following basic property, which is just a restriction of the basic property of $\VV\to\V$ stated in Proposition \ref{prop:Vclassifies}.

 \begin{proposition}\label{prop:Valphaclassifies}
The map $\VV_\alpha\to\V_\alpha$ classifies $\alpha$-small maps $f:Y\to X$ in $\widehat{\C}$, in the sense that there is always a pullback square,
\begin{equation}\label{eq:classifyuniversefamilyalpha}\textstyle
\begin{tikzcd}
	 Y \ar[d] \pbmark \ar[r] & \VV_\alpha \ar[d] \\  
	X \ar[r,swap, "\tilde{Y}"] &  \V_\alpha.
 \end{tikzcd}
 \end{equation}
The classifying map $\tilde{Y} : X\to \V_\alpha$ is determined by the adjunction $\int \dashv \nu$ as (the factorization of) the transpose of the classifying map of the discrete fibration $\elem X\to\elem Y$. 
\end{proposition}

\begin{proof} If $Y\to X$ is $\alpha$-small, its classifying map $\tilde{Y} : X\to\V$ factors through $\V_\alpha \hook \V$, as indicated below, 
\begin{equation}\label{eq:classifyuniversetype2}\textstyle
\begin{tikzcd}
	 Y \ar[d] \ar[rr, bend left] \ar[r] & \nu\op{\dot{\Set_\alpha}} \ar[d] \ar[r,hook] & \nu\op{\dot{\Set}} \ar[d]\\  
	X \ar[rr, bend right, swap,"\tilde{Y}"] \ar[r] &  \nu\op{\Set_\alpha} \ar[r,hook] &  \nu\op{\Set},
 \end{tikzcd}
 \end{equation}
%
in virtue of the following adjoint transposition,
\begin{equation}\label{eq:adjointtranspose}\textstyle
\begin{tikzcd}
	 \elem Y \ar[d] \ar[rr, bend left] \ar[r] & \op{\dot{\Set_\alpha}} \ar[d] \ar[r,hook] & \op{\dot{\Set}} \ar[d]\\  
	 \elem X \ar[rr, bend right, ] \ar[r]  &  \op{\Set_\alpha} \ar[r,hook]  &  \op{\Set}.
 \end{tikzcd}
  \end{equation}
Note that the square on the right is evidently a pullback, and the one on the left therefore is, too, because the outer rectangle is the classifying pullback of the discrete fibration $\elem Y \to \elem X$, as stated.  Thus the left square in \eqref{eq:classifyuniversetype2} is a pullback.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{5. Examples}

\begin{enumerate}
%
\item Let $\alpha = \kappa$ a strongly inaccessible cardinal, so that $\mathsf{ob}({\Set_\kappa})$ is a Grothendieck universe.  Then the Hofmann-Streicher universe of \eqref{eq:universe} is recovered in the present setting as the $\kappa$-small map classifier
\begin{equation*}
E\, \cong\, \VV_\kappa \too \V_\kappa\, \cong\, U
\end{equation*}
 in the sense of Proposition \ref{prop:Valphaclassifies}.  Indeed, for $c\in\C$, we have 
 \begin{align}
  \V_{\kappa}{c}\ &=\ \nu(\Set^{\mathsf{op}}_\kappa)(c) = \Cat\big( {\C/_c}\,,\, \Set^{\mathsf{op}}_\kappa \big)\  =\ \mathsf{ob}(\widehat{\C/_c})\ =\ U{c} \,.
   \end{align} 
For $\VV_{\kappa}$ we then have,
   \begin{align}\label{eq:veedotc}
   \VV_{\kappa}{c}\ =\ \nu(\SSet^{\mathsf{op}}_\kappa)(c)\ &=\ \Cat\big( {\C/_c}\,,\, \SSet^{\mathsf{op}}_\kappa \big) \notag \\ 
   &\cong\ {\textstyle \coprod_{A\in\V_{\kappa}{c}}\Cat_{{\C/_c}}\big( {\C/_c}\,,\, A^*\Set^{\mathsf{op}}_\kappa \big)}
   \end{align}
   where the $A$-summand in \eqref{eq:veedotc} is defined by taking sections of the  pullback indicated below.
   \begin{equation}\label{eq:pbforindexing}\textstyle
\begin{tikzcd}
	A^*\Set^{\mathsf{op}}_\kappa \ar[d] \ar[r] \pbcorner & \SSet^{\mathsf{op}}_\kappa \ar[d]\\  
	\C/_c \ar[r,swap,"A"] \ar[u, bend left, dotted] \ar[ur, dotted] &  \Set^{\mathsf{op}}_\kappa
 \end{tikzcd}
 \end{equation}
 But $A^*\Set^{\mathsf{op}}_\kappa\ \cong\ {\textstyle \int_{\C/_c}\!A}$ over $\C/_c\,$, and sections of this discrete fibration in $\Cat$ correspond uniquely to natural maps $1\to A$ in $\widehat{{\C/_c}}$.  Since $1$  is representable in $\widehat{{\C/_c}}$ we can continue \eqref{eq:veedotc} by
  \begin{align*}
   \VV_{\kappa}{c}\ &\cong\ {\textstyle \coprod_{A\in \V_{\kappa}{c}}\Cat_{{\C/_c}}\big( {\C/_c}\,,\, A^*\Set^{\mathsf{op}}_\kappa \big)}\\
   	&\cong\ {\textstyle \coprod_{A\in \V_{\kappa}{c}} \widehat{{\C/_c}}(1, A)}\\
	&\cong\ {\textstyle \coprod_{A\in \V_{\kappa}{c}} A(1_c) } \\
	& =\ {\textstyle \coprod_{A\in \V_{\kappa}{c}} \El(\langle c, A\rangle)}\\
	& =\  E c\,.
   \end{align*}
 
\item By functoriality of the nerve $\nu : \Cat \to \widehat{\C}$, a sequence of Grothendieck universes $$\U \subseteq {\U\,}' \subseteq ...$$ in $\Set$ gives rise to a (cumulative) sequence of type-theoretic universes $$\V \mono {\V\,}' \mono ...$$ in $\widehat{\C}$. More precisely, there is a sequence of  cartesian squares,
\begin{equation}\label{eq:Vhierarchy}\textstyle
\begin{tikzcd}
	 \VV \ar[d] \ar[r,tail] \pbmark & {\VV\,'} \ar[d] \ar[r,tail] \pbmark & \dots \\  
	 \V  \ar[r, tail]  &  {\V\,}' \ar[r,tail]  & \dots\,,
 \end{tikzcd}
  \end{equation}
in the image of $\nu : \Cat\too\widehat\C$, classifying small maps in $\widehat\C$ of increasing size, in the sense of Proposition \ref{prop:Valphaclassifies}.

\item Let $\alpha = 2$ so that $1\to 2$ is the subobject classifier of $\Set$, and 
$$\mathbbm{1} = \SSet^{\mathsf{op}}_2 \too  \Set^{\mathsf{op}}_2 = \mathbbm{2}$$ is then a classifier in $\Cat$ for \emph{sieves}, i.e.\ full subcategories $\mathbb{S}\hook\A$ closed under the domains of arrows $a\to s$ for $s\in\mathbb{S}$.  The nerve $\VV_{2}  \to \V_{2}$ is then exactly the subobject classifier $1\to\Omega$ of $\widehat\C$,
\[
1 = \nu \mathbbm{1} = \VV_{2} \too  \V_{2} = \nu \mathbbm{2} = \Omega  \,.
\]

\item Let $i : \mathbbm{2} \hook \Set_\kappa$ and $ p : \Set_\kappa \to \mathbbm{2} $ be the embedding-retraction pair with $i : \mathbbm{2} \hook \Set_\kappa$ the inclusion of the full subcategory on the sets $ \{0, 1\}$ and $p : \Set_\kappa \to \mathbbm{2}$ the retraction that takes $0 = \emptyset$ to itself, and everything else (i.e.\ the non-empty sets) to $1 = \{\emptyset\}$. There is a retraction (of arrows) in $\Cat$,
%
\begin{equation}\label{eq:Setretraction}\textstyle
\begin{tikzcd}
	 \mathbbm{1} \ar[d]  \ar[r,hook] \pbmark & \SSet_\kappa \ar[d] \ar[r] &\mathbbm{1} \ar[d] \\  
	 \mathbbm{2}   \ar[r,hook,swap, "i"]  &  \Set_\kappa \ar[r, swap, two heads, "p"]  & \mathbbm{2} 
 \end{tikzcd}
  \end{equation}
  where the left square is a pullback.  
    
By the functoriality of (\,$\op{-}$ and) $\nu : \Cat \to \widehat{\C}$ we then have a retract diagram in $\widehat\C$, again with a pullback on the left, 
\begin{equation}\label{eq:Vretraction}\textstyle
\begin{tikzcd}
	 1 \ar[d]  \ar[r,hook] \pbmark & \VV_\kappa \ar[d] \ar[r] &1\ar[d] \\  
	 \Omega   \ar[r,hook,swap, "\{-\}"]  &  \V_\kappa  \ar[r, swap, two heads, "{[-]}"]  &  \Omega 
 \end{tikzcd}
  \end{equation}
  where for any $\phi : X\to \Omega$ the subobject $\{\phi\}\mono X$ is classified as a small map by the composite $\{\phi\} : X\to \V_\kappa$\,, and for any small map $A\to X$, the image $[A] \mono X$ is classified as a subobject by the composite $[\alpha] : X\to \V_\kappa \to \Omega$\,, where $\alpha : X\to \V_\kappa$ classifies $A\to X$.  The idempotent composite $$|\!|\!-\!|\!| = \{[-]\} : \V_\kappa  \too \V_\kappa $$ is the \emph{propositional truncation modality} in the natural model of type theory given by $\VV_\kappa\to \V_\kappa$ (see \cite{AGH}).
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{6. Change of base}

Let  $F : \C \to \D$ in $\Cat$ and consider the base change:

\begin{equation}\label{diagram:basechange1}
\begin{tikzcd}
\C \ar[dd, swap, "{F}"]  \ar[rr, hook,"\yon_\C"] && \Set^{\op{\C}}  \ar[dd,swap,shift right=3,"{F_!}"]  \ar[dd,shift left=3,"{F_*}"]\\
&&\\
\D  \ar[rr, hook,swap, "\yon_\D"] && \ar[uu,"{F^*}" description] \Set^{\op{\D}}  
\end{tikzcd}
\end{equation}
How is the universal (small) map $\VV_\C\to \V_\C$ in $\widehat{\C}$ related to $\VV_\D\to \V_\D$ in~$\widehat{\D}$\,?

For each $c\in\C$ we have the sliced functor $F/_{c} : \C/_c \to \D/_{Fc}$ which is the component at $c\in\C$ of a natural transformation $F/ : \C/ \to \D/\circ F$ as functors $\C \to \Cat$.
\begin{equation}\label{diagram:basechange2}
\begin{tikzcd}
\C \ar[dd,swap,"F"] \ar[dd,"{\qquad{\Downarrow\ F/}}"] \ar[rrrd,"{\C/}"] && \\
&&& \Cat \\
\D  \ar[rrru,swap, "{\D/}"] &&&
\end{tikzcd}
\end{equation}
Indeed, for each $h : c \to c'$ there is a commutative square:
\begin{equation}\label{diagram:basechange3}
\begin{tikzcd}
\C/_c \ar[dd, swap, "{F/_{c}}"]  \ar[rr, "{h\circ}"] && \C/_{c'} \ar[dd, "{F/_{c'}}"]  \\
&&\\
\D/_{Fc}  \ar[rr,swap, "{(Fh)\circ}"] && \D/_{Fc'} 
\end{tikzcd}
\end{equation}

The 2-cell $F/ : \C/ \to \D/\circ F$ in \eqref{diagram:basechange2} (left Kan) extends to one,
$$\textstyle \int_F : \int_\C \Longrightarrow \int_\D \circ\,F_!$$
\begin{equation}\label{diagram:basechange4}
\begin{tikzcd}
\widehat\C \ar[dd,swap,"F_!"] \ar[dd,"{\qquad{\Downarrow\ \int_F}}"] \ar[rrrd,"{\int_\C}"] &&& \\
&&& \Cat\,, \\
\widehat\D \ar[rrru,swap, "{\int_\D}"] &&&
\end{tikzcd}
\end{equation}
which has the following 2-categorical mate.
%
$$\textstyle \nu_F : F^*\circ \nu_\D \Longrightarrow \nu_\C$$
\begin{equation}\label{diagram:basechange5}
\begin{tikzcd}
\widehat\C  &&& \\
&&& \ar[lllu,swap,"{\nu_\C}"] \ar[llld,"{\nu_\D}"] \Cat \\
\widehat\D  \ar[uu,"F^*"] \ar[uu,swap,"{\qquad{\Uparrow\ \nu_F}}"] &&&
\end{tikzcd}
\end{equation}
Evaluating at the (small) discrete fibration classifier $\op\sset\to \op\set$, we obtain a commutative square in $\widehat\C$ of the form
\begin{equation}\label{diagram:basechange6}
\begin{tikzcd}
F^*\VV_D \ar[d]  \ar[r, "{\dot{\gamma}}"] & \VV_\C \ar[d]  \\
F^*\V_\D \ar[r,swap, "{\gamma}"] & \V_\C
\end{tikzcd}
\end{equation}
where we have written 
\begin{align*}
\dot{\gamma}\, &=\, (\nu_F)_{\op{\dot{\set}}}\\
\gamma\, &=\, (\nu_F)_{\op{\set}}
\end{align*}
for the components of $\nu_F$.

%
\begin{proposition}[Base change for universes]\label{prop:universebasechange}
For any functor $F: \C\to \D$, the comparison square \eqref{diagram:basechange6} for universes is a pullback in $\widehat\C$.
\end{proposition}
%
For the proof, we require the following.
%
\begin{lemma}\label{lemma:locallyfinal}
For any functor $F: \C\to \D$ and any $c\in\C$, the sliced functor $F/_c: \C/_c \too \D/_{Fc}$ is final.
\end{lemma}
%
\begin{proof}
Recall that a functor $F: \C\to \D$ is by definition \emph{final} if for all $G: \D\to\Set$, the canonical map $\varinjlim G\circ F \to \varinjlim G$ is an iso, and this holds just if, for all $d\in\D$, the comma category $d/_F$ is connected.  Moreover, recall from \cite{Street-Walters-1973} that the \emph{comprehensive} factorization system $(\mathsf{Fin}, \mathsf{dFib})$ on $\Cat$ has the final functors as left orthogonal to the discrete fibrations.  
%Thus it will suffice to show that $F/_c: \C/_c \too \D/_{Fc}$ is left orthogonal to $\mathsf{dFib}$.  
But now note that the slice categories $\C/_c$ and $\D/_{Fc}$ have terminal objects, preserved by $F/_c: \C/_c \too \D/_{Fc}$.  It therefore suffices to observe that the inclusion functor $i : \{1_\C\} \hook \C$ of a terminal object is always final, so the same is true for $F/_c: \C/_c \too \D/_{Fc}$ by a familiar factorization property of the left maps in an orthogonal factorization system.
\end{proof}

\begin{proof}(of Proposition \ref{prop:universebasechange})
Evaluating \eqref{diagram:basechange6} at $c\in \C$ we obtain the following diagram of sets and functions.
%
\begin{equation}\label{diagram:basechange7}
\begin{tikzcd}
\Cat\big( {\D/_{Fc}}\,,\, \sset^{\mathsf{op}} \big) \ar[dd]   \ar[r, equals]  & (F^*\VV_D)c \ar[dd]  \ar[r, "{\dot{\gamma}_c}"] 
	& (\VV_\C)c \ar[dd]  \ar[r, equals] & \Cat\big( {\C/_c}\,,\, \sset^{\mathsf{op}} \big) \ar[dd]    \\
&&&\\
 \Cat\big( {\D/_{Fc}}\,,\, \set^{\mathsf{op}} \big)   \ar[r, equals]  & (F^*\V_\D)c \ar[r,swap, "{\gamma_c}"] 
 	& (\V_\C)c \ar[r, equals] & \Cat\big( {\C/_c}\,,\, \set^{\mathsf{op}} \big)  
\end{tikzcd}
\end{equation}
%
The outer square of this diagram is a pullback exactly if every square as follows has a diagonal filler.
\begin{equation}\label{diagram:basechange8}
%\begin{tikzcd}
%\C/_c \ar[dd,swap, "F/_c"]  \ar[rr] && \SSet^{\mathsf{op}}  \ar[dd]  \\
%&&\\
%\D/_{Fc} \ar[rr] \ar[rruu, dotted] && \Set^{\mathsf{op}}
%\end{tikzcd}
\begin{tikzcd}
\C/_c \ar[d,swap, "F/_c"]  \ar[r] & \sset^{\mathsf{op}}  \ar[d]  \\
\D/_{Fc} \ar[r] \ar[ru, dotted] & \set^{\mathsf{op}}
\end{tikzcd}
\end{equation}
Since the map on the right is the universal small discrete fibration, this condition obtains just in case the map on the left is left orthogonal with respect to all small discrete fibrations (for ``small'' sufficiently large), which holds just if it is a final functor, by the comprehensive factorization system \cite{Street-Walters-1973}. But by Lemma \ref{lemma:locallyfinal}, this is the case for every $c\in\C$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{7. Classifying fibrations}

Given the universal small family $\VV\to \V$ of Proposition \ref{prop:Valphaclassifies}, we can construct a classifier $\UU\to\U$ for any \emph{structured notion of fibration} using the method of \emph{classifying types} developed in \cite{AwodeyCCMC}.  We then consider the behavior of such universal maps under base change.

Suppose that for each object $X$ and family $A\to X$, there is an object $\Fib(A) \ra X$ over $X$ that classifies fibration structures on $A\to X$, in the sense that there is a bijection, natural in $X$, between sections of $\Fib(A) \ra X$ and (some notion of) fibration structures on $A\to X$.
Naturality in $X$ means that $\Fib(A) \ra X$ is stable under pullback, in the sense that for any $f:Y\ra X$, we have two pullback squares:
\begin{equation}\label{diagram:fibstable}
\xymatrix{
f^*A \ar[d] \ar[r]  & A \ar[d]\\
Y \ar[r]_{f} &X\\
\Fib(f^*A) \ar[u] \ar[r] & \Fib(A) \ar[u].
}
\end{equation}
Thus,
\[
\Fib(f^*A) \cong f^* \Fib(A)\,.
\]

It then follows from Proposition \ref{prop:Valphaclassifies} that, if $A\ra X$ is small, then $\Fib(A) \ra X$ is itself a pullback of the analogous object $\Fib(\VV) \ra \V$ constructed from the universal small family $\VV\ra\V$. So again there are two pullback squares,
\begin{equation}\label{diagram:tfib1}
\xymatrix{
A \ar[d] \ar[r]  & \VV \ar[d]\\
X \ar[r] & \V\\
\Fib(A)\ar[u] \ar[r] & \Fib(\VV)\ar[u]\,
}
\end{equation}
where the indicated map $X \to \V$ is the canonical classifier of $A\to X$.

\begin{proposition}\label{prop:classTFib}
There is a \emph{universal small fibration}, 
\[
\UU\too\U.
\]
 Every small fibration $A \ra X$ is a pullback of $\UU\ra\U$ along a canonical classifying map $X\ra \U$.
\begin{equation}\label{diagram:classifytf}
\xymatrix{
A \ar[d] \ar[r]  \xypbcorner & \UU\ar[d]\\
X \ar[r] & \U
}
\end{equation}
\end{proposition}
%
\begin{proof}
We can take 
\[
\U := \Fib(\VV),
\]
which comes with its canonical projection $\Fib(\VV) \ra \V$ as in diagram \eqref{diagram:tfib1}.  Now define $\UU\ra\U$ by pulling back the universal small family,
\[
\xymatrix{
\UU \ar[d] \ar[r] \xypbcorner  & \VV \ar[d] \\
\U \ar[r] & \V.
}
\]
Consider the following diagram, in which all the squares (including the distorted ones) are pullbacks, with the outer vertical one coming from Proposition \ref{prop:Valphaclassifies} and the lower horizontal one from \eqref{diagram:tfib1}.
%
\begin{equation}\label{diagram:classifytf2}
\xymatrix{
&A \ar[ddd] \ar[rrr]   \ar@{.>}[rrd] &&& \VV\ar[ddd]\\
& && \UU \ar[d] \ar[ru]  &\\
\Fib(A) \ar[rd] \ar[rrr] |<<<<<<<<<<<<\hole  &&& \U \ar[rd] &\\
&X \ar[rrr]_{a} \ar@{.>}@/^1pc/[lu]^\alpha \ar@{.>}[rru]_{\alpha'} &&& \V.
}
\end{equation}
%
By assumption, a fibration structure $\alpha$ on $A\ra X$ is a section of $\Fib(A)\to X$, which is the pullback of $\Fib(\VV)=\U$ along the classifying map $a: X \to \V$,
\[
\Fib(A) =  a^*\Fib(\VV) = a^*\U\,.
\]
Such sections therefore correspond uniquely to factorizations $\alpha'$ of $a : X\to\V$, as indicated, which in turn induce pullback squares of the required kind \eqref{diagram:classifytf}.

Finally, observe that the map $\UU\to\U$ has a canonical fibration structure. Indeed, consider the following diagram, in which both squares are pullbacks.
\begin{equation}\label{diagram:fibisfib}
\xymatrix{
\UU \ar[d] \ar[r]  & \VV \ar[d]\\
\U \ar[r] & \V\\
\Fib(\UU) \ar[u] \ar[r] & \Fib(\VV)\ar[u].
}
\end{equation}
Since $\Fib(\VV)$ is the object of fibration structures on $\VV\ra\V$, its pullback $\Fib(\UU)$ is the object of fibration structures on $\UU\ra\U$.
But since $\U = \Fib(\VV)$ by definition, the lower square is the pullback of $\Fib(\VV)\ra \V$ against itself, which does indeed have a distinguished section, namely the diagonal
\[
\Delta : \Fib(\VV) \ra \Fib(\VV)\times_\V\Fib(\VV).
\]
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{8. Change of base for universal fibrations}

Now let  $F : \C \to \D$ in $\Cat$ with $\VV_\C\to \V_\C$ in $\widehat{\C}$ and $\VV_\D\to \V_\D$ in~$\widehat{\D}$, related by the base change geometric morphism $$F_!\dashv F^*\dashv F_* : \widehat{\C} \too \widehat{\D}$$ as in Proposition \ref{prop:universebasechange}, and suppose that we have a structured notion of fibration in $\widehat\C$,  classified by $\UU_\C \to \U_\C$ as in Proposition \ref{prop:classTFib}.  Then we can can transfer a structured notion of fibration to $\widehat{\D}$ by declaring $B\to Y$ to be a fibration in $\widehat{\D}$ just if $F^*B\to F^*Y$ is one in $\widehat\C$; more precisely, we define a \emph{fibration structure} on $B\to Y$ to be one on $F^*B\to F^*Y$.  These structures are classified in $\widehat{\D}$ as follows.

Fibration structures on $F^*B\to F^*Y$ are classified in $\widehat{\C}$ by sections $\sigma$ of $\Fib(F^*B)\to F^*Y$ ,
%
\begin{equation}\label{diagram:changebasefib1}
\xymatrix{
& F^*B \ar[dd] \\
\Fib(F^*B) \ar[rd]  & \\
& F^*Y  \ar@{.>}@/^1pc/[lu]^\sigma .
}
\end{equation}
%
Applying the right adjoint $F_*$ and pulling back along the unit $\eta$, we obtain an object over $Y$ that classifies such sections.
%
\begin{equation}\label{diagram:changebasefib1.5}
\Fib(B) := \eta^*F_*\Fib(F^*B) \too Y
\end{equation}

\begin{equation}\label{diagram:changebasefib2}
\xymatrix{
& B \ar[dd] && F_*F^*B \ar[dd] \\
\eta^*F_*\Fib(F^*B) \ar[rr] \ar[rd]   && F_*\Fib(F^*B) \ar[rd]  & \\
& Y  \ar@{.>}@/^1pc/[lu] \ar[rr]_\eta  \ar@{.>}[ru] &&  F_*F^*Y
}
\end{equation}
%
Indeed, sections of $\Fib(B) \to Y$ correspond bijectively to lifts of the unit $\eta$ across the image $F_*\Fib(F^*B) \to F_*F^*Y $ under $F_*$, which are exactly sections of $\Fib(F^*B) \to F^*Y $.

As before, it suffices to do this construction once in the ``universal case'', %
%
\begin{equation}\label{diagram:changebasefib3}
\xymatrix{
& \VV_\D \ar[dd] && F_*F^*\VV_\D \ar[dd] \\
\eta^*F_*\Fib(F^*\VV_\D) \ar[rr] \ar[rd]   && F_*\Fib(F^*\VV_\D) \ar[rd]  & \\
& \V_\D   \ar[rr]_\eta  &&  F_*F^*\V_\D
}
\end{equation}
%
to obtain the classifying type for fibrations in $\widehat\D$ as (the domain of) the indicated map
\begin{equation}\label{diagram:changebasefib4}
\U_\D := \eta^*F_*\Fib(F^*\VV_\D) \too \V_\D\,.
\end{equation}

\begin{proposition}
Let $\UU_\D \to \U_\D$ be the pullback indicated below,
\[
\xymatrix{
\UU_\D \ar[d] \ar[r] \xypbcorner  & \VV_\D \ar[d] \\
\U_\D \ar[r] & \V_\D.
}
\]
where $\U_\D \to  \V_\D$ is as defined in \eqref{diagram:changebasefib4}.
Then $\UU_\D \to \U_\D$ classifies fibrations in~$\widehat\D$. 
\end{proposition}

\begin{proof}
Proposition \ref{prop:classTFib} applies once we know that $\Fib(-)$ as defined in \eqref{diagram:changebasefib1.5} is stable under pullback.  It clearly suffices to show that, for each $B\to Y$, the horizontal square below is a pullback when $b : Y\to \V_\D$ is the canonical classifying map.
%
\begin{equation}\label{diagram:changebasefib5}
\xymatrix{
& B \ar[dd]  \ar[rr] \xypbcorner && \VV_\D \ar[dd] \\
\Fib(B) \ar[rr] \ar[rd]   && \Fib(\VV_\D) \ar[rd]  & \\
& Y  \ar[rr]_b  &&  \V_\D
}
\end{equation}

\[
\Fib(B) \cong b^*\Fib(\VV_\D)
\]
%
Inspecting the definitions \eqref{diagram:changebasefib1.5} and \eqref{diagram:changebasefib4}, this follows from the naturality of the units $\eta$,
\begin{equation}\label{diagram:changebasefib5.1}
\xymatrix{
Y  \ar[d]_b \ar[rr]^\eta && F_*F^*Y \ar[d]^{F_*F^*b} \\
\U_\D \ar[rr]_\eta && F_*F^*\V_\D.
}
\end{equation}
Indeed, consider the following cube, in which the front face is the naturality square \eqref{diagram:changebasefib5.1} and the top and bottom faces are the defining pullbacks \eqref{diagram:changebasefib2} and \eqref{diagram:changebasefib3} of $\Fib(B)$ and $\U_\D = \Fib(\VV_\D)$ respectively.
%
\begin{equation}\label{diagram:changebasefib5.5}
\xymatrix{
\Fib(B) \ar@{=}[r] \ar[ddd] & \eta^*F_*\Fib(F^*B) \ar[ddd] \ar[rr] \ar[rd]   && F_*\Fib(F^*B) \ar[ddd] |<<<<<<<<<<<<\hole  \ar[rd]  & \\
&& Y \ar[ddd]_b  \ar[rr]^<<<<<<<<<<<<<<{\eta} && F_*F^*Y \ar[ddd]^{F_*F^*b} \\
&&&& \\
\Fib(\VV_\D) \ar@{=}[r] & \eta^*F_*\Fib(F^*\VV_\D) \ar[rr] |<<<<<<<<<<<<\hole  \ar[rd]   && F_*\Fib(F^*\VV_\D) \ar[rd]  & \\
&& \V_\D   \ar[rr]_\eta &&  F_*F^*\V_\D
}
\end{equation}
%
It suffices to show that the right face is a pullback, and since $F_*$ preserves pullbacks it therefore suffices to show that the horizontal square below is a pullback.
%
\begin{equation}\label{diagram:changebasefib8}
\xymatrix{
&F^*B \ar[dd] \ar[rr]  \xypbcorner && F^*\VV_\D\ar[dd]\\
\Fib(F^*B) \ar[rd] \ar[rr] |<<<<<<<<<<<<<<\hole  && \Fib(F^*\VV_\D) \ar[rd] &\\
&F^*Y \ar[rr]_{F^*b}  && F^*\V_\D.
}
\end{equation}
But that follows from the stability of $\Fib$ in $\widehat\C$ and preservation by $F^*$ of the classifying pullback square for $B\to Y$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Acknowledgement}

Thanks to Mathieu Anel, Thierry Coquand, Marcelo Fiore, and Emily Riehl for discussions, and to Evan Cavallo, Ivan Di Liberti, and Taichi Uemura for help with the references. This material is based upon work supported by the Air Force Office of Scientific Research under awards FA9550-21-1-0009 and FA9550-20-1-0305.

\bibliographystyle{alpha}
\bibliography{../references}

%%%
\end{document}
%%%

