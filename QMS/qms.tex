%%
% Model structure on the cartesian cubes
% Begun March 2018
%%
\documentclass[11pt]{article}
\usepackage{amsmath}
\usepackage{amssymb,latexsym}
\usepackage{amsthm}
\usepackage{bm}
\usepackage{bbm}
\input{prooftree}
\usepackage[all,cmtip]{xy}
\input{diagxy}
\CompileMatrices       
\usepackage{url}
%\usepackage{pdfpages}


% categories
\newcommand{\bbtwo}{\ensuremath{\mathbbm{2}}}
\newcommand{\C}{\ensuremath{\mathbb{C}}}
\newcommand{\D}{\ensuremath{\mathbb{D}}}
\newcommand{\B}{\ensuremath{\mathbb{B}}}
\newcommand{\T}{\ensuremath{\mathbb{T}}}
\newcommand{\CC}{\ensuremath{\mathcal{C}}}
\newcommand{\BB}{\ensuremath{\mathcal{B}}}
%\newcommand{\EE}{\ensuremath{\mathcal{E}}}
\newcommand{\psh}[1]{\ensuremath{\mathsf{Set}^{#1^{\mathrm{op}}}}}
\newcommand{\Set}{\ensuremath{\mathsf{Set}}}
\newcommand{\Cat}{\ensuremath{\mathsf{Cat}}}
\newcommand{\covpsh}[1]{\ensuremath{\mathsf{Set}^{#1}}}
%\renewcommand{\to}{\ensuremath{\rightarrow}}
\newcommand{\pocorner}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}
\newcommand{\pbcorner}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\y}{\ensuremath{\mathsf{y}}} % Yoneda embedding
\newcommand{\Hom}{\ensuremath{\mathrm{Hom}}}
\renewcommand{\hom}{\ensuremath{\mathrm{Hom}}}
\newcommand{\plusalg}[1]{\ensuremath{^+\!\mathsf{Alg}{(#1)}}}
\newcommand{\plusalgx}{\ensuremath{^+\!\mathsf{Alg}}}


% arrows
\newcommand{\hook}{\ensuremath{\hookrightarrow}}
\newcommand{\mono}{\ensuremath{\rightarrowtail}}
%\newcommand{\epi}{\ensuremath{\twoheadrightarrow}}


% cubical sets
\newcommand{\I}{\ensuremath{\mathrm{I}}}
\renewcommand{\H}{\ensuremath{\mathbb{H}}}
\newcommand{\HH}{\ensuremath{\mathcal{H}}}

% type theory
\newcommand{\G}{\ensuremath{\Gamma}}
\newcommand{\defeq}{=_{\mathrm{def}}}
\newcommand{\type}{\mathsf{type}}       
\newcommand{\types}[2]{#1 \vdash #2:\type}
\newcommand{\Gtypes}[1]{\types{\Gamma}{#1}}
\newcommand{\term}[2]{#1\,:\,#2}
\newcommand{\terms}[2]{#1 \vdash #2}
\newcommand{\Gterms}[1]{\terms{\Gamma}{#1}}
\newcommand{\ext}[2]{{#1\!\centerdot\! #2}}
\newcommand{\ty}{\ensuremath{\,:\,}}
\newcommand{\pair}[1]{\ensuremath{\langle #1\rangle}}
\newcommand{\exdot}{\ensuremath{\!\centerdot\!}}
\newcommand{\texdot}{\ensuremath{\centerdot}}

% Id types
\newcommand{\Id}{\mathsf{Id}}
\newcommand{\id}[1]{\Id_{#1}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\idrec}{\mathsf{idrec}}
\newcommand{\jay}{\mathsf{j}}
\renewcommand{\i}{\mathsf{i}}

% Universe
\newcommand{\U}{\ensuremath{\mathcal{U}}}
\newcommand{\UU}{\ensuremath{\widetilde{\mathcal{U}}}}

% theorem styles
\newtheorem{theorem}{Theorem}
\newtheorem*{theorem*}{Theorem}
\newtheorem{proposition}[theorem]{Proposition} 
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary} 

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark} 
\newtheorem*{remarks*}{Remarks}
\newtheorem{example}[theorem]{Example}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{A model structure on the cartesian cubical sets}

\maketitle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent

\section{The cartesian cube category}

We consider the cartesian cube category  $\mathbb{C}$, defined as the free finite product category on an interval $\delta_0, \delta_1 : 1\rightrightarrows \I$.
As a classifying category for an algebraic theory $\mathbb{T} = \{0, 1\}$, $\C$ has a covariant presentation by Lawvere duality, namely as the dual of the full subcategory of finitely-generated, free $\mathbb{T}$-algebras $\mathsf{Alg}(\mathbb{T})_{\mathrm{fg}}$.  In this case, the algebras are simply \emph{bipointed sets} $(A, a_0, a_1)$, and the free ones are the \emph{strictly} bipointed sets $a_0\neq a_1$.  Thus $\mathsf{Alg}(\mathbb{T})_{\mathrm{fg}}$ consists of the finite, strictly bipointed sets and all bipointed maps between them.  

\begin{definition}
The objects of the cartesian cube category $\C$ are themselves called cubes, and will be written $$[n] = \{x_1, ..., x_n\},$$ where the $x_i$ may be regarded as coordinate axes.  The arrows,
\[
f : [n] \to [m]\,,
\]
are then taken to be $m$-tuples of elements drawn from the set $$[n]^+ = \{0, x_1, ..., x_n, 1\},$$ regarded as formal terms representing composites of faces, degeneracies, permutations, and diagonals (alternately, the arrows are arbitrary bipointed maps $[m]^+\to [n]^+$).
\end{definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Cubical sets}


The category $\mathsf{cSet}$ of \emph{cubical sets} is the category of presheaves on the cartesian cube category $\C$.  It is generated by the representable presheaves $y([n])$, which will be written $\I^n = y([n])$
and called the \emph{standard $n$-cubes}.  


\section{Partial map classification and the +-algebra weak factorization system}

Cofibrations, partial map classification, the functor $X^+$, the awfs of +-algebras.

\section{Partial path lifting (biased version)}

Given a type $ P : \I\to \Set$, the type of (0-biased) partial path-lifting structures $L^0(P)$ may be defined in the ``logical style'' of \cite{OP} as:

\begin{equation}\label{eqn:pplift}
L^0(P)\ =\ \prod_{\phi:\Phi}\, \prod_{s: \prod_{i:I}(Pi)^\phi}\, \prod_{a_0:P0}\ a_0 | \phi = s0\ 
 \to\sum_{a:\prod_{i:I}Pi} (a0 = a_0) \times (a | \phi = s)\,.
\end{equation}

The data involved in this type can be represented as follows:
\begin{equation}\label{diagram:ppl}
\xymatrix{
& P0 \ar[rr] \ar[dd] |\hole  & & P \ar[dd] \\
[\phi] \ar[ru] ^{s0} \ar[rr] \ar@{ >->}[dd] & & [\phi]\!\times\!\I \ar[ru]^s \ar@{ >->}[dd] & \\
& 1 \ar[rr]_<<<<<<<<<{\delta_0} |>>>>>>>>>>>>>>>\hole & & \I \\
\I^n \ar[ru] \ar[rr] \ar[ruuu]|>>>>>>>>>>>>>\hole _{a_0} & & \I^n\!\times\!\I \ar@{.>}[ruuu] _a \ar[ru]_{\pi_2} & }
\end{equation}
Here the left-hand vertical square is  understood to be a pullback of the right-hand one along the chosen endpoint $\delta_0 : 1 \to \I$ (the ``bias'').

Now write 
\[
\widetilde{P}\ =\ \prod_{i:I}Pi
\]
for the type of sections of the projection $P = \sum_{i:I}Pi \to \I$, and write
\[
\pi_0 : \widetilde{P} \to P0
\]
for the $0^{th}$-projection (i.e.\ the evaluation of $P : \I\to\Set$ at $0:\I$).

Then the (0-biased) partial path-lifting structures on $P$ correspond to $+$-algebra structures on the projection $\pi_0 : \widetilde{P} \to P0$, as follows.

\begin{proposition}
For any $ P : \Set^\I$, there is an isomorphism
\[
L^0(P)\ \cong\ \plusalg{\pi_0 : \widetilde{P} \to P0}\,.
\]
\end{proposition}
\begin{proof}
Consider the following diagram,
\begin{equation}\label{diagram:pplext}
\xymatrix{
&  {\widetilde{P}} \ar[rr] \ar[dd] ^{\pi_0} & &  {\widetilde{P}}\times\I \ar[dd]^{\varepsilon} \\
&&& \\
& P0 \ar[rr] |>>>>>>>>>>\hole \ar[dd] |\hole & & P \ar[dd] \\
[\phi] \ar[ruuu]^>>>>>>>>>>>>{\overline{s}_0} \ar[ru]^>>>>{s0} \ar[rr] \ar@{ >->}[dd] & & [\phi]\!\times\!\I \ar[ruuu]^>>>>>>>>>>>>>{\overline{s}} \ar[ru]^>>>>>>>s \ar@{ >->}[dd] & \\
& 1 \ar[rr]_<<<<<<<<<{\delta_0} |>>>>>>>>>>>>>>>>>>\hole & & \I \\
\I^n \ar[ru] \ar[rr] \ar[ruuu]|>>>>>>>>>>>>>\hole _{a_0} & & \I^n\!\times\!\I \ar@{.>}[ruuu] _a \ar[ru]_{\pi_2} & }
\end{equation}
which is \eqref{diagram:ppl}, extended by the counit (evaluation) $\varepsilon : \widetilde{P}\times \I \to P$ over $\I$ on the right.  The pullback of $\varepsilon$ over $\I$ along $\delta_0$ is just $\pi_0 : \widetilde{P} \to P0$.  

Given an $L^0(P)$-structure we construct a $\plusalgx$-structure on $\pi_0 : \widetilde{P} \to P0$ as follows: for any $\I^n$ and cofibration $i_\phi : [\phi]\mono \I^n$ and any commutative square,
\[
\xymatrix{
[\phi] \ar@{>->}[d]_{i_\phi} \ar[rr]^{s} & & {\widetilde{P}}  \ar[d]^{\pi_0} \\
\I^n \ar[rr]_{a_0} && P0\,,
}
\]
we require a diagonal filler,
\[
\xymatrix{
[\phi] \ar@{>->}[d]_{i_\phi} \ar[rr]^{s} & & {\widetilde{P}}  \ar[d]^{\pi_0} \\
\I^n \ar[rr]_{a_0} \ar@{ .>}[rru]_j && P0\,,
}
\]
uniformly in $\I^n$ and $\phi$\,.  Transposing the span formed by $i_\phi$ and $s$ along the adjunction $\I^* \dashv \prod_{\I}$ gives the right-hand square in \eqref{diagram:pplex}, and the commutative square formed by $a_0$ and $\pi_0$ gives the rest of the data in that diagram. Thus the $L^0(P)$-structure gives an $a : \I^n\times\I\to P$ as indicated.  Looking at \eqref{diagram:pplext}, we see that $a$ lifts across $\varepsilon$ to a unique map $\overline{a} : \I^n\times\I\to \widetilde{P}\times\I$ over \I, by the universal property of $\varepsilon : \widetilde{P}\times\I \to P$.  We can therefore set $$j = \delta_0^*( \overline{a}) : \I^n \to \widetilde{P}\,.$$

Suppose conversely that we have a $\plusalgx$-structure on $\pi_0 : \widetilde{P} \to P0$, and we want to build a (0-biased) partial path-lifting structure on $P$.  Take any $\I^n, \phi, s, a_0$ as indicated and we require an $a : \I^n\times\I\to P$ over $\I$.    From $s$ we get $\overline{s}$ by the universal property of $\varepsilon$, and therefore we get $\overline{s}_0$ by pullback.   From $\overline{s}_0$ and $a_0$ and the $\plusalgx$ structure on $\pi_0$ we get a map $j : \I^n \to \widetilde{P}$ over $P0$ which is a diagonal filler of the indicated square formed by $i_\phi, \overline{s}_0, a_0$ and $\pi_0$.  We then get the required map $a : \I^n\times\I\to P$ over $\I$ as the ($\I^* \dashv \prod_{\I}$)-transpose of $j$,
\[
a = \varepsilon \circ(j\times\I)\,.
\]

We leave to the reader the verification that these assignments are mutually inverse.
\end{proof}


\[
\xymatrix@=3em{
& B_1 \ar[dd] |\hole ^>>>>>>>{q} & &\\
\cdot \ar[ru] \ar[dd]_{q_X} \ar[rr] && \ar[lu] G \ar[dd]^{q'} & \\
& B_0 & &\\
X\times_{A_0} A_1\ar[ru]^{b} \ar[d]_{p_X}  \ar[rr]_{\overline{b}\times_{A_0}A_1} && \ar[lu]_{\mathrm{ev}} B_{0}^{A_1} \times_{A_0} A_1 \ar[d]^{p'} \ar[r] & A_1 \ar[d]^{p}\\
X \ar@/^8ex /[uuu]^{(a',b')} \ar[rr]^{\overline{b}} \ar@/_5ex /[rrr]_{a} && B_0^{A_1} \ar[r]  & A_0}
\]


\[
\xymatrix{
B_1 \ar[d] ^{q} & &\\
B_0 &  \ar[lu]  \ar@/_8ex/ [dd] G \ar[d]^{q'} & \\
& \ar[lu] |<<<<<<\hole B_{0}^{A_1} \times_{A_0} A_1 \ar[d]^{p'} \ar[r] & A_1 \ar[d]^{p}\\
& B_0^{A_1} \ar[r]  & A_0.}
\]

\section{Unbiased partial path lifting}



\end{document}



In particular, the standard $1$-cube is $\I = y([1])$, and the standard $0$-cube is $\I^0 = y([0])=1$.  For any cubical set $X: \H^\mathrm{op} \to \Set$, we shall write $X_n = X([n])$ and call this the \emph{set of $n$-cubes in $X$}.  For these, we have the usual Yoneda correspondence:
\[
(c \in X_n ) \ \cong\ (c : \I^n \to X).
\]
In particular $\I^n_m = \H([m],[n])$ is the set of $m$-cubes in the standard $n$-cube.
\end{definition}

%%
\begin{proposition}
We now have $\I^n \times \I^m \cong \I^{n+m}$, in virtue of the preservation of products by the Yoneda embedding.
\end{proposition}

%%
\begin{proposition}
The category $\HH$ of hypercubical sets is the classifying topos for \emph{strictly} bipointed objects.  A strictly bipointed object in a topos $\mathcal{E}$ is an object $A$ together with points $a_0, a_1 : 1\to A$, with the property that the equalizer $[a_0 = a_1] \to 1$ is isomorphic to $0\to 1$.
\end{proposition}

\begin{proof}
Consider the covariant presentation $\HH = \Set^\B$, where as in \ref{subsubsec:covariant}, $\B$ is the category of finite, strictly bipointed sets and bipointed maps, now written simply $f: [m]\to [n]$ (i.e.\ dropping the special covariant notation $[n]^+$).  We can extend $\B\to\B_=$ by freely adjoining coequalizers, making $\B_=$ the free finite \emph{colimit} category on a co-bipointed object. An explicit presentation of $\B_=$ is as the finite bipointed sets, including those with $0=1$.  Write $(n)$ for the bipointed set $\{x_1, ..., x_n, 0=1\}$, with $n$ (non-constant) elements and a further element $0=1$.  There is an evident coequalizer $[1]\rightrightarrows [n]\to(n)$, which just identifies the distinguished points $0$ and $1$, and every coqualizer has either the form $[m]\rightrightarrows [n]\to [k]$ or $[m]\rightrightarrows [n]\to(k)$, for a suitable choice of $k$.  Note that there are no maps of the form $(m)\to [n]$, and that every map $[m]\to (n)$ factors uniquely as $[m]\to (m)\to (n)$ with  $[m]\to(m)$ the coequalizer of $0$ and $1$.  Thus the category $\B_=$ can be decomposed into two ``levels'', the upper one of which is essentially $\B$, the lower one consisting of just the objects $(n)$ and thus essentially the finite \emph{pointed} sets, and for each $n$, there is the canonical map $[n]\to(n)$ going from top to bottom:
\[
\xymatrix{
\dots \ar[r] & [m] \ar@{->>}[d] \ar[r] & [n] \ar@{->>}[d] \ar[r] & \dots \\
\dots \ar[r] & (m) \ar[r] & (n) \ar[r] & \dots
}
\]
Write $u : \B\to\B_=$ for the inclusion, which is the classifying functor of generic co-bipointed object in $\B_=$.  We are interested in the induced geometric morphism
\[
\xymatrix{
\Set^\B \ar@<-2ex>[rr]_{u_!} \ar@<2ex>[rr]^{u_*} && \ar[ll]|-{\,u^*} \Set^{\B_=}  & u_! \dashv u^* \dashv u_*
}
\]
Since $u^*$ is restriction along $u$, the right adjoint $u_*$ must be ``prolongation by $1$'',
\begin{align*}
u_*(P)[n] &= P[n],\\
u_*(P)(n) &= \{*\},
\end{align*}
with the obvious maps,
\[
\xymatrix{
\dots \ar[r] & P[m] \ar@{->>}[d] \ar[r] & P[n] \ar@{->>}[d] \ar[r] & \dots \\
\dots \ar[r] & \{*\} \ar[r] & \{*\} \ar[r] & \dots
}
\]
as is easily seen by considering maps in $\Set^{\B_=}$ of the form
\[
\xymatrix{
 Q[n] \ar[d]_{\cdot} \ar[r] & P[n] \ar@{->>}[d]^{\cdot} \\
 Q(n) \ar[r]^{} & \{*\} .
}
\]
Since $u_* : \Set^{\B} \to \Set^{\B_=}$ is evidently full and faithful, it is the inclusion part of a sheaf subtopos $\mathsf{sh}(\B^\mathsf{op}_=, j) \hook \Set^{\B_=}$ for a suitable Grothendieck topology $j$ on $\B^\mathsf{op}_=$.  We claim that $j$ is the closed complement topology of the subobject $[0=1] \rightarrowtail 1$ represented by the coequalizer $[0]\to (0)$.  Indeed, in $\Set^{\B_=}$ we have the representable functors:
\begin{align*}
\I &= y[1],\\
1 &= y[0],\\
[0=1] &= y(0)
\end{align*}
fitting into an equalizer $[0=1] \to 1 \rightrightarrows \I$ which is the image under Yoneda of the canonical coequalizer $[1] \rightrightarrows [0]\to (0)$ in $\B_=$.  The closed complement topology for $[0=1] \mono 1$ is generated by the single cover $0\to [0=1]$, which can be described logically as 
forcing the sequent $(0=1 \vdash \bot)$ to hold.  Recall from Proposition 3.53 of \cite{JohnstoneTT} the following simple characterization of the sheaves for a closed topology generated by an object $U\mono 1$: an object $X$ is a sheaf iff $X\times U \cong U$. In the present case, it therefore suffices to show that for any $P:\B_= \to \Set$ we have:
\[
P\times [0=1] \cong [0=1] \quad\text{iff}\quad P(n) = 1\ \text{for all $n$}.
\]
For any object $b\in \B_=$, consider the map
\[
\hom(yb, P\times [0=1] ) \cong \hom(yb, P) \times \hom(yb, [0=1]) \to \hom(yb, [0=1]) .
\]
If $b = [k]$, then $\hom(yb, [0=1]) \cong \hom_{\B_=}((0), [k]) \cong 0$, and so we always have an iso
\[
\begin{split}
\hom(yb, P\times [0=1] ) \cong \hom(yb, P) \times \hom(yb, [0=1])\\
 \cong \hom(yb, P) \times 0 \cong 0.
 \end{split}
\]
If $b = (k)$, then $\hom(y(k), [0=1]) \cong \hom_{\B_=}((0), (k)) \cong 1$, and we have an iso
\[
\begin{split}
\hom(y(k), P\times [0=1] ) \cong \hom(y(k), P) \times \hom(y(k), [0=1]) \\
\cong \hom(y(k), P) \times 1 \cong \hom(y(k), P) \cong P(k).
\end{split}
\]
Thus we will have an iso $P\times [0=1] \cong [0=1] $ iff $P(k) \cong 1$.

We therefore have that the presheaf topos $\Set^\B$ is the closed complement sheaf subtopos of $\Set^{\B_=}$ given by forcing the sequent $0\neq 1$.  Since $\Set^{\B_=}$ is clearly the classifying topos for \emph{arbitrary} bipointed objects, $\HH = \Set^\B$ indeed classifies \emph{strictly} bipointed objects, as claimed.
\end{proof}

%%
\begin{proposition}
The geometric realization functor to topological spaces 
$$R: \HH \to \mathsf{Top}$$
preserves cartesian products, $R(X\times Y) \cong R(X)\times R(Y)$.
\end{proposition}

\begin{proof}
This can be shown directly by standard methods, but it also follows immediately by composing the inverse image of the geometric morphism $\mathsf{sSets} \to \HH$ classifying the $1$-simplex $\Delta(1)$ in simplicial sets, with the geometric realization $\mathsf{sSets} \to \mathsf{Top}$, each of which are known to preserve finite products.
\end{proof}

\begin{definition}
Let $\H\ \to\  \Cat$ be the unique product-preserving functor taking $[1] \mapsto \bbtwo$, where $\bbtwo$ is the ``one arrow category'' $0\rightarrow 1$.  This functor takes $[n] \mapsto \bbtwo^n$ ($n$-fold product in $\Cat$), and maps $[m] \to [n]$  to the corresponding monotone maps of the posets $\bbtwo^n$.  The  \emph{(hypercubical) nerve} functor $$N : \Cat \to \HH$$ is then defined by:
\[
N(\C)_n = \Cat(\bbtwo^n, \C).
\]
Thus $N(\C)_0$ is the set $\C_0$  of objects of \C, and $N(\C)_1 = \C_1$ is the set of arrows, while $N(\C)_2$ consists of all commutative squares, $N(\C)_3$ of all commutative $3$-cubes, etc. 
\end{definition}

\begin{proposition}
The nerve functor $N : \Cat \to \HH$ is full and faithful.
\end{proposition}
\begin{proof}
Given categories $\C$ and $\D$ and functors $F, G : \C\to\D$, suppose $F(f) \neq G(f)$ for some $f : A\to B$ in $\C$.  Take $f^{\sharp} : \bbtwo \to \C$ with image~$f$.  Then $N(F)_1(f^\sharp) = F(f) \neq G(f) = N(G)_1(f^\sharp)$, and so $N(F) \neq N(G) : N(\C)\to N(\D)$.  So $N$ is faithful.

For fullness, let $\varphi : N(\C) \to N(\D)$ be a natural transformation, and define a proposed functor $F : \C\to \D$ by  
\begin{align*}
F_0 = \varphi_0 &: \C_0 = N(\C)_0 \to N(\D)_0 = \D_0\\
F_1 = \varphi_1 &: \C_1 = N(\C)_1 \to N(\D)_1 = \D_1.
 \end{align*}
We just need to show that $F$ preserves identity arrows and composition.
Consider the following diagram.
\[
\xymatrix{
\Cat(\bbtwo^1, \C) = N(\C)_1 \ar[r]^{F_1} & N(\D)_1 = \Cat(\bbtwo^1, \D) \\
\Cat(\bbtwo^0, \C) = N(\C)_0 \ar[u]^{!^*} \ar[r]_{F_0} & N(\D)_0 = \Cat(\bbtwo^0, \D) \ar[u]_{!^*}.
}
\]
Here $!^* : \Cat(\bbtwo^0, \C) \to \Cat(\bbtwo, \C) $ is precomposition with $! : \bbtwo = \bbtwo^1 \rightarrow \bbtwo^0 = \mathbbm{1}$, so the diagram commutes.  But since $! : \bbtwo \rightarrow \mathbbm{1}$ is a functor, $$\C_0 = \Cat(\mathbbm{1}, \C)  \stackrel{!^*}{\to}  \Cat(\bbtwo, \C) = \C_1$$ takes objects in $\C$ to their identity arrows.  Thus $F$ preserves identity arrows.  Similarly, for composition, consider 
\[
\xymatrix{
\Cat(\bbtwo^2, \C) = N(\C)_2 \ar[d]_{d^*} \ar[r]^{\varphi_2} & N(\D)_2 = \Cat(\bbtwo^2, \D) \ar[d]^{d^*} \\
\Cat(\bbtwo, \C) = N(\C)_1  \ar[r]_{F_1} & N(\D)_1 = \Cat(\bbtwo, \D).
}
\]
where $\varphi_2 : N(\C)_2 \to N(\D)_2$ is the action of $\varphi$ on commutative squares of arrows, and $d^* : \Cat(\bbtwo^2, \C) \to \Cat(\bbtwo, \C)$ is precomposition with the diagonal map $d : \bbtwo \rightarrow \bbtwo^2 = \bbtwo\times\bbtwo$, so the diagram commutes.  For any composable pair of arrows $A \stackrel{f}{\to} B \stackrel{g}{\to} C$ in $\C$ there is a commutative square 
\[
\xymatrix{
A \ar[r]^{f} \ar[d]_{f} & B \ar[d]^{g} \\
B  \ar[r]_{g} & C,
}
\]
and the effect of $d^* : \Cat(\bbtwo^2, \C) \to \Cat(\bbtwo, \C)$ on this square is exactly $g\circ f: A\to C$, and similarly for $d^* : \Cat(\bbtwo^2, \D) \to \Cat(\bbtwo, \D)$.  Thus the commutativity of the above diagram implies that $F$ preserves composition.
Since clearly $N(F) = \varphi$, we indeed have that $N$ is also full.
\end{proof}

\begin{proposition}\label{prop:pathobject}
For any hypercubical set $X$, the exponential $X^\I$ can be calculated as the ``shift by one dimension'', 
\[
X^\I(n) \cong X(n+1)\,.
\]
\end{proposition}

\begin{proof}
\[
\begin{split}
X^\I(n) \cong \hom(y[n], X^\I) \cong \hom(\I^n, X^\I)\ \cong\ \hom(\I^n\times \I, X)\\
\cong\ \hom(\I^{n+1}, X)\cong\ \hom(y[n+1], X)\ \cong\ X(n+1).
\end{split}
\]
\end{proof}

\begin{corollary}\label{cor:rightadjpath}
The functor $X \mapsto X^\I$ has a \emph{right} adjoint.
\end{corollary}
\begin{proof}
The functor $X \mapsto X^\I$ is given by precomposition with the ``successor'' functor $S : \H\to\H$ with $S[n] = [n+1]$.  Thus $X^\I([n]) = X(S[n]) = (S^*(X))([n])$.  Precomposition always has a right adjoint $S^* \dashv S_*$, which can be calculated as:
\[
S_*(X)(n) \cong \hom(y[n], S_*X) \cong \hom(S^*(y[n]), X)\ \cong \hom(\H(S(-), [n]), X).
\]
\end{proof}

We need the following fact in order to calculate the right adjoint further.

\begin{lemma}\label{lemma:binomial}
In $\HH$, we have $\I^\I\ \cong\ \I+1$.
\end{lemma}
\begin{proof}
For any $[n] \in \H$ we have:
\[
(\I^\I)(n) \cong \I(n+1) \cong \Hom(\I^{(n+1)},\I)\cong \H([n+1],[1])\cong \B([1], [n+1])\cong n+3.
\]
On the other hand,
\[
(\I+1)(n) \cong \I(n) + 1(n) \cong \Hom(\I^n, \I) + 1 \cong \B([1],[n]) +1 \cong (n+2) +1.
\]
The isomorphism is natural in $n$.
\end{proof}
%
We mention that a similar fact holds for the generic object in the object classifier topos, and in the Schanuel topos, and is used in the theory of ``abstract higher-order syntax'' \cite{Pitts,Fiore}.


\begin{definition}
Let us write
\[
X_\I = S_*(X)
\]
for the right adjoint of the path object functor $X^\I = S^*X$.
\end{definition}

\begin{corollary}
We have the following calculation for the right adjoint $X_\I$:
\begin{align*}
X_\I(n) &\cong \hom(\I^n, X_\I) \\
&\cong \hom((\I^n)^\I, X) \\
&\cong \hom((\I^\I)^n, X) \\
&\cong \hom((\I+1)^n, X) \\
&\cong \hom(\I^n + C^n_{n-1}\I^{n-1} + \dots + C^n_{1}\I+1, X) \\
&\cong X(n) \times X(n-1)^{C^n_{n-1}} \times \dots \times X(1)^{C^n_{1}}\times X(0),
\end{align*}
where $C^n_{k} = \binom{n}{k}$ is the usual binomial coefficient.
\end{corollary}

\begin{corollary}
There is a natural transformation $X_\I \to X$, given by the first projection from $X_\I(n)\cong X(n) \times X(n-1)^{C^n_{n-1}} \times \dots \times X(1)^{C^n_{1}}\times X(0)$.
\end{corollary}

Finally, we observe that that the path object functor $X^\I$ itself, as a left adjoint, preserves all \emph{co}limits.  This does not hold in general in type theory, but will be a special property of the cubical model.  (Cf. Lawvere \cite{ATOM} on the notion of ``tiny'' objects and the ``amazing right adjoint''.)  

\paragraph{Example.} (P.~Aczel)
The cubical set $P$ of polynomials (over the integers, say), is defined by:
\[
P_n = \{ p(x_1,..., x_n)\ |\  \text{polynomials in at most}\  x_1, É, x_n \}
\]
with the evident maps $P_m \to P_n$ for each function $[m] \to [n]$.

This is a ring object in the category of cubical sets, and the interval $\I\ = y[1]$ embeds into $P$.
The same is true for any algebraic theory $\T$ with two constants, such as boolean algebras: there is a cubical $\T$-algebra $A$ and a monic $\I \mono A$.

Let $\C[\I] = \H$ be the cube category, classifying intervals, and $\C[\T]$ the classifying category for $\T$-algebras.  There is an interval $J$ in $\C_\T$  consisting of the generic $\T$-algebra and its two constants.  This $J$ has a classifying functor $J : \C_\I \to \C_\T$, inducing functors on presheaves
\[
J_! \dashv J^* \dashv J_* : \psh{\C_\I} \to \psh{\C_\T}
\]
as usual, where $J_! \circ \y_{\C_\I} =\ \y_{\C_\T} \circ J$,  with $\y$ the respective Yoneda embeddings.

We can calculate:
\begin{equation}
\begin{split}
J^* J_! ( \I )( [n] ) &= J^* J_! ( Y[1] )( [n] )\\
 &= J^* Y( J[1] )( [n] ) = Y( J[1] )( J[n] ) \\
 &= \C_\T( J[n] , J[1] ) = \T\mathrm{-Alg}( J[1] , J[n] ) \\
 &= \T\mathrm{-Alg}( F(1) , F(n) ) = | F(n) |,
\end{split}
\end{equation}
where $F(n)$ is the free $\T$-algebra on $n$ generators.  So in the case of polynomials we indeed have 
$$P = J^* J_! ( \I ).$$
The unit of the adjunction $\I \to J^* J_! ( \I )$ is faithful, since $J$ itself is faithful and therefore the left adjoint $J_!$ is faithful.
$P$ is a ring in $\psh{\C_\I}$ since $J_!(\I)$ is a ring in $\psh{\C_\T}$ and $J^*$ is left exact.

A closely related example is the cubical set of ``boolean polynomials",
\[
B_n = \{ \varphi(p_1, ..., p_n)\ |\ \text{propositional formulas in at most $p_1, ..., p_n$} \}
\]
which is the free boolean algeba $2^n$.  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Identity types and box-filling}

Our next goal is to give an interpretation of the identity types in the category of hypercubical sets \HH\ that uses the path-object $A^\I$ as the identity type for $A$.  This will allow us to take advantage of the  combinatorial description of $A^\I$ given in Proposition \ref{prop:pathobject}.  We need to determine which objects $A$ of \HH\ can be used as types and which maps $B\to A$ can be used as dependent types.  We will show that the conditions expressed by the rules for identity types are related to the familiar ``box-filling'' or Kan-conditions.  The main result of this section is Proposition \ref{prop:main}.

To begin, recall that the usual elimination and computation rules for identity types are equivalent to the combination of the following rules.

\begin{equation}\label{rule:transport}\tag{Transport}
\begin{prooftree}
a,b: A,\quad p:\id{A}(a,b), \quad {x:A}\vdash B(x)\ \type,  \qquad u:B(a)
\justifies
\mathsf{trans}(a,b,p,u) : B(b)
 \end{prooftree}
\end{equation}
with computation rule
\[
\mathsf{trans}(a,a,\refl(a),u) = u : B(a),
\]
%
and
%
\begin{equation}\label{rule:contract}\tag{Contraction}
\begin{prooftree}
a,b: A,\quad p:\id{A}(a,b)
\justifies
\mathsf{con}(a,b,p) : \Id(\langle a,a,\refl(a)\rangle, \langle a,b,p\rangle)
\end{prooftree}
\end{equation}
with computation rule
\[
\mathsf{con}(a,a,\refl(a)) = \refl(\langle a,a,\refl(a)\rangle) : \Id(\langle a,a,\refl(a)\rangle, \langle a,a,\refl(a)\rangle).
\]
The term $\mathsf{con}(a,b,p)$ is in the identity type of $\sum_{x,y:A}\id{A}(x,y)$.  We will often write the transport as $$p_*u := \mathsf{trans}(a,b,p,u).$$

The contraction rule is a condition on the types; it says that the singletons $S(x) = \sum_{y:A}\Id(x,y)$ are all contractible.  The transport rule is a condition on the dependent types; it says that they must respect the identity on the indexing type. 

\begin{proposition}
If the type $A$ satisfies contraction, and the family $$x,y: A, z:\id{A}(x,y)\vdash B(x,y,z)\ \type$$ has transport, then the usual $\Id$-elimination rule will also be satisfied:
\begin{equation}\label{rule:idelim}\tag{$\Id$-Elimination}
\begin{prooftree}
x,y: A, z:\id{A}(x,y)\vdash B(x,y,z)\ \type, \quad
x: A \vdash b(x) : B(x,x,\refl(x))
\justifies
\mathsf{J}(x,y,z,b) : B(x,y,z)
\end{prooftree}
\end{equation}
with computation rule
\[
\mathsf{J}(x,x,\refl(x),b) = b(x) : B(x).
\]
\end{proposition}
\begin{proof}
Let $\mathsf{J}(x,y,z,b) := \mathsf{con}(x,y,z)_*(b(x))$.
\end{proof}

A further condition that will need to hold in order to interpret the rules for identity types is that the type $\id{A}(x,y)$ itself is a dependent type on $A\times A$, and therefore satisfies transport.  From this assumption, one can prove the following strengthening of transport:

\begin{equation}\label{rule:plifting}\tag{Path Lifting}
\begin{prooftree}
a,b: A,\quad p:\id{A}(a,b), \quad {x:A}\vdash B(x)\ \type,  \qquad u:B(a)
\justifies
\mathsf{lift}(a,b,p,u): \Id(\langle a,u \rangle, \langle b, p_*u\rangle )
 \end{prooftree}
\end{equation}
with computation rule
\[
\mathsf{lift}(a,a,\refl(a),u) = \refl(\langle a,u\rangle) : \Id(\langle a,u\rangle, \langle a,u\rangle).
\]
The term $\mathsf{lift}(a,b,p,u)$ is in the identity type of $\sum_{x:A}B(x)$.

Under the intended interpretation in hypercubical sets, path lifting for $x,y:A\vdash\id{A}(x,y)$
already implies contraction for $A$.  Indeed, let $A\in\HH$ and interpret the dependent type $x,y:A\vdash \id{A}(x,y)$ as the path object $A^\I$ with its projection to the two endoints $A^\I \to A\times A$. 

\begin{lemma}
If $A^\I \to A\times A$ satisfies path lifting, then $A$ satisfies contraction.
\end{lemma}

\begin{proof}
Writing $=$ for $\Id$ and reasoning internally in \HH, take any identity $p: x = y$ in $A^\I$, and we need to find an identity $\mathsf{con} : \refl(x) = p$ in $(A^\I)^\I$.  Such an element $\mathsf{con}$ is a 2-cube in $A$ of the form 
\begin{equation}\label{diagram:contfromtrans}
\xymatrix{
x  \ar@{-}[d]_{\refl(x)} \ar@{-}[r]  \ar@{}[rd]|{\mathsf{con}} & x \ar@{-}[d]^{p} \\
x \ar@{-}[r] & y
}
\end{equation}
Let us first transport $\refl(x) : \Id(x,x)$ along the identity term $\langle \refl(x),p\rangle$ in $A\times A$ to obtain $q := \langle \refl(x),p\rangle_*(\refl(x)): \Id(x,y)$, along with a higher cube
\begin{equation}\label{diagram:contfromtransprime}
\xymatrix{
x  \ar@{-}[d]_{\refl(x)} \ar@{-}[r]^{\refl(x)}  \ar@{}[rd]|{\mathsf{con}'} & x \ar@{-}[d]^{q} \\
x \ar@{-}[r]_{p} & y
}
\end{equation}
where $\mathsf{con}'$ is given by $\mathsf{con}' := \mathsf{lift}(\langle \refl(x),p\rangle,\refl(x))$.

Using the fact that $(A^\I)^\I \cong A^{(\I\times\I)}$, we can then apply the twist map $\I_1\times\I_2 \cong \I_2\times\I_1$ to transpose the cube \eqref{diagram:contfromtransprime} into the desired form \eqref{diagram:contfromtrans}.
It remains to check the computation rule 
\end{proof}

In light of the foregoing, we need to interpret dependent types as maps $B\to A$ that have path lifting, and the types themselves as cubical sets $A$ with a path object projection $A^\I \to A\times A$ satisfying that condition.  Moreover, we also want the types to have iterated path objects $\id{\id{A}}$ etc.,  and as dependent types these too should be interpreted as maps with path lifting.  We begin to analyse that condition.

\begin{proposition}\label{prop:pathliftboxfill}
$A^\I \to A\times A$ has path lifting if and only if $A$ has (2-)box filling.
\end{proposition}

In preparation for the proof, we establish some conventions that will be useful in general.
Diagramatically, path lifting means that for any (outer) square of the form
\begin{equation}\label{diagram:pathliftpath}
\xymatrix{
1 \ar[d] \ar[r] & A^\I \ar[d] \\
\I \ar[r] \ar@{..>}[ru] & A\times A
}
\end{equation}
there is a diagonal filler as indicated.  There are two maps $\top, \bot : 1\to \I$, and the path lifting condition is required with each of these cases occurring on the left.

An \emph{open 2-box} in the 2-cube $\I^2$ is by definition a subobject $$\sqcup^2_{j,e} \mono \I^2$$ obtained as the union, in the poset $\mathrm{Sub}(\I^2)$, of all the face maps $\alpha^d_i : \I \mono \I^2$ but one,
\[
\sqcup^2_{j,e}  = \bigcup_{(i,d)\neq (j,e)} \alpha_i^d.
\]
The index $j = 1, 2$ is the coordinate in which the box is open, while $e = \top, \bot$ indicates which face of the box is missing, top or bottom.   Because we are in the symmetric situation, where the product $\I\times \I$ can be twisted, it  will suffice to  consider only  boxes that are open in the first coordinate, since the others can be constructed from those.  Thus we may omit the index $j$, writing $\sqcup^2_e$ for $\sqcup^2_{1,e}$. Moreover, let us write $\sqcup^2 = {\sqcup}^2_\top$ and $\sqcap^2 = {\sqcup}^2_\bot$.  The \emph{(upper and lower) open $n$-boxes} $\sqcup^n, \sqcap^n \mono \I^n$ are defined analogously.

The open 2-box can be constructed as the dotted arrow in the following pushout diagram, in which we write $\partial\I = 1+1 \mono \I$ for the ``boundary'' of the 1-cube $\I$, in anticipation of Definition \ref{def:boundary} below.
\[
\xymatrix{
1\times \partial\I \ar[d] \ar[r]  & 1\times \I \ar[d] \ar@/{}^{1pc}/[rdd] \\
\I \times \partial\I \ar[r] \ar@/{}_{1pc}/[rrd] &  \sqcup^2 \pocorner \ar@{>.>}[rd] \\
 &&  \I\times\I 
}
\]
This is the upper open box determined by the case where $\top : 1\to\I$ is on the far left; the case of $\bot : 1\to\I$ determines the lower open box $\sqcap^2 \mono \I^2$, but we will not always mention this case separately.  

\begin{definition}\label{def:boxfilling}
A cubical set $A$  has \emph{$n$-box filling} if every map to it from an open upper $n$-box extends to the whole $n$-cube,
\[
\xymatrix{
\sqcup^n \ar@{ >->}[d] \ar[r]  & A  \\
\I^n \ar@{ ..>}[ur] 
}
\]
and similarly for the lower box $\sqcap^n \mono \I^n$.  
A map $B\to A$ satisfies \emph{$n$-box filling} if every commutative square of the following form has a diagonal filler,
\[
\xymatrix{
\sqcup^n \ar@{ >->}[d] \ar[r]  & B \ar[d]  \\
\I^n \ar@{ ..>}[ur] \ar[r] & A
}
\]
and similarly for the lower box $\sqcap^n \mono \I^n$.  
\end{definition}

\begin{proof}[Proof of the Proposition]
The 2-box filling condition is clearly equivalent to saying that given any maps $a$ and $b$ commuting with the span in the upper-left corner of the following diagram, there exists a 2-cube $c :  \I\times\I \to A$  making the whole diagram commute.  
\begin{equation}\label{diagram:boxfillingrev}
\xymatrix{
1\times \partial\I \ar[d] \ar[r]  & 1\times \I \ar[d] \ar@/{}^{1pc}/[rdd]^{a} \\
\I \times \partial\I \ar[r] \ar@/{}_{1pc}/[rrd]_{b} & \I\times\I \ar@{.>}[rd]|{c} \\
 &&  A
}
\end{equation}
This formulation eliminates the pushout and replaces the open box by a decomposition.

Now let us rewrite diagram \eqref{diagram:pathliftpath} with the projection from the path object $A^\I \to A\times A$  replaced by
\[
A^i : A^\I \to A\times A \cong A^{1+1} = A^{\partial\I} 
\] 
where $i := [\top, \bot] : \partial \I = 1+1 \to \I$ is the copair, to give:
\begin{equation*}\label{diagram:pathliftpathrev}
\xymatrix{
1 \ar[d] \ar[r] & A^\I \ar[d]^{A^i} \\
\I \ar[r] \ar@{..>}[ru] & A^{\partial\I}
}
\end{equation*}
But this is just the exponential transpose of the diagram \eqref{diagram:boxfillingrev}, where the corresponsing transposed maps are as indicated:
\begin{equation}\label{diagram:pathliftpathrev}
\xymatrix{
1 \ar[d] \ar[r]^{a'} & A^\I \ar[d]^{A^i} \\
\I \ar[r]_{b'} \ar@{..>}[ru]^{c'} & A^{\partial\I}
}
\end{equation}
\end{proof}

We now generalize the foregoing proposition to higher dimensions, in order to ensure that all of the higher identity types $\id{\id{\id{\dots}}}$ are also interpreted as suitable maps with path lifting.  The higher identity types are determined inductively by:
\begin{align*}
\id{A} &= A^\I \\
\Id^{n+1}_{A} &= \id{{\Id}^{n}_{A}} = (\Id^{n}_{A})^\I = (A^{\I^n})^\I \cong A^{(\I^{n+1})}.
\end{align*}
The indexing $A^\I \to A\times A = A^{\partial\I}$ is generalized to higher dimensions as follows: the type $\Id^{n}_{A} \cong A^{\I^n}$ is regarded as the \emph{type of $n$-cubes in $A$}, and it will be dependent on the \emph{type $A^{\partial\I^n}$ of boundaries in $A$}, via the ``restriction'' map $$A^i : A^{\I^n} \to A^{\partial\I^n},$$  where the boundary $i : \partial\I^n \mono \I^n$ is the union of all the face maps $$\partial\I^n = \bigcup_{i, d} \alpha_i^d.$$
As an indexing type, it is convenient to specify $\partial\I^n$ inductively via the ``product rule'' $$\partial(A\times B) = (\partial A\times B) +_{(\partial A\times\partial B)} (A\times\partial B)$$
as follows:
\begin{definition}\label{def:boundary}
The \emph{boundary of the $n$-cube}, $\partial\I^n \mono \I^n$, is determined by induction: 
\begin{align*}
\partial\I &\ =\  1+1,\\
\partial\I^2 &\ =\ (\partial\I\times\I) +_{(\partial\I\times\partial\I)} (\I\times\partial\I),\\
\partial\I^{n+1} &\ =\ (\partial\I\times\I^n) +_{(\partial\I\times\partial\I^n)} (\I\times\partial\I^n),
\end{align*}
with the obvious maps $\partial\I^n \mono \I^n$.
\end{definition}

\begin{proposition}\label{prop:main}
For any hypercubical set $A$ and any $n\geq 1$, the following are equivalent:
\begin{enumerate}
\item $A$ has $(n+1)$-box filling.
\item $A^\I \to A\times A$ has $n$-box filling.
\item $A^{\I^n} \to A^{\partial\I^n}$ has $1$-box filling, i.e.\ path lifting.
\end{enumerate}
\end{proposition}

\begin{proof}
Consider $n$-box filling for $A^\I \to A\times A$, which is represented by the following diagonal filling problem:
\begin{equation*}\label{diagram:pathliftpathrev}
\xymatrix{
\sqcup^n\ar[d] \ar[r]^{a} & A^\I \ar[d]^{A^i} \\
\I^n \ar[r]_{b} \ar@{..>}[ru]|{c} & A^{\partial\I}
}
\end{equation*}
Transposing this diagram as in the proof of Proposition \ref{prop:pathliftboxfill} results in the following diagram:
\begin{equation}\label{diagram:bocfillpathobject}
\xymatrix{
\sqcup^n\times \partial\I \ar[d] \ar[r]  & \sqcup^n\times \I \ar[d] \ar@/{}^{1pc}/[rdd]^{\bar{a}} \\
\I^n \times \partial\I \ar[r] \ar@/{}_{1pc}/[rrd]_{\bar{b}} & \I^n\times\I \ar@{>.>}[rd]|{\bar{c}} \\
 &&  A
}
\end{equation}
Such a map $\bar{c} : \I^{n+1} \to A$ commuting with $\bar{a}$ and $\bar{b}$ is an extension to the $(n+1)$-cube of a map from an open $(n+1)$-box $\sqcup^{n+1}\mono \I^{n+1}$, which can clearly also be constructed as the following pushout:
\begin{equation*}\label{diagram:bocfillpathobjectrev}
\xymatrix{
\sqcup^n\times \partial\I \ar[d] \ar[r]  & \sqcup^n\times \I \ar[d] \ar@/{}^{1pc}/[rdd] \\
\I^n \times \partial\I \ar[r] \ar@/{}_{1pc}/[rrd] &\sqcup^{n+1}  \pocorner \ar@{>.>}[rd] \\
 &&  \I^{n+1}
}
\end{equation*}
Thus $A^\I \to A\times A$ has $n$-box filling just in case $A$ has $(n+1)$-box filling.

Now  $A^{\I^n} \to A^{\partial\I^n}$ has path lifting just if there is always a diagonal filler in diagrams of the form:
\begin{equation*}\label{diagram:pathliftpathrev}
\xymatrix{
1 \ar[d] \ar[r]^{a} & A^{\I^n} \ar[d]^{A^i} \\
\I \ar[r]_{b} \ar@{..>}[ur]|{c}& A^{\partial\I^n}
}
\end{equation*}
Transposing once again yields the following situation, in which $\bar{c}$ is to be found, commuting with any given $\bar{a}$ and $\bar{b}$ that commute with the upper left span:
\begin{equation*}\label{diagram:bocfillpathobjectagain}
\xymatrix{
1\times \partial\I^n \ar[d] \ar[r]  & 1\times \I^n \ar[d] \ar@/{}^{1pc}/[rdd]^{\bar{a}} \\
\I \times \partial\I^n \ar[r] \ar@/{}_{1pc}/[rrd]_{\bar{b}} & \I \times \I^n \ar@{>.>}[rd]|{\bar{c}} \\
 &&  A
}
\end{equation*}
This is easily seen to be yet another description of $(n+1)$-box filling for~$A$.
\end{proof}

\begin{corollary}\label{cor:alln}
For any hypercubical set $A$, the following are equivalent:
\begin{enumerate}
\item $A$ has $n$-box filling for all $n\geq 1$.
\item $A^\I \to A\times A$ has $n$-box filling for all $n\geq 1$.
\item $A^{\I^n} \to A^{\partial\I^n}$ has path lifting for all $n\geq 1$.
\end{enumerate}
\end{corollary}

%\begin{corollary}\label{cor:KanmodelsId}
%Let  $A$ be a hypercubical set that has $n$-box filling for all $n\geq 1$. Then in particular, $A$ satisfies contraction.  If $B\to A^\I$ has $n$-box filling for all $n\geq 1$, then in particular, $B\to A^\I$ satisfies transport.  Thus the following standard $\Id$-elimination rule will be satisfied:
%\begin{equation}\label{rule:idelim}\tag{$\Id$-Elimination}
%\begin{prooftree}
%x,y: A, z:\id{A}(x,y)\vdash B(x,y,z)\ \type, \quad
%x: A \vdash b(x) : B(x,x,\refl(x))
%\justifies
%\mathsf{J}(x,y,z,b) : B(x,y,z)
%\end{prooftree}
%\end{equation}
%with computation rule
%\[
%\mathsf{J}(x,x,\refl(x),b) = b(x) : B(x).
%\]
%\end{corollary}
%\begin{proof}
%Let $\mathsf{J}(x,y,z,b) := \mathsf{con}(x,y,z)_*(b(x))$.
%\end{proof}
%

%\begin{theorem}[conjectural!]
%For any type $X$ in intensional type theory with function extensionality, the cubical type of ``identity contexts'' over $X$ is an internal weak $\infty$-groupoid in the cubical sense.
%\end{theorem}
%
%\begin{proof}[Proof (sketch)]
%The cubical contexts will satisfy the basic cubical laws (together with symmetry) in virtue of the definitional equalities holding for the indexing projections, just as in the globular case.  The diagonals, however, will not be definitional, but only propositional.  Since path lifting holds for all dependent types, if the type of $n$-boundaries can be constructed so that the types of $n$-cubes is indexed over it,  the corollary will then imply that one has the usual box filling conditions.  
%\end{proof}

%%%%%%%%%%%%%%%%
\subsection{Uniformity}

\begin{definition}[cf.~\cite{BCH}]  A hypercubical set $A$ will be said to be \emph{uniformly Kan} if the following holds:
\begin{enumerate}
\item  For each open box $\sqcup^n \mono \I^n$, each $k\geq 1$, and each map $b: \I^k \times\sqcup^n\to A$, there is given an extension $\bar{b} : \I^k\times\I^n \to A$ along the product map $\I^k\times\sqcup^n \mono \I^k\times\I^n$.
\begin{equation}\label{diagram:uniformsimple}
\xymatrix{
\I^k\times \sqcup^n\ar@{>->}[dd] \ar[rd]^{b}  &\\
	& A\\
 \I^k \times \I^n \ar@{..>}[ru]_{\bar{b}} &
}
\end{equation}
\item The chosen extensions $\bar{b}$ are natural in $\I^k$, in the sense that for each map of hypercubes $f : \I^j \to \I^k$, one has
\[
\overline{b\circ(f\times\sqcup^n)} = \bar{b}\circ (f\times\I^n),
\]
as indicated in the following commutative diagram:
\begin{equation}\label{diagram:uniformnatural}
\xymatrix{
\I^j\times \sqcup^n\ar@{>->}[dddd] \ar@/{}^{3pc}/[rrrdd]^{b(f\times\sqcup^n)} \ar[rd]^{f\times\sqcup^n} &&& \\
	& \I^k\times \sqcup^n\ar@{>->}[dd] \ar[rrd]^{b}  &&\\
	&&& A\\
	& \I^k \times \I^n \ar@{..>}[rru]_{\bar{b}} &&\\
 \I^j \times \I^n \ar@{.>}@/{}_{3pc}/[rrruu]_{\overline{b(f\times\sqcup^n)}} \ar[ru]_{f\times\I^n} &&&
}
\end{equation}
\item The foregoing also holds for all lower open boxes $\sqcap^n \mono \I^n$.
\end{enumerate}
\end{definition}

The uniform Kan condition turns the box filling \emph{property} of an object $A$ into an explicitly given \emph{structure} $(A, \overline{(-)})$ on the object, namely a natural choice of fillers $\bar{b}$ for all (generalized) open boxes $b : \I^k\times \sqcup^n \to A$.  This will be seen to simplify the proof that the exponential $A^X$ of a Kan object  $A$ by any object $X$ is again Kan. The following reformulation was arrived at in conversation with P.~Lumsdaine.
%
\begin{proposition}
A hypercubical set $A$ is uniformly Kan just in case, for each $n\geq 1$, there is given a section $s_n : A^{\sqcup^n} \to A^{\I^n}$ of the canonical map $A^{i^n} : A^{\I^n}\to A^{\sqcup^n}$, where $i^n : \sqcup^n \mono \I^n$ is the inclusion,
\[
\xymatrix{
A^{\I^n} \ar[rr]^{A^{i^n}} & & \ar@{.>}@/{}^{2pc}/[ll]^{s_n} A^{\sqcup^n}
}
\]
and analogously for all lower open boxes $\sqcap^n \mono \I^n$.
\end{proposition}

\begin{proof}
Transpose the diagram \eqref{diagram:uniformsimple} to obtain the lifting problem:
\begin{equation*}
\xymatrix{
	& A^{\I^n}  \ar[dd]^{A^{i^n}}\\
\I^k \ar@{..>}[ru]^{\bar{b}}  \ar[rd]_{b} & \\
	& A^{\sqcup^n} 
}
\end{equation*}
The naturality of the family of maps $\bar{b}$ means that we always have $\overline{b\circ f} = \bar{b}\circ f$, as in:
\begin{equation}
\xymatrix{
	&& A^{\I^n}  \ar[dd]^{A^{i^n}}\\
\I^j \ar[r]^{f} \ar@{..>}@/{}^{1pc}/[rru]^{\overline{bf}} \ar@/{}_{1pc}/[rrd]_{bf} & \I^k \ar@{..>}[ru]^{\bar{b}}  \ar[rd]_{b} & \\
	&& A^{\sqcup^n} 
}
\end{equation}
By Yoneda, this is equivalent to having a section $s_n : A^{\sqcup^n}  \to A^{\I^n}$ of $A^{i^n}$, with $\bar{b} = s_n\circ b$,
\begin{equation}
\xymatrix{
	& A^{\I^n}  \ar[dd]^{A^{i^n}}\\
\I^k \ar@{..>}[ru]^{\bar{b}}  \ar[rd]_{b} & \\
	& A^{\sqcup^n}  \ar@{..>}@/{}_{2pc}/[uu]_{s_n}
}
\end{equation}
\end{proof}

\begin{definition} By a \emph{(uniform) Kan object} we shall mean a hypercubical set $A$ equipped with a family of (upper and lower) sections $(s_n)_{n\geq 1}$, 
\[
\xymatrix{
A^{\I^n} \ar[rr]^{A^{i^n}} & & \ar@{.>}@/{}^{2pc}/[ll]^{s_n} A^{\sqcup^n}.
}
\]
\end{definition}

\begin{proposition}\label{prop:coqexp}
If $A$ is a uniform Kan object, then so is $A^X$ for any hypercubical set $X$.
\end{proposition}
\begin{proof}
Let the sections $s_n$ be given,
\[
\xymatrix{
A^{\I^n} \ar[rr]^{A^{i^n}} & & \ar@{.>}@/{}^{2pc}/[ll]^{s_n} A^{\sqcup^n}.
}
\]
We require sections $t_n : (A^X)^{\sqcup^n} \to (A^X)^{\I^n}$ as in:
\[
\xymatrix{
(A^X)^{\I^n} \ar[rr]^{(A^X)^{i^n}} & & \ar@{.>}@/{}^{2pc}/[ll]^{t_n} (A^X)^{\sqcup^n}.
}
\]
We can take $t_n$ to be $(s_n)^X$ conjugated by the isomorphisms $(A^X)^{\I^n} \cong (A^{\I^n})^X$ and $(A^X)^{\sqcup^n} \cong (A^{\sqcup^n})^X$,
\[
\xymatrix{
(A^X)^{\I^n} \ar[rr]^{(A^X)^{i^n}} & & \ar@{.>}@/{}_{2pc}/[ll]_{t_n} (A^X)^{\sqcup^n} \ar[d]^{\cong} \\
(A^{\I^n})^X \ar[rr]^{(A^{i^n})^X}  \ar[u]^{\cong} & & \ar@/{}^{2pc}/[ll]^{(s_n)^X} (A^{\sqcup^n})^X.
}
\]
\end{proof}

Finally, the generalization from objects $A$ to maps $B\to A$ follows essentially the same pattern. Consider first a lifting problem of the form
\begin{equation}\label{diagram:boxfillfib}
\xymatrix{
\I^k \times \sqcup^n \ar[d] \ar[r]^-{b} & B \ar[d]^{f} \\
\I^k \times \I^n \ar[r]_-{a} \ar@{.>}[ru]|-{c} & A
}
\end{equation}
Transposing, we have the corresponding problem
\begin{equation*}%\label{diagram:pathliftpath}
\xymatrix{
\I^k \ar@/{}_{1pc}/[rdd]_{a} \ar@/{}^{1pc}/[rrd]^{b} \ar@{.>}[rd]|{c} & & \\
& B^{\I^n} \ar[d] \ar[r] & B^{\sqcup^n } \ar[d] \\
& A^{\I^n} \ar[r] & A^{\sqcup^n }
}
\end{equation*}
which is to be solved naturally in $\I^k$.  But this is equivalent to having a section of the canonical map $u = (f^{\I^n}, B^{i^n})$ from $B^{\I^n}$ into the pullback:
\begin{equation}\label{diagram:pullbackforukf}
\xymatrix{
B^{\I^n} \ar@/{}_{1pc}/[rdd]_{f^{\I^n}} \ar@/{}^{1pc}/[rrd]^{B^{i^n}} \ar@{.>}[rd]|{u} & & \\
&  A^{\I^n} \times_{A^{\sqcup^n }} B^{\sqcup^n }  \ar[d] \ar[r] & B^{\sqcup^n } \ar[d] \\
& A^{\I^n} \ar[r] & A^{\sqcup^n }.
}
\end{equation}

\begin{definition}\label{def:Kanfib} By a \emph{uniform Kan fibration} we mean a map of hypercubical sets $f: B\to A$ equipped with a family of (upper and lower) sections $(s_n)_{n\geq 1}$ of the following form:
\[
\xymatrix{
B^{\I^n} \ar[rr]^-{(f^{\I^n},\, B^{i^n})} & & \ar@{.>}@/{}^{2pc}/[ll]^{s_n} A^{\I^n} \times_{A^{\sqcup^n }} B^{\sqcup^n }
}
\]
\end{definition}

\begin{proposition}
A map $f : B\to A$ is a uniform Kan fibration just if, to every square of the form
\begin{equation}%\label{diagram:boxfillfib}
\xymatrix{
\I^k \times \sqcup^n \ar[d] \ar[r]^-{b} & B \ar[d]^{f} \\
\I^k \times \I^n \ar[r]_-{a} \ar@{.>}[ru]|-{c} & A
}
\end{equation}
there is given a diagonal filler $c = \overline{(a,b)}$, and these fillers are moreover natural in $\I^k$, in the sense that for any $f : \I^j \to \I^k$, one has
\[
\overline{(a,b)}\circ(f\times \I^n) = \overline{(a\circ (f\times \I^n), b\circ (f\times \sqcup^n))}.
\]
\end{proposition}

\begin{proof}
Done.
\end{proof}

\begin{proposition}
Uniform Kan fibrations are closed under $\Pi$ types along arbitrary maps, in the following sense:
If $B\to A$ is a uniform Kan fibration, and $\alpha: A\to A'$ is any map, then the relative product $\Pi_\alpha.B\to A'$ of $B$ along $\alpha$ (where $\Pi_\alpha$ is the right adjoint to pullback along $\alpha$) is again uniform Kan.
\end{proposition}

\begin{proof}
The operation $\Pi_\alpha$ along a map $\alpha : A\to A'$ always exists in a presheaf topos, and can  be calculated as follows:  Let $f:B\to A$ and $\alpha: A\to A'$ be given.  Without loss of generality, we can assume that $A' =1$ and calculate $\Pi_A.B$, by working in the slice category over $A'$, which is also a presheaf topos.  We therefore need to show that there are sections of the form:
\[
\xymatrix{
(\Pi_A.B)^{\I^n} \ar[rr]^{(\Pi_A.B)^{i^n}} & & \ar@{.>}@/{}^{2pc}/[ll]^{s_n} (\Pi_A.B)^{\sqcup^n}.
}
\]
and similarly for $\sqcap^n$.

The construction of $\Pi_A.B$ is depicted in the following pullback diagram.
\begin{equation}%\label{diagram:boxfillfib}
\xymatrix{
\Pi_A.B \ar[d] \ar[r] \pbcorner & B^A \ar[d]^{f^A} \\
1 \ar[r]_{^\prime1_A^\prime} & A^A
}
\end{equation}
Applying $(-)^A$ to the diagram \eqref{diagram:pullbackforukf} and swapping exponents we obtain:
\begin{equation}\label{diagram:pullbackforukf2}
\xymatrix{
(B^A)^{\I^n} \ar@/{}_{2pc}/[rdd]_{(f^A)^{\I^n}} \ar@/{}^{2pc}/[rrd]^{(B^A)^{i^n}} \ar@{.>}[rd]|{u'} & & \\
&  (A^A)^{\I^n}\times_{(A^A)^{\sqcup^n}} (B^A)^{\sqcup^n} \ar[d] \ar[r] & (B^A)^{\sqcup^n} \ar[d] \\
& (A^A)^{\I^n} \ar[r] & (A^A)^{\sqcup^n}.
}
\end{equation}
now pull this entire diagram back along the point $('1_A')^{\sqcup^n}
: 1^{\sqcup^n} \to (A^A)^{\sqcup^n}$ to obtain:
\begin{equation}\label{diagram:pullbackforukf3}
\xymatrix{
(\Pi_A.B )^{\I^n} \ar@/{}_{2pc}/[rdd] \ar@/{}^{2pc}/[rrd]^{(\Pi_A.B )^{i^n}} \ar@{.>}[rd]|{u''} & & \\
&  Q \times (\Pi_A.B )^{\sqcup^n} \ar[d]_{p_1} \ar[r]_{p_2} & (\Pi_A.B )^{\sqcup^n} \ar[d] \\
& Q \ar[r] & 1.
}
\end{equation}
where $Q$ is the fiber of the map $(A^A)^{i^n} : (A^A)^{\I^n}\to (A^A)^{\sqcup^n}$ over $('1_A')^{\sqcup^n}$.

Now the arrow $u'$ in \eqref{diagram:pullbackforukf2} has a section, because $u$ in \eqref{diagram:pullbackforukf} does by the assumption that $B\to A$ is uniform Kan.  Therefore $u''$ in \eqref{diagram:pullbackforukf3} also has a section $s$.  And $Q\to 1$ clearly has a section, determined by the point  $('1_A')^{\I^n}
: 1^{\I^n} \to (A^A)^{\I^n}$.  Thus $p_2$ in \eqref{diagram:pullbackforukf3} has a section $s'$.  Composing $s\circ s'$ gives the required section $s_n$ of $(\Pi_A.B )^{i^n}$.
\end{proof}


\section{The universe}

One could now construct a  model in the form of an explicit category with families, but we prefer to take advantage of the recent coherence theorem of Lumsdaine and Warren \cite{L&M}.  This allows us to work in a more flexible, categorical setting that has been shown to be sufficient for the construction of a CwF model if desired.  One aspect of the formulation given in \cite{natural} is the use of a (Voevodsky-style) universe in order to construct a so-called ``natural model", which is essentially a convenient reformulation of the notion of a category with families.
Here we will take a similar, if not identical approach, defining a natural transformation $p : \UU \to \U$ from which one can determine a category with families in the same way as in  \cite{natural}.  We first focus on the construction of $p : \UU \to \U$ and the proof that it is Kan.

\begin{definition}
Let $\kappa$ be an inaccessible cardinal number, and call the sets of size strictly less than $\kappa$ \emph{small}.  Write $\Set_\kappa$ for the small sets, and $\Set_\kappa^{\C^{\mathrm{op}}}$ for the category of small presheaves on a small index category $\C$.  By a \emph{small (uniform) Kan fibration} we mean a (uniform) Kan fibration, in the sense of Definition \ref{def:Kanfib}, in the category 
\[
\HH_\kappa = \Set_\kappa^{\H^{\mathrm{op}}}
\]
 of small hypercubical sets.  We henceforth omit the qualifier ``uniform" and assume that all Kan objects and fibrations are uniform; we also omit mention of the selected uniform structure.

The ($\kappa$-)\emph{universe} $p : \UU \to \U$ is defined:
\begin{enumerate}
\item $\UU_n = \{ (\alpha, c)\, |\, \alpha : \tilde{A}\to A\ \text{is a small Kan fibration}, A\ \text{is a Kan object, and}\ c\in \tilde{A}_n\ \}$

\item $\U_n = \{ (\alpha, c)\, |\, \alpha : \tilde{A}\to A\ \text{is a small Kan fibration, $A$ is a Kan object, and}\ c\in A_n\ \}$

\item For $(\alpha, c)\in \UU_n$, let $p_n (\alpha, c) = (\alpha, \alpha_n(c)) \in \U_n$.
\end{enumerate}
\end{definition}

\subsubsection*{To Do}
\begin{enumerate}

\item Both $p : \UU \to \U$  and $\U$ are Kan -- add the proofs.
\item A cubical $\infty$-groupoid is a cubical set with box-filling operations.  The contexts over a type do form such a groupoid (``cubical Lumsdaine''). Write it up.

\end{enumerate}

\subsubsection*{Questions}
\begin{enumerate}

\item According to Grothedieck \cite{PS}, the category $\H$ is a test category, and so the category $\HH = \psh{\H}$ has the same homotopy theory as simplicial sets.  Bas has pointed out a proof by Cisinski-Maltsiniotis based on decalage.  Dig this up.

\item The hypercubical sets $\HH$ is perhaps a good setting in which to compare the globular, simplicial, and type-theoretic notions of $\omega$-groupoid.

\item What is a hypercubical $(\infty, 1)$-category (in analogy to the simplicial notion of quasicategory)?  Does the type theory give rise to one?

\end{enumerate}


%\subsubsection*{Remarks}
%\begin{enumerate}
%\item It can be shown that now every map factors as:
%\[
%\xymatrix{
% I^n \ar[r]^{f} \ar[d]_{\beta} & I^m\\
%I^k \ar[r]_{\sigma} & I^k \ar[u]_{\alpha}
%}
%\]
%where $\alpha : I^k \to I^m$ is a (composite) face, $\sigma : I^k \to I^k$ is a (composite) permutation, and $\beta : I^n \to I^k$ is a (composite) degeneracy.  Using this, it can be shown that $\mathbb{C}_s$ is the free \emph{symmetric} monoidal category on an interval.
%
%\item The presheaf category $\mathsf{csSet} = \psh{\C_s}$ of \emph{symmetric cubical sets} again has the same homotopy theory as simplicial sets.
%
%\item The objects $I^n$ are again the $n$-fold \emph{tensor} products of the interval $I$, but not the \emph{cartesian} products, and again the geometric realization functor to topological spaces does not preserve cartesian products, but instead takes tensor products to cartesian ones. Relatedly, there is a functor $\mathsf{Hom}(X, - )$, right adjoint to the tensor $X\otimes (-)$, which is not an exponential.
%\end{enumerate}
%

\subsection*{Acknowldgements}
I have benefitted from lectures by and conversations with Peter Aczel, Ulrik Buchholtz, Thierry Coquand, Bob Harper, Simon Huber, Andr\'e Joyal, Andy Pitts, and Bas Spitters.  I am grateful to the Institut Henri Poincar\'e, and the organizers of the thematic trimester held there on Certified Proofs and Computation, Pierre-Louis Curien, Hugo Herbelin, and Paul-Andr\'e Mellies, for providing the stimulating and congenial environment in which I began this research.  My student Jason Parker has developed some of the material in Section 1 further as an MS thesis.  This work was partially supported by the Air Force Office of Scientific Research through MURI grant FA9550-15-1-0053.  Any opinions, findings and conclusions, or recommendations expressed herein are those of the author and do not necessarily reflect the views of the AFOSR.  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{300}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\bibitem{AW}
%S.~Awodey and M.A.~Warren. Homotopy theoretic models of identity types. \emph{Math. Proc. Camb. Phil. Soc.}, 146, 45--55, 2009.
%
%\bibitem{GvdB}
%B.~van den Berg and R.~Garner. Topological and Simplicial Models of Identity Types. \emph{ACM Transactions on Computational Logic}, 13:1, 2012.
%
%\bibitem{CwF} 
%P.~Dybjer. ``Internal Type Theory." \emph{LNCS} 1158, 120--134, 1996.
%
%\bibitem{GK}  
%N.~Gambino and J.~Kock, ``Polynomial functors and polynomial monads"
%\emph{Math. Proc. Cambridge Phil. Soc.} 154, 153--192, 2013.
%
%\bibitem{Hofmann} 
%
%\bibitem{HoTTbook} 
%\emph{Homotopy Type Theory: Univalent Foundations of Mathematics}, The Univalent Foundations Program, Institute for Advanced Study, 2013. {\tt http://homotopytypetheory.org/book}
%
%\bibitem{KLV}  
%C.~Kapulkin, P.~LeFanu Lumsdaine and V.~Voevodsky, The Simplicial Model of Univalent Foundations. \emph{In preparation}, 2013.
%
%
\end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
